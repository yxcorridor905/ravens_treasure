<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Raven's Treasure - ‰πåÈ∏¶ÁöÑÂÆùËóè</title>
    
    <!--
    ========================================
    üîê ÂºÄÂèëËÄÖÈÖçÁΩÆËØ¥Êòé
    ========================================
    
    Êú¨ÁâàÊú¨‰∏∫ÂºÄÂèëËÄÖÊ®°ÂºèÔºö
    - API Key Â∑≤Á°¨ÁºñÁ†ÅÂú®‰ª£Á†Å‰∏≠
    - Áî®Êà∑Êó†Ê≥ïÈÄöËøáÁïåÈù¢‰øÆÊîπ API Key
    - ÁßªÈô§‰∫ÜÊâÄÊúâ API ËÆæÁΩÆÁõ∏ÂÖ≥ÁöÑÁî®Êà∑ÁïåÈù¢
    
    Â¶ÇÈúÄÈÖçÁΩÆÊÇ®ÁöÑ DeepSeek API KeyÔºö
    1. Âú®‰ª£Á†Å‰∏≠ÊêúÁ¥¢ "‚ö†Ô∏è ÂºÄÂèëËÄÖËØ∑Âú®Ê≠§Â§ÑÈÖçÁΩÆ"
    2. Â∞Ü API Key ÊõøÊç¢‰∏∫ÊÇ®ÁöÑÂÆûÈôÖÂØÜÈí•
    3. ÊàñËÄÖÊêúÁ¥¢ this.apiKey = 'sk-...'
    
    Ëé∑Âèñ API KeyÔºöhttps://platform.deepseek.com
    ========================================
    -->
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Ma+Shan+Zheng&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* Ê°åÈù¢Á´ØÈ¢ÑËßàÂÆπÂô® */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Serif SC', serif, -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans SC", sans-serif;
        }

        /* ÊâãÊú∫Ê®°ÊãüÂô®Â§ñÂ£≥ */
        @media (min-width: 768px) {
            body {
                background: linear-gradient(135deg, #8b7355 0%, #5a4a3a 100%);
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                padding: 20px;
            }

            #phone-simulator {
                width: 375px;
                height: 812px;
                background: #000;
                border-radius: 40px;
                padding: 12px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
                position: relative;
            }

            #phone-simulator::before {
                content: '';
                position: absolute;
                top: 0;
                left: 50%;
                transform: translateX(-50%);
                width: 150px;
                height: 30px;
                background: #000;
                border-radius: 0 0 20px 20px;
                z-index: 10;
            }

            #phone-screen {
                width: 100%;
                height: 100%;
                background: #E8E4D9;
                border-radius: 32px;
                overflow: hidden;
                position: relative;
            }
        }

        @media (max-width: 767px) {
            #phone-screen {
                width: 100%;
                min-height: 100vh;
                background: #E8E4D9;
            }
        }

        /* Â∫îÁî®‰∏ª‰Ωì */
        #app {
            width: 100%;
            height: 100%;
            background: #E8E4D9;
            color: #3D2F2F;
            position: relative;
            overflow: hidden;
        }

        /* È°µÈù¢ÂÆπÂô® */
        .page {
            visibility: hidden;
            opacity: 0;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            transition: opacity 0.3s ease;
            padding-bottom: 103px;
        }

        @media (min-width: 768px) {
            .page {
                padding-bottom: 90px;
            }
        }

        .page.active {
            visibility: visible;
            opacity: 1;
        }

        /* È°∂ÈÉ®ÂØºËà™Ê†è */
        .nav-bar {
            height: 88px;
            padding-top: 44px;
            background: #E8E4D9;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border-bottom: none;
        }

        .nav-bar .back-btn {
            position: absolute;
            left: 16px;
            top: 50px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #3D2F2F;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 28px;
        }

        .nav-bar .title {
            font-size: 17px;
            font-weight: 600;
            letter-spacing: 0.5px;
            color: #3D2F2F;
        }

        /* Â∫ïÈÉ®TabBar */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 83px;
            padding-bottom: 20px;
            background: #E8E4D9;
            border-top: 0.5px solid rgba(61, 47, 47, 0.2);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            padding-left: 20px;
            padding-right: 20px;
        }

        @media (min-width: 768px) {
            .tab-bar {
                max-width: 351px;
                left: auto;
                right: auto;
                bottom: 0;
                transform: none;
                border-radius: 0 0 20px 20px;
                margin: 0 12px 12px 12px;
                width: calc(100% - 24px);
                padding-bottom: 12px;
                height: 70px;
            }
            
            #phone-screen .tab-bar {
                position: absolute;
            }
        }

        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #8b7355;
            font-size: 10px;
            cursor: pointer;
            background: none;
            border: none;
            padding: 8px;
            letter-spacing: 0;
            transition: all 0.2s ease;
        }

        .tab-item.active {
            color: #3D2F2F;
        }

        .tab-item.active .tab-line {
            background: #3D2F2F;
        }

        .tab-icon {
            width: 28px;
            height: 28px;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tab-icon svg {
            width: 26px;
            height: 26px;
            stroke: currentColor;
            fill: none;
            stroke-width: 1.8;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: all 0.2s ease;
        }

        .tab-item.active .tab-icon svg {
            stroke: #3D2F2F;
        }

        .tab-line {
            display: none;
        }

        /* ==================== ËÆ∞ÂΩïÈ°µ ==================== */
        #recordPage {
            display: flex;
            flex-direction: column;
        }

        .record-content {
            flex: 1;
            padding: 64px 20px 24px;
            display: flex;
            flex-direction: column;
        }

        .page-icon {
            width: 64px;
            height: 64px;
            margin: 8px auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border-radius: 50%;
            animation: rotate-slow-icon 20s linear infinite; /* ÁºìÊÖ¢ÊóãËΩ¨ */
        }

        @keyframes rotate-slow-icon {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .page-icon svg {
            width: 48px;
            height: 48px;
            stroke: #8b7355;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .page-icon svg .fill-eye {
            fill: #8b7355;
        }

        .page-title {
            font-family: 'Ma Shan Zheng', 'Noto Serif SC', serif;
            font-size: 28px;
            font-weight: 400;
            text-align: center;
            margin-bottom: 12px;
            letter-spacing: 6px;
            color: #3D2F2F;
            /* Âà†Èô§ÊµÆÂä®Âä®Êïà */
        }

        .page-subtitle {
            font-family: 'Noto Serif SC', serif;
            font-size: 12px;
            font-style: italic;
            text-align: center;
            margin-bottom: 36px;
            color: #8b7355;
            line-height: 1.8;
            opacity: 0.8;
        }

        .section-label {
            font-size: 13px;
            font-weight: 500;
            color: #3D2F2F;
            margin-bottom: 12px;
            letter-spacing: 0;
        }

        /* ‚ïê‚ïê XY ÊÉÖÁª™ÂùêÊ†áÁõò ‚ïê‚ïê */
        .emotion-selector { margin-bottom: 18px; }

        .xy-container {
            position: relative; width: 100%; height: 210px;
            background: rgba(61,47,47,0.03);
            border: 1px solid rgba(61,47,47,0.12);
            border-radius: 14px; overflow: hidden;
            cursor: crosshair; touch-action: none;
        }
        .xy-quadrant { position: absolute; width: 50%; height: 50%; pointer-events: none; }
        .xy-q-rt { top:0; right:0;    background: radial-gradient(circle at 15% 85%, rgba(201,169,97,0.10),  transparent 75%); }
        .xy-q-rb { bottom:0; right:0; background: radial-gradient(circle at 15% 15%, rgba(91,140,138,0.09),  transparent 75%); }
        .xy-q-lt { top:0; left:0;     background: radial-gradient(circle at 85% 85%, rgba(166,75,58,0.08),   transparent 75%); }
        .xy-q-lb { bottom:0; left:0;  background: radial-gradient(circle at 85% 15%, rgba(123,155,168,0.09), transparent 75%); }
        .xy-grid-dots { position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none; }
        .xy-axis-h, .xy-axis-v { position: absolute; background: rgba(61,47,47,0.13); pointer-events: none; }
        .xy-axis-h { top:50%; left:4%; right:4%; height:1px; transform:translateY(-50%); }
        .xy-axis-v { left:50%; top:4%; bottom:4%; width:1px; transform:translateX(-50%); }
        .xy-legend { position: absolute; font-size: 9px; color: rgba(61,47,47,0.38); letter-spacing: 0.5px; pointer-events: none; font-style: italic; }
        .xy-leg-xp { top:50%; right:5%; transform:translateY(-140%); }
        .xy-leg-xn { top:50%; left:5%; transform:translateY(-140%); }
        .xy-leg-yp { left:50%; top:5%; transform:translateX(10%); }
        .xy-leg-yn { left:50%; bottom:5%; transform:translateX(10%); }
        .xy-quad-label { position: absolute; font-size: 10px; color: rgba(61,47,47,0.28); letter-spacing: 0.5px; pointer-events: none; line-height: 1.6; }
        .xy-ql-rt { top:7%; right:7%; text-align:right; }
        .xy-ql-rb { bottom:7%; right:7%; text-align:right; }
        .xy-ql-lt { top:7%; left:7%; text-align:left; }
        .xy-ql-lb { bottom:7%; left:7%; text-align:left; }
        .xy-crosshair-h, .xy-crosshair-v { position: absolute; pointer-events: none; opacity: 0; transition: opacity 0.12s; }
        .xy-crosshair-h { height:1px; left:0; right:0; transform:translateY(-50%); }
        .xy-crosshair-v { width:1px; top:0; bottom:0; transform:translateX(-50%); }
        .xy-glow { position: absolute; width: 56px; height: 56px; border-radius: 50%; transform: translate(-50%,-50%); pointer-events: none; opacity: 0; transition: opacity 0.12s; }
        .xy-dot { position: absolute; width: 13px; height: 13px; border-radius: 50%; border: 2.5px solid rgba(61,47,47,0.7); transform: translate(-50%,-50%); pointer-events: none; opacity: 0; transition: opacity 0.12s, background-color 0.06s; box-shadow: 0 2px 8px rgba(0,0,0,0.18); }
        .xy-bubble { position: absolute; font-size: 10px; padding: 3px 9px; border-radius: 10px; white-space: nowrap; pointer-events: none; opacity: 0; transition: opacity 0.12s, background-color 0.06s; letter-spacing: 0.5px; color: #E8E4D9; }
        .xy-bubble::after { content: ''; position: absolute; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 4px solid transparent; border-right: 4px solid transparent; }
        .xy-bubble:not([data-dir='down'])::after { bottom: -4px; border-top: 4px solid var(--tip, #3D2F2F); border-bottom: none; }
        .xy-bubble[data-dir='down']::after { top: -4px; bottom: auto; border-bottom: 4px solid var(--tip, #3D2F2F); border-top: none; }
        .xy-readout { display:flex; justify-content:space-between; align-items:center; margin-top:7px; padding:0 2px; }
        .xy-readout-item { font-size:11px; color:rgba(61,47,47,0.38); letter-spacing:0.5px; font-style:italic; }
        .xy-readout-item span { font-style:normal; font-weight:600; }
        .xy-hint { font-size:11px; color:rgba(61,47,47,0.35); font-style:italic; transition:color 0.1s; }



        /* ËæìÂÖ•Âå∫Âüü */
        .input-area {
            margin-bottom: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .text-input {
            width: 100%;
            flex: 1;
            min-height: 140px;
            padding: 14px;
            background: rgba(61, 47, 47, 0.03);
            border: 1px solid rgba(61, 47, 47, 0.1);
            border-radius: 12px;
            font-size: 15px;
            color: #3D2F2F;
            resize: none;
            font-family: inherit;
            line-height: 1.6;
            transition: all 0.2s ease;
        }

        .text-input::placeholder {
            color: rgba(139, 115, 85, 0.5);
        }

        .text-input:focus {
            outline: none;
            border-color: rgba(61, 47, 47, 0.25);
            background: rgba(61, 47, 47, 0.02);
        }

        /* ‰∏ªÊåâÈíÆ */
        .primary-button {
            width: 100%;
            height: 50px;
            background: #C9A961;
            color: #3D2F2F;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(201, 169, 97, 0.3);
            position: relative;
            overflow: hidden;
        }

        .primary-button:disabled {
            background: rgba(61, 47, 47, 0.1);
            color: rgba(61, 47, 47, 0.3);
            cursor: not-allowed;
            box-shadow: none;
        }

        .primary-button:active:not(:disabled) {
            transform: scale(0.98);
            box-shadow: 0 1px 4px rgba(201, 169, 97, 0.3);
        }

        .primary-button.loading {
            position: relative;
            color: transparent;
        }

        .primary-button.loading::after {
            content: 'ÁîüÊàê‰∏≠...';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: #3D2F2F;
        }

        /* ==================== ÂÆùÁÆ±È°µ ==================== */
        #treasureBoxPage {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .treasure-box-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0 24px;
            min-height: 0;
        }

        .treasure-box-frame {
            width: 280px;
            height: 280px;
            border: 3px solid #3D2F2F;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
            position: relative;
            background: #F5F2EA;
            padding: 20px;
        }

        .treasure-box-frame::before,
        .treasure-box-frame::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 3px solid #3D2F2F;
        }

        .treasure-box-frame::before {
            top: -3px;
            left: -3px;
            border-right: none;
            border-bottom: none;
        }

        .treasure-box-frame::after {
            bottom: -3px;
            right: -3px;
            border-left: none;
            border-top: none;
        }

        .treasure-illustration {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .treasure-illustration svg {
            width: 200px;
            height: 200px;
            animation: float-chest 3s ease-in-out infinite; /* ÂÆùÁÆ±ÊµÆÂä® */
        }

        /* ÂÆùÁÆ±ÊµÆÂä®Âä®Áîª */
        @keyframes float-chest {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-8px);
            }
        }

        /* ‰∏äÂçáÂÖâÁÇπÁ≤íÂ≠êÊïàÊûú */
        .particles-rising {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle-rising {
            position: absolute;
            opacity: 0;
            animation: rise 4s ease-in infinite;
        }

        /* ÂúÜÂΩ¢Á≤íÂ≠ê */
        .particle-circle {
            width: 3px;
            height: 3px;
            border-radius: 50%;
        }

        /* ÈáëËâ≤Á≤íÂ≠ê */
        .particle-gold {
            background: #C9A961;
        }

        /* Ê∑±Ê£ïËâ≤Á≤íÂ≠ê */
        .particle-brown {
            background: #5D4E37;
        }

        /* ÂõõËßíÊòüÁ≤íÂ≠ê */
        .particle-star {
            width: 6px;
            height: 6px;
            background: transparent;
        }

        .particle-star::before,
        .particle-star::after {
            content: '';
            position: absolute;
            background: #C9A961;
        }

        .particle-star::before {
            width: 6px;
            height: 2px;
            top: 2px;
            left: 0;
        }

        .particle-star::after {
            width: 2px;
            height: 6px;
            top: 0;
            left: 2px;
        }

        /* Á¨¶ÊñáÁ≤íÂ≠ê */
        .particle-rune {
            width: 8px;
            height: 8px;
            font-size: 8px;
            color: #5D4E37;
            font-family: serif;
            line-height: 8px;
            text-align: center;
        }

        @keyframes rise {
            0% {
                transform: translateY(0) scale(1);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(-200px) scale(0.3);
                opacity: 0;
            }
        }

        /* Âä®ÊÄÅÂÆùÁÆ± - ÁõñÂ≠êÂä®Áîª */
        .chest-lid {
            transform-origin: 48px 120px; /* Â∑¶‰æßÈì∞Èìæ‰ΩçÁΩÆ */
            animation: lid-open-close 4s ease-in-out infinite;
        }

        @keyframes lid-open-close {
            0%, 100% {
                transform: rotate(0deg);
            }
            50% {
                transform: rotate(-15deg);
            }
        }

        .treasure-illustration svg .fill-box-body {
            fill: #D4C4A8;
            stroke: #8b7355;
        }

        .treasure-illustration svg .fill-box-lid {
            fill: #C9B896;
            stroke: #8b7355;
        }

        .treasure-illustration svg .fill-lock {
            fill: #C9A961;
            stroke: #8b7355;
        }

        .treasure-illustration svg .fill-magic-circle {
            fill: rgba(201, 169, 97, 0.15);
            stroke: #8b7355;
        }

        .treasure-illustration svg .decorative {
            stroke: #8b7355;
            stroke-width: 1.5;
        }

        .treasure-count {
            font-size: 13px;
            color: #8b7355;
            margin-top: 32px;
            letter-spacing: 1px;
        }

        .empty-state {
            text-align: center;
            color: #8b7355;
            font-size: 15px;
            margin-bottom: 32px;
            font-style: italic;
        }

        /* ==================== ÊäΩÂèñÈ°µ ==================== */
        #drawPage {
            display: flex;
            flex-direction: column;
        }

        .draw-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 24px;
        }

        .draw-animation {
            width: 280px;
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 32px;
            position: relative;
        }

        /* Â§ñÂúà - ÊÖ¢ÈÄüÊóãËΩ¨ */
        .outer-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: spin-slow 8s linear infinite;
        }

        /* ‰∏≠Âúà - ‰∏≠ÈÄüÂèçÂêëÊóãËΩ¨ */
        .middle-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: spin-reverse 5s linear infinite;
        }

        /* ÂÜÖÂúà - Âø´ÈÄüÊóãËΩ¨ + ËÑâÂä® */
        .inner-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: spin-fast 3s linear infinite, pulse 2s ease-in-out infinite;
        }

        /* Á¨¶ÊñáÂúà - ‰∏≠ÈÄüÊóãËΩ¨ */
        .rune-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: spin-medium 6s linear infinite;
        }

        /* ‰∏≠ÂøÉÊòü - ËÑâÂä® + ÊÖ¢ÈÄüÊóãËΩ¨ */
        .center-star {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: spin-slow 10s linear infinite, pulse-star 3s ease-in-out infinite;
        }

        /* Âä®ÁîªÂÆö‰πâ */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes spin-medium {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes spin-fast {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes spin-reverse {
            from { transform: rotate(360deg); }
            to { transform: rotate(0deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.08) rotate(180deg); }
        }

        @keyframes pulse-star {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.9; }
            50% { transform: scale(1.15) rotate(180deg); opacity: 1; }
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .draw-text {
            font-size: 15px;
            color: #8b7355;
            font-style: italic;
            text-align: center;
        }

        /* ==================== ÊàëÁöÑÈ°µ ==================== */
        #profilePage {
            display: flex;
            flex-direction: column;
        }

        .profile-content {
            flex: 1;
            padding: 64px 20px 20px;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(61, 47, 47, 0.2);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            margin: 0 auto 12px;
            border: 2px solid rgba(61, 47, 47, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            position: relative;
        }

        .profile-avatar svg {
            width: 50px;
            height: 50px;
            stroke: #8b7355;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .profile-name {
            font-family: 'Noto Serif SC', serif;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #3D2F2F;
        }

        .profile-id {
            font-size: 12px;
            color: #8b7355;
            font-family: 'Courier New', monospace;
        }

        .stats-section {
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .stat-item {
            padding: 16px;
            background: #F5F2EA;
            border: 2px solid rgba(61, 47, 47, 0.15);
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-family: 'Noto Serif SC', serif;
            font-size: 28px;
            font-weight: 700;
            color: #C9A961;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            color: #8b7355;
            letter-spacing: 0.5px;
        }

        .settings-section {
            margin-top: 20px;
        }

        .section-title {
            font-size: 12px;
            color: #8b7355;
            letter-spacing: 1px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '';
            width: 20px;
            height: 2px;
            background: #8b7355;
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(212, 207, 195, 0.5);
            cursor: pointer;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .setting-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8b7355;
            font-size: 18px;
        }

        .setting-icon svg {
            width: 22px;
            height: 22px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .setting-label {
            font-size: 15px;
            color: #3D2F2F;
        }

        .setting-label.danger {
            color: #A64B3A;
        }

        .setting-arrow {
            color: #8b7355;
            font-size: 18px;
        }

        /* Èü≥È¢ëËÆæÁΩÆÈ°πÔºàËÉåÊôØÈü≥‰πê„ÄÅ‰∫§‰∫íÈü≥ÊïàÔºâ */
        .audio-setting-item {
            padding: 16px 0;
            border-bottom: 1px solid rgba(212, 207, 195, 0.5);
        }

        .audio-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            max-width: 200px;
        }

        .volume-icon-btn {
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            color: #8b7355;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .volume-icon-btn:hover {
            color: #C9A961;
            transform: scale(1.1);
        }

        .volume-icon-btn:active {
            transform: scale(0.95);
        }

        .volume-icon-btn svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* ÈùôÈü≥Áä∂ÊÄÅ */
        .volume-icon-btn.muted svg path:nth-child(2),
        .volume-icon-btn.muted svg path:nth-child(3) {
            display: none;
        }

        .volume-slider-container {
            flex: 1;
            min-width: 80px;
        }

        .volume-value {
            font-size: 12px;
            color: #8b7355;
            min-width: 38px;
            text-align: right;
            flex-shrink: 0;
        }

        /* Èü≥ÈáèÊéßÂà∂ÔºàÊóßÊ†∑ÂºèÔºå‰øùÁïôÂÖºÂÆπÔºâ */
        .volume-control {
            padding: 16px 0;
            border-bottom: 1px solid rgba(212, 207, 195, 0.5);
        }

        .volume-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #8b7355;
            margin-bottom: 8px;
            padding: 0 4px;
        }

        .volume-slider {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(212, 207, 195, 0.3);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #C9A961;
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }

        .volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #C9A961;
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }

        .volume-slider::-moz-range-thumb:hover {
            transform: scale(1.2);
        }

        /* ==================== ÈÅÆÁΩ©ÂíåÂºπÁ™ó ==================== */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 500;
            animation: fadeIn 0.3s ease;
        }

        @media (min-width: 768px) {
            .overlay {
                position: absolute;
                border-radius: 32px;
            }
        }

        .overlay.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ÂàÜ‰∫´Èù¢ÊùøÈÅÆÁΩ©Â±Ç */
        .share-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 650;
            animation: fadeIn 0.3s ease;
        }

        @media (min-width: 768px) {
            .share-overlay {
                border-radius: 32px;
            }
        }

        .share-overlay.active {
            display: block;
        }

        /* ÂÆùËóèÈ¢ÑËßàÂºπÁ™ó */
        .treasure-preview-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 340px;
            max-height: 85vh;
            overflow-y: auto;
            background: #E8E4D9;
            border: none;
            border-radius: 16px;
            padding: 40px 24px 24px;  /* Â¢ûÂä†È°∂ÈÉ®ÁïôÁôΩ‰ªé28pxÂà∞40px */
            z-index: 600;
            animation: scaleIn 0.4s ease;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            position: relative;
        }

        @media (min-width: 768px) {
            .treasure-preview-modal {
                max-width: 300px;
            }
        }

        .treasure-preview-modal.active {
            display: block;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            color: #8b7355;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            line-height: 1;
        }

        .modal-close:active {
            color: #5a4a3a;
        }

        .preview-treasure-icon {
            width: 100px;  /* ‰ªé200pxÁº©Â∞èÂà∞100px */
            height: 100px;
            margin: 0 auto 24px;
            position: relative;
        }

        /* È≠îÊ≥ïÈòµÂÆπÂô® */
        .magic-circle-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        /* Ê†∑Âºè1: ÁªèÂÖ∏ÂÖ≠ËäíÊòüÁéØ */
        .circle-classic .outer-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid #C9A961;
            border-radius: 50%;
            opacity: 0.8;
            animation: rotate 20s linear infinite;
        }

        .circle-classic .inner-ring {
            position: absolute;
            width: 85%;
            height: 85%;
            left: 7.5%;
            top: 7.5%;
            border: 2px solid #C9A961;
            border-radius: 50%;
            opacity: 0.6;
            animation: rotate-reverse 15s linear infinite;
        }

        .circle-classic .dots-container {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: rotate 30s linear infinite;
        }

        .circle-classic .dot {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #C9A961;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(201, 169, 97, 0.6);
        }

        /* Ê†∑Âºè2: Á¨¶Êñá‰∏âÁéØ */
        .circle-rune .ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid #C9A961;
            border-radius: 50%;
        }

        .circle-rune .ring-1 { 
            opacity: 0.8;
            animation: rotate 20s linear infinite;
        }
        .circle-rune .ring-2 { 
            width: 90%;
            height: 90%;
            left: 5%;
            top: 5%;
            opacity: 0.6;
            border-style: dashed;
            animation: rotate-reverse 25s linear infinite;
        }
        .circle-rune .ring-3 { 
            width: 75%;
            height: 75%;
            left: 12.5%;
            top: 12.5%;
            opacity: 0.4;
            animation: rotate 18s linear infinite;
        }

        .circle-rune .rune-container {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: rotate 35s linear infinite;
        }

        .circle-rune .rune-symbol {
            position: absolute;
            font-size: 12px;  /* ‰ªé14pxÁº©Â∞èÂà∞12px */
            color: #C9A961;
            font-weight: bold;
            text-shadow: 0 0 6px rgba(201, 169, 97, 0.6);
        }

        /* Ê†∑Âºè3: Èò¥Èò≥Ëû∫ÊóãÁéØ */
        .circle-spiral .spiral-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid transparent;
            border-top-color: #C9A961;
            border-right-color: #C9A961;
            border-radius: 50%;
            opacity: 0.7;
            animation: rotate 20s linear infinite;
        }

        .circle-spiral .spiral-ring-2 {
            position: absolute;
            width: 85%;
            height: 85%;
            left: 7.5%;
            top: 7.5%;
            border: 3px solid transparent;
            border-left-color: #C9A961;
            border-bottom-color: #C9A961;
            border-radius: 50%;
            opacity: 0.5;
            animation: rotate-reverse 15s linear infinite;
        }

        /* Ê†∑Âºè6: Âè§ÊñáÂ∞ÅÂç∞ÁéØ */
        .circle-ancient .ancient-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px double #C9A961;
            border-radius: 50%;
            opacity: 0.7;
            animation: rotate 20s linear infinite;
        }

        .circle-ancient .inner-ancient {
            position: absolute;
            width: 80%;
            height: 80%;
            left: 10%;
            top: 10%;
            border: 2px solid #C9A961;
            border-radius: 50%;
            opacity: 0.5;
            animation: rotate-reverse 15s linear infinite;
        }

        .circle-ancient .ancient-container {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: rotate 40s linear infinite;
        }

        .circle-ancient .ancient-symbol {
            position: absolute;
            font-size: 18px;
            color: #C9A961;
            font-family: serif;
            text-shadow: 0 0 8px rgba(201, 169, 97, 0.6);
        }

        /* Á≤íÂ≠êÂÆπÂô® */
        .particles-container {
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            z-index: 5;
            pointer-events: none;
        }

        /* Âçï‰∏™Á≤íÂ≠ê */
        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #C9A961;
            border-radius: 50%;
            left: 50%;
            top: 50%;
            opacity: 0;
            box-shadow: 0 0 4px rgba(201, 169, 97, 0.8);
        }

        /* Á≤íÂ≠êÂèëÊï£Âä®Áîª */
        @keyframes particle-burst {
            0% {
                transform: translate(-50%, -50%) translate(0, 0) scale(1);
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) translate(var(--tx), var(--ty)) scale(0.2);
                opacity: 0;
            }
        }

        /* ÂÆùËóèSVGÂõæÊ†á */
        .treasure-svg-icon {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            width: 60px;  /* ‰ªé120pxÁº©Â∞èÂà∞60px */
            height: 60px;
            filter: drop-shadow(0 2px 8px rgba(201, 169, 97, 0.4));
            /* animation: treasure-float 3s ease-in-out infinite; Â∑≤ÁßªÈô§ÊµÆÂä® */
        }

        /* ÂÆùËóèÊµÆÂä®Âä®Áîª - ‰ª•ÂúÜÂøÉ‰∏∫Âü∫ÂáÜ‰∏ä‰∏ãÊµÆÂä® */
        @keyframes treasure-float {
            0%, 100% {
                transform: translate(-50%, calc(-50% + 4px));  /* Âêë‰∏ã4px */
            }
            50% {
                transform: translate(-50%, calc(-50% - 4px));  /* Âêë‰∏ä4px */
            }
        }

        /* ÊóãËΩ¨Âä®Áîª */
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes rotate-reverse {
            from { transform: rotate(360deg); }
            to { transform: rotate(0deg); }
        }

        .preview-treasure-name {
            font-family: 'Noto Serif SC', serif;
            font-size: 20px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 16px;
            color: #3D2F2F;
            letter-spacing: 1px;
        }

        .preview-treasure-content {
            font-size: 14px;
            line-height: 1.7;
            color: #3D2F2F;
            margin-bottom: 16px;
            padding: 14px;
            background: rgba(61, 47, 47, 0.03);
            border: 1px solid rgba(61, 47, 47, 0.08);
            border-radius: 10px;
            max-height: 140px;
            overflow-y: auto;
        }

        .preview-treasure-meta {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(61, 47, 47, 0.08);
        }

        .preview-emotion-tag {
            padding: 6px 14px;
            color: #FFFFFF;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        /* ÊÉÖÁª™tagËÉåÊôØËâ≤Áî± inline style ÁöÑ emotionColor ÊéßÂà∂ÔºåÊ≠§Â§Ñ‰ªÖÂÅöÂÖúÂ∫ï */
        .preview-emotion-tag { background: #C9A961; }

        .preview-treasure-time {
            font-size: 11px;
            color: #8b7355;
            font-family: 'Courier New', monospace;
            opacity: 0.8;
        }

        .preview-crow-comment {
            font-size: 13px;
            color: #8b7355;
            font-style: italic;
            text-align: center;
            margin-bottom: 24px;
            opacity: 0.9;
        }

        .preview-actions {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-bottom: 16px;
        }

        .preview-btn {
            width: 100%;
            height: 50px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .preview-btn.save {
            background: #C9A961;
            color: #3D2F2F;
            border: none;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(201, 169, 97, 0.3);
        }

        .preview-btn.save:active {
            transform: scale(0.98);
            box-shadow: 0 1px 4px rgba(201, 169, 97, 0.3);
        }

        /* ÂÆùËóèÂç°ÂºπÁ™óÔºàÊäΩÂèñÂêéÔºâ */
        .treasure-card-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 340px;
            max-height: 85vh;
            overflow-y: auto;
            background: #E8E4D9;
            border: none;
            border-radius: 16px;
            padding: 40px 24px 24px;  /* Â¢ûÂä†È°∂ÈÉ®ÁïôÁôΩ‰ªé28pxÂà∞40px */
            z-index: 600;
            animation: scaleIn 0.4s ease;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        @media (min-width: 768px) {
            .treasure-card-modal {
                max-width: 300px;
            }
        }

        .treasure-card-modal.active {
            display: block;
        }

        .modal-close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 36px;
            height: 36px;
            background: rgba(61, 47, 47, 0.06);
            border: none;
            border-radius: 18px;
            color: #3D2F2F;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            line-height: 1;
        }

        .modal-close-btn:active {
            transform: scale(0.92);
            background: rgba(61, 47, 47, 0.1);
        }

        .modal-handle {
            display: none;
        }

        .treasure-card-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 24px;
            position: relative;
        }

        .treasure-card-name {
            font-family: 'Noto Serif SC', serif;
            font-size: 22px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            color: #3D2F2F;
            letter-spacing: 2px;
        }

        .treasure-card-content {
            font-size: 15px;
            line-height: 1.8;
            color: #3D2F2F;
            margin: 20px 0;
            padding: 20px;
            background: #F5F2EA;
            border: 1px solid #D4CFC3;
            border-radius: 8px;
        }

        /* ÂÆùËóèÂç°Â∫ïÈÉ®Êìç‰ΩúÂõæÊ†áÊ†è */
        .treasure-card-actions {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 32px;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid rgba(61, 47, 47, 0.1);
        }

        /* ÂõæÊ†áÊåâÈíÆÈÄöÁî®Ê†∑Âºè */
        .icon-btn {
            width: 44px;
            height: 44px;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .icon-btn:active {
            transform: scale(0.9);
        }

        .icon-btn svg {
            width: 28px;
            height: 28px;
            stroke-width: 1.8;
            transition: all 0.3s ease;
        }

        /* ÊäΩÂèñÁïåÈù¢ÁöÑÊõ¥Â∞èÂõæÊ†á */
        .treasure-card-actions:not(.preview-icons) .icon-btn svg {
            width: 20px;
            height: 20px;
        }

        .treasure-card-actions:not(.preview-icons) {
            gap: 24px;
        }

        /* ÂàÜ‰∫´ÂõæÊ†á */
        .icon-btn.share-icon svg {
            stroke: #8b7355;
        }

        .icon-btn.share-icon:active svg {
            stroke: #5a4a3a;
        }

        /* ‰∏ãËΩΩÂõæÊ†á */
        .icon-btn.download-icon svg {
            stroke: #8b7355;
        }

        .icon-btn.download-icon:active svg {
            stroke: #5a4a3a;
        }

        /* Âà†Èô§ÂõæÊ†á */
        .icon-btn.delete-icon svg {
            stroke: #A64B3A;
        }

        .icon-btn.delete-icon:active svg {
            stroke: #8B3A2A;
        }

        /* ÂèñÊ∂àÂõæÊ†á */
        .icon-btn.cancel-icon svg {
            stroke: #A64B3A;
        }

        .icon-btn.cancel-icon:active svg {
            stroke: #8B3A2A;
        }

        /* È¢ÑËßàÁïåÈù¢ÁöÑÂÖ≥Èó≠ÊåâÈíÆ‰ºòÂåñ */
        .preview-close-btn {
            width: 36px;
            height: 36px;
            background: rgba(166, 75, 58, 0.08);
            border-radius: 18px;
            font-size: 22px;
            color: #A64B3A;
            transition: all 0.2s ease;
        }

        .preview-close-btn:active {
            background: rgba(166, 75, 58, 0.15);
            color: #8B3A2A;
            transform: scale(0.92);
        }

        /* ÂàÜ‰∫´Èù¢Êùø */
        .share-panel {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 85%;
            max-width: 300px;
            background: #E8E4D9;
            border-radius: 16px;
            padding: 28px 20px 24px;
            z-index: 700;
            animation: scaleIn 0.3s ease;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        @media (min-width: 768px) {
            .share-panel {
                max-width: 280px;
            }
        }

        .share-panel.active {
            display: block;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .share-panel-title {
            font-family: 'Noto Serif SC', serif;
            font-size: 16px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            color: #3D2F2F;
            letter-spacing: 2px;
        }

        .share-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 18px;
        }

        .share-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 12px 6px;
            border-radius: 10px;
            transition: all 0.2s ease;
            background: transparent;
        }

        .share-option:active {
            background: rgba(139, 115, 85, 0.08);
            transform: scale(0.95);
        }

        .share-option-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .share-option-icon svg {
            width: 40px;
            height: 40px;
        }

        .share-option-label {
            font-size: 11px;
            color: #5a4a3a;
            letter-spacing: 0.5px;
            text-align: center;
        }

        .share-panel-close {
            width: 100%;
            height: 44px;
            background: transparent;
            border: 2px solid #3D2F2F;
            border-radius: 10px;
            color: #3D2F2F;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            letter-spacing: 1px;
            transition: all 0.2s ease;
        }

        .share-panel-close:active {
            background: rgba(61, 47, 47, 0.05);
            transform: scale(0.98);
        }

        /* Á°ÆËÆ§ÂØπËØùÊ°Ü */
        .confirm-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #E8E4D9;
            border: 3px solid #3D2F2F;
            border-radius: 8px;
            padding: 32px 24px;
            width: 85%;
            max-width: 300px;
            z-index: 700;
        }

        @media (min-width: 768px) {
            .confirm-dialog {
                position: absolute;
                max-width: 280px;
            }
        }

        .confirm-dialog.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .confirm-title {
            font-family: 'Noto Serif SC', serif;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            text-align: center;
            color: #3D2F2F;
            letter-spacing: 2px;
        }

        .confirm-message {
            font-size: 14px;
            color: #5a4a3a;
            text-align: center;
            margin-bottom: 28px;
            white-space: pre-line;
            line-height: 1.6;
        }

        .confirm-buttons {
            display: flex;
            gap: 12px;
        }

        .confirm-btn {
            flex: 1;
            height: 46px;
            border: 2px solid #3D2F2F;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            letter-spacing: 1px;
        }

        .confirm-btn.cancel {
            background: transparent;
            color: #3D2F2F;
        }

        .confirm-btn.confirm {
            background: #C9A961;
            color: #3D2F2F;
        }

        .confirm-btn.danger {
            background: #A64B3A;
            color: #E8E4D9;
        }

        /* ToastÊèêÁ§∫ */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 16px 32px;
            background: rgba(61, 47, 47, 0.95);
            color: #E8E4D9;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            animation: fadeInOut 2s ease;
            letter-spacing: 1px;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            10%, 90% { opacity: 1; }
        }

        /* AIËÆæÁΩÆÊ†∑ÂºèÂ∑≤ÁßªÈô§ - ÂºÄÂèëËÄÖÊ®°Âºè */
            box-shadow: 0 2px 8px rgba(201, 169, 97, 0.3);
        }

        .api-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(201, 169, 97, 0.4);
        }

        .api-btn:active {
            transform: scale(0.98);
        }

        .ai-status {
            font-size: 16px;
            line-height: 1;
        }

        /* ‚úÖ‰øÆÂ§çÔºöËÆ©ÁôæÂàÜÊØîÈ´òÂ∫¶Âú®ÊâãÊú∫‰∏äÊúâ"ÂèÇÁÖßÁâ©" */
        html, body {
            height: 100%;
        }

        /* ‚úÖ‰øÆÂ§çÔºöÊâãÊú∫Á´ØÁªô phone-screen ‰∏Ä‰∏™ÊòéÁ°Æ heightÔºà‰∏çË¶ÅÂè™Áî® min-heightÔºâ */
        @media (max-width: 767px) {
            #phone-screen {
                height: 100vh;      /* ÂÖ≥ÈîÆ */
                min-height: 100vh;  /* ‰Ω†ÂéüÊú¨Â∞±ÊúâÔºå‰øùÁïô‰πüË°å */
            }
            #app {
                height: 100%;
                min-height: 100vh;
                position: relative; /* ËÆ©ÁªùÂØπÂÆö‰ΩçÁöÑ page ÊúâÂèÇÁÖß */
            }
        }

        /* ÁÅ´Ëä±ÂõõÂ∞ÑÁÇπÂáªÊïàÊûú */
        .spark {
            position: absolute;
            width: 3px;
            height: 12px;
            background: linear-gradient(to bottom, #F4D06F, #E8A95D);
            pointer-events: none;
            z-index: 9999;
        }

        @keyframes spark-fly {
            0% {
                transform: translate(0, 0) rotate(var(--rotation)) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) rotate(var(--rotation)) scale(0);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div id="phone-simulator">
        <div id="phone-screen">
            <div id="app">
                <!-- ËÆ∞ÂΩïÈ°µ -->
                <div id="recordPage" class="page active">
                    <div class="record-content">
                        <div class="page-icon">
                            <svg viewBox="0 0 48 48">
                                <!-- Â§ñÂúÜ -->
                                <circle cx="24" cy="24" r="20" />
                                <!-- ÂÖ≠ËäíÊòü - ‰∏ä‰∏âËßí -->
                                <path d="M 24 8 L 38 32 L 10 32 Z" />
                                <!-- ÂÖ≠ËäíÊòü - ‰∏ã‰∏âËßí -->
                                <path d="M 24 40 L 10 16 L 38 16 Z" />
                                <!-- ÂÜÖÂúÜ -->
                                <circle cx="24" cy="24" r="8" />
                                <!-- Ë£ÖÈ•∞Â∞èÂúÜÁÇπ -->
                                <circle cx="24" cy="4" r="1.5" class="fill-eye" />
                                <circle cx="41.5" cy="14" r="1.5" class="fill-eye" />
                                <circle cx="41.5" cy="34" r="1.5" class="fill-eye" />
                                <circle cx="24" cy="44" r="1.5" class="fill-eye" />
                                <circle cx="6.5" cy="34" r="1.5" class="fill-eye" />
                                <circle cx="6.5" cy="14" r="1.5" class="fill-eye" />
                            </svg>
                        </div>
                        <div class="page-title">‰πåÈ∏¶ÁöÑÂÆùËóè</div>
                        <div class="page-subtitle">"Â∞ÜÊÉÖÁª™Êî∂Ëóè‰∫éÊó∂ÂÖâÁöÑÂÆùÁÆ±Ôºå<br>ÂæÖÂæÄÂêéÂ≤ÅÊúàÊÖ¢ÊÖ¢ÂêØÂ∞Å„ÄÇ"</div>

                        <div class="emotion-selector">
                            <div class="section-label">‰ªäÊó•Êê∫Êù•‰ΩïÁâ©Ôºü</div>
                            <div class="xy-container" id="xyPad">
                                <div class="xy-quadrant xy-q-rt"></div>
                                <div class="xy-quadrant xy-q-rb"></div>
                                <div class="xy-quadrant xy-q-lt"></div>
                                <div class="xy-quadrant xy-q-lb"></div>
                                <svg class="xy-grid-dots" xmlns="http://www.w3.org/2000/svg">
                                    <defs><pattern id="xydots" x="0" y="0" width="18" height="18" patternUnits="userSpaceOnUse"><circle cx="9" cy="9" r="0.8" fill="rgba(61,47,47,0.18)"/></pattern></defs>
                                    <rect width="100%" height="100%" fill="url(#xydots)"/>
                                </svg>
                                <div class="xy-axis-h"></div>
                                <div class="xy-axis-v"></div>
                                <div class="xy-legend xy-leg-xp">ÊÑâÊÇ¶</div>
                                <div class="xy-legend xy-leg-xn">‰∏çÈÄÇ</div>
                                <div class="xy-legend xy-leg-yp">ÊøÄÂä®</div>
                                <div class="xy-legend xy-leg-yn">Âπ≥Èùô</div>
                                <div class="xy-quad-label xy-ql-rt">ÂÖ¥Â•ã<br>ÂñúÊÇ¶</div>
                                <div class="xy-quad-label xy-ql-rb">Êª°Ë∂≥<br>ÂÆâÂÆÅ</div>
                                <div class="xy-quad-label xy-ql-lt">ÊÑ§ÊÄí<br>ÁÑ¶Ëôë</div>
                                <div class="xy-quad-label xy-ql-lb">ÊÇ≤‰º§<br>Áñ≤ÊÉ´</div>
                                <div class="xy-crosshair-h" id="xyCrossH"></div>
                                <div class="xy-crosshair-v" id="xyCrossV"></div>
                                <div class="xy-glow" id="xyGlow"></div>
                                <div class="xy-dot" id="xyDot"></div>
                                <div class="xy-bubble" id="xyBubble"></div>
                            </div>
                            <div class="xy-readout">
                                <div class="xy-readout-item">ÊÑâÊÇ¶Â∫¶ <span id="xyValX">‚Äî</span></div>
                                <div class="xy-hint" id="xyHint">ÁÇπÂáªÈÄâÊã©‰Ω†Ê≠§ÂàªÁöÑÁä∂ÊÄÅ</div>
                                <div class="xy-readout-item">ËÉΩÈáèÊÑü <span id="xyValY">‚Äî</span></div>
                            </div>
                        </div>

                        <div class="input-area">
                            <div class="section-label">Èì≠ÂàªÊ≠§ÂàªÂøÉÁª™</div>
                            <textarea class="text-input" id="contentInput" placeholder="ÂÜô‰∏ã‰Ω†ÊÉ≥ËÆ∞‰ΩèÁöÑ..."></textarea>
                        </div>

                        <button class="primary-button" id="generateBtn" disabled>ÁîüÊàêÂÆùËóè</button>
                    </div>
                </div>

                <!-- ÂÆùÁÆ±È°µ -->
                <div id="treasureBoxPage" class="page">
                    <div class="treasure-box-content" id="treasureBoxContent"></div>
                </div>

                <!-- ÊäΩÂèñÈ°µ -->
                <div id="drawPage" class="page">
                    <div class="nav-bar">
                        <button class="back-btn" onclick="showPage('treasureBox')">‚Üê</button>
                        <div class="title">ÊäΩÂèñ‰∏≠</div>
                    </div>

                    <div class="draw-content">
                        <div class="draw-animation">
                            <!-- Â§ñÂúà - ÊÖ¢ÈÄüÊóãËΩ¨ -->
                            <svg class="outer-ring" viewBox="0 0 280 280" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="140" cy="140" r="135" fill="none" stroke="#C9A961" stroke-width="2"/>
                                <circle cx="140" cy="140" r="125" fill="none" stroke="#C9A961" stroke-width="1" stroke-dasharray="8,8"/>
                                
                                <!-- Âõõ‰∏™Êñπ‰ΩçÁöÑË£ÖÈ•∞Á¨¶Âè∑ -->
                                <text x="140" y="20" font-size="18" fill="#C9A961" text-anchor="middle">‚ú¶</text>
                                <text x="260" y="145" font-size="18" fill="#C9A961" text-anchor="middle">‚ú¶</text>
                                <text x="140" y="270" font-size="18" fill="#C9A961" text-anchor="middle">‚ú¶</text>
                                <text x="20" y="145" font-size="18" fill="#C9A961" text-anchor="middle">‚ú¶</text>
                            </svg>

                            <!-- Á¨¶ÊñáÂúà - ‰∏≠ÈÄüÊóãËΩ¨ -->
                            <svg class="rune-ring" viewBox="0 0 280 280" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="140" cy="140" r="107" fill="none" stroke="#5D4E37" stroke-width="1.5"/>
                                
                                <!-- ÂÖ´‰∏™Êñπ‰ΩçÁöÑÁ¨¶Êñá -->
                                <text x="140" y="45" font-size="22" fill="#5D4E37" text-anchor="middle" font-family="serif">·ö±</text>
                                <text x="199" y="81" font-size="22" fill="#5D4E37" text-anchor="middle" font-family="serif">·ö®</text>
                                <text x="233" y="145" font-size="22" fill="#5D4E37" text-anchor="middle" font-family="serif">·öπ</text>
                                <text x="199" y="209" font-size="22" fill="#5D4E37" text-anchor="middle" font-family="serif">·õñ</text>
                                <text x="140" y="245" font-size="22" fill="#5D4E37" text-anchor="middle" font-family="serif">·öæ</text>
                                <text x="81" y="209" font-size="22" fill="#5D4E37" text-anchor="middle" font-family="serif">·õè</text>
                                <text x="47" y="145" font-size="22" fill="#5D4E37" text-anchor="middle" font-family="serif">·ö±</text>
                                <text x="81" y="81" font-size="22" fill="#5D4E37" text-anchor="middle" font-family="serif">·õñ</text>
                            </svg>

                            <!-- ‰∏≠Âúà - ‰∏≠ÈÄüÂèçÂêëÊóãËΩ¨ -->
                            <svg class="middle-ring" viewBox="0 0 280 280" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="140" cy="140" r="93" fill="none" stroke="#C9A961" stroke-width="2"/>
                                <circle cx="140" cy="140" r="84" fill="none" stroke="#5D4E37" stroke-width="1" stroke-dasharray="5,5"/>
                                
                                <!-- ÂÖ≠‰∏™Â∞èÂúÜÁÇπ -->
                                <circle cx="140" cy="47" r="4" fill="#C9A961"/>
                                <circle cx="221" cy="99" r="4" fill="#C9A961"/>
                                <circle cx="221" cy="181" r="4" fill="#C9A961"/>
                                <circle cx="140" cy="233" r="4" fill="#C9A961"/>
                                <circle cx="59" cy="181" r="4" fill="#C9A961"/>
                                <circle cx="59" cy="99" r="4" fill="#C9A961"/>
                            </svg>

                            <!-- ÂÜÖÂúà - Âø´ÈÄüÊóãËΩ¨ + ËÑâÂä® -->
                            <svg class="inner-ring" viewBox="0 0 280 280" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="140" cy="140" r="70" fill="none" stroke="#5D4E37" stroke-width="2"/>
                                <circle cx="140" cy="140" r="61" fill="none" stroke="#C9A961" stroke-width="1" stroke-dasharray="4,4"/>
                            </svg>

                            <!-- ‰∏≠ÂøÉÂÖ≠ËäíÊòü - ËÑâÂä® + ÊÖ¢ÈÄüÊóãËΩ¨ -->
                            <svg class="center-star" viewBox="0 0 280 280" xmlns="http://www.w3.org/2000/svg">
                                <!-- Ê†áÂáÜÂÖ≠ËäíÊòü - ‰ΩøÁî®polyline‰ª£ÊõøpathÈÅøÂÖçÁ∫øÊù°Âª∂‰º∏ -->
                                <!-- ‰∏ä‰∏âËßí -->
                                <polyline points="140,84 188,168 92,168 140,84" 
                                      fill="none" stroke="#C9A961" stroke-width="3" stroke-linejoin="miter"/>
                                
                                <!-- ‰∏ã‰∏âËßí -->
                                <polyline points="140,196 92,112 188,112 140,196" 
                                      fill="none" stroke="#C9A961" stroke-width="3" stroke-linejoin="miter"/>
                                
                                <!-- ÂÜÖÈÉ®Ê≠£ÂÖ≠ËæπÂΩ¢ -->
                                <polyline points="140,116 161,127 161,153 140,164 119,153 119,127 140,116" 
                                      fill="none" stroke="#5D4E37" stroke-width="2" stroke-linejoin="miter"/>
                                
                                <!-- ÂÖ≠‰∏™‰∫§ÁÇπÁöÑÂ∞èÂúÜ -->
                                <circle cx="140" cy="116" r="3.5" fill="#C9A961"/>
                                <circle cx="161" cy="127" r="3.5" fill="#C9A961"/>
                                <circle cx="161" cy="153" r="3.5" fill="#C9A961"/>
                                <circle cx="140" cy="164" r="3.5" fill="#C9A961"/>
                                <circle cx="119" cy="153" r="3.5" fill="#C9A961"/>
                                <circle cx="119" cy="127" r="3.5" fill="#C9A961"/>
                                
                                <!-- ‰∏≠ÂøÉÂúÜ -->
                                <circle cx="140" cy="140" r="19" fill="none" stroke="#5D4E37" stroke-width="2"/>
                                <circle cx="140" cy="140" r="11" fill="#C9A961" opacity="0.6"/>
                                <circle cx="140" cy="140" r="6" fill="#5D4E37"/>
                            </svg>
                        </div>
                        <div class="draw-text">ÁúãÁúãËøôÊ¨°‰ºöËé∑Âèñ‰ªÄ‰πà„ÄÇ</div>
                    </div>
                </div>

                <!-- ÊàëÁöÑÈ°µ -->
                <div id="profilePage" class="page">
                    <div class="profile-content">
                        <div class="profile-header">
                            <div class="profile-avatar">
                                <svg viewBox="0 0 48 48">
                                    <circle cx="24" cy="18" r="10" />
                                    <path d="M 8 42 Q 8 30 24 30 Q 40 30 40 42" />
                                </svg>
                            </div>
                            <div class="profile-name">Êº´ÂÆ¢ÊóÖ‰∫∫</div>
                            <div class="profile-id">ÁºñÂè∑Ôºö@guest</div>
                        </div>

                        <div class="stats-section">
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value" id="profileTreasureCount">0</div>
                                    <div class="stat-label">ÂÆùËóèÊÄªÊï∞</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="profileRecordDays">0</div>
                                    <div class="stat-label">ËÆ∞ÂΩïÂ§©Êï∞</div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <!-- ËÉåÊôØÈü≥‰πê -->
                            <div class="audio-setting-item">
                                <div class="audio-header">
                                    <div class="setting-left">
                                        <div class="setting-icon">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M9 18V5l12-2v13" />
                                                <circle cx="6" cy="18" r="3" />
                                                <circle cx="18" cy="16" r="3" />
                                            </svg>
                                        </div>
                                        <div class="setting-label">ËÉåÊôØÈü≥‰πê</div>
                                    </div>
                                    <div class="audio-controls">
                                        <button class="volume-icon-btn" onclick="toggleMusic()" id="musicIconBtn">
                                            <svg viewBox="0 0 24 24" id="musicVolumeIcon">
                                                <!-- ÂñáÂè≠ -->
                                                <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                                                <!-- Èü≥Ê≥¢ -->
                                                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                                                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                                            </svg>
                                        </button>
                                        <div class="volume-slider-container">
                                            <input type="range" id="volumeSlider" min="0" max="100" value="30" class="volume-slider" oninput="updateVolume(this.value)">
                                        </div>
                                        <span class="volume-value" id="volumeValue">30%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ‰∫§‰∫íÈü≥Êïà -->
                            <div class="audio-setting-item">
                                <div class="audio-header">
                                    <div class="setting-left">
                                        <div class="setting-icon">
                                            <svg viewBox="0 0 24 24">
                                                <circle cx="12" cy="12" r="10"/>
                                                <line x1="12" y1="8" x2="12" y2="12"/>
                                                <line x1="12" y1="16" x2="12.01" y2="16"/>
                                            </svg>
                                        </div>
                                        <div class="setting-label">‰∫§‰∫íÈü≥Êïà</div>
                                    </div>
                                    <div class="audio-controls">
                                        <button class="volume-icon-btn" onclick="toggleSFX()" id="sfxIconBtn">
                                            <svg viewBox="0 0 24 24" id="sfxVolumeIcon">
                                                <!-- ÂñáÂè≠ -->
                                                <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                                                <!-- Èü≥Ê≥¢ -->
                                                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                                                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                                            </svg>
                                        </button>
                                        <div class="volume-slider-container">
                                            <input type="range" id="sfxVolumeSlider" min="0" max="100" value="100" class="volume-slider" oninput="updateSFXVolume(this.value)">
                                        </div>
                                        <span class="volume-value" id="sfxVolumeValue">100%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- AIËÆæÁΩÆÂ∑≤ÁßªÈô§ - ÂºÄÂèëËÄÖÊ®°Âºè -->
                            
                            <div class="setting-item" onclick="showAbout()">
                                <div class="setting-left">
                                    <div class="setting-icon">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
                                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
                                            <line x1="10" y1="10" x2="16" y2="10" />
                                            <line x1="10" y1="14" x2="16" y2="14" />
                                        </svg>
                                    </div>
                                    <div class="setting-label">‰ΩøÁî®ÊâãÂÜå</div>
                                </div>
                                <div class="setting-arrow">‚Üí</div>
                            </div>

                            <div class="setting-item" onclick="confirmClearAll()">
                                <div class="setting-left">
                                    <div class="setting-icon">
                                        <svg viewBox="0 0 24 24">
                                            <polyline points="3 6 5 6 21 6" />
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                            <line x1="10" y1="11" x2="10" y2="17" />
                                            <line x1="14" y1="11" x2="14" y2="17" />
                                        </svg>
                                    </div>
                                    <div class="setting-label danger">Ê∏ÖÁ©∫ÊâÄÊúâÂÆùËóè</div>
                                </div>
                                <div class="setting-arrow">‚Üí</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Â∫ïÈÉ®TabBar -->
                <div class="tab-bar">
                    <button class="tab-item active" onclick="showPage('record')">
                        <div class="tab-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M12 20h9" />
                                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
                            </svg>
                        </div>
                        <div>ËÆ∞ÂΩï</div>
                        <div class="tab-line"></div>
                    </button>
                    <button class="tab-item" onclick="showPage('treasureBox')">
                        <div class="tab-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                                <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                                <line x1="12" y1="22.08" x2="12" y2="12" />
                            </svg>
                        </div>
                        <div>ÂÆùÁÆ±</div>
                        <div class="tab-line"></div>
                    </button>
                    <button class="tab-item" onclick="showPage('profile')">
                        <div class="tab-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg>
                        </div>
                        <div>ÊàëÁöÑ</div>
                        <div class="tab-line"></div>
                    </button>
                </div>

                <!-- ÈÅÆÁΩ©Â±Ç -->
                <div class="overlay" id="overlay" onclick="closeModal()"></div>

                <!-- ÂÆùËóèÈ¢ÑËßàÂºπÁ™ó -->
                <div class="treasure-preview-modal" id="treasurePreviewModal"></div>

                <!-- ÂÆùËóèÂç°ÂºπÁ™ó -->
                <div class="treasure-card-modal" id="treasureCardModal"></div>

                <!-- Á°ÆËÆ§ÂØπËØùÊ°Ü -->
                <div class="confirm-dialog" id="confirmDialog"></div>
                
                <!-- ÂàÜ‰∫´Èù¢ÊùøÈÅÆÁΩ©Â±Ç -->
                <div class="share-overlay" id="shareOverlay" onclick="closeSharePanel()"></div>
                
                <!-- ÂàÜ‰∫´Èù¢Êùø -->
                <div class="share-panel" id="sharePanel">
                    <div class="share-panel-title">ÂàÜ‰∫´ÂÆùËóè</div>
                    <div class="share-options">
                        <div class="share-option" onclick="shareToWechat()">
                            <div class="share-option-icon">
                                <svg viewBox="0 0 24 24" fill="none">
                                    <!-- ÂæÆ‰ø°logoÔºö‰∏§‰∏™ÂØπËØùÊ∞îÊ≥°Èù†ËøëÊúâ‰∫§ÈõÜ -->
                                    <ellipse cx="7.5" cy="9.5" rx="4.5" ry="4" fill="#8b7355"/>
                                    <ellipse cx="15" cy="14" rx="4" ry="3.3" fill="#8b7355"/>
                                    <circle cx="6" cy="9" r="1" fill="white"/>
                                    <circle cx="9" cy="9" r="1" fill="white"/>
                                    <circle cx="13.5" cy="13.5" r="0.8" fill="white"/>
                                    <circle cx="16.5" cy="13.5" r="0.8" fill="white"/>
                                </svg>
                            </div>
                            <div class="share-option-label">ÂæÆ‰ø°</div>
                        </div>
                        <div class="share-option" onclick="shareToXiaohongshu()">
                            <div class="share-option-icon">
                                <svg viewBox="0 0 24 24" fill="none">
                                    <!-- Â∞èÁ∫¢‰π¶logoÔºöÂúÜËßíÊñπÂΩ¢+Â∞èÂ≠ó -->
                                    <rect x="4" y="4" width="16" height="16" rx="3" fill="#8b7355"/>
                                    <text x="12" y="13.5" text-anchor="middle" 
                                          font-size="4" font-weight="bold" fill="white" 
                                          letter-spacing="0.2">Â∞èÁ∫¢‰π¶</text>
                                </svg>
                            </div>
                            <div class="share-option-label">Â∞èÁ∫¢‰π¶</div>
                        </div>
                        <div class="share-option" onclick="shareToQQ()">
                            <div class="share-option-icon">
                                <svg viewBox="0 0 24 24" fill="none">
                                    <!-- QQ logoÔºö‰ºÅÈπÖÂ§¥Ë∫´Èù†Ëøë -->
                                    <ellipse cx="12" cy="9" rx="4.2" ry="3.5" fill="#8b7355"/>
                                    <ellipse cx="12" cy="15" rx="5.5" ry="5.5" fill="#8b7355"/>
                                    <ellipse cx="12" cy="15.5" rx="3.2" ry="3.8" fill="white"/>
                                    <circle cx="10" cy="8.5" r="1.2" fill="white"/>
                                    <circle cx="14" cy="8.5" r="1.2" fill="white"/>
                                    <circle cx="10" cy="8.5" r="0.6" fill="#5a4a3a"/>
                                    <circle cx="14" cy="8.5" r="0.6" fill="#5a4a3a"/>
                                    <ellipse cx="12" cy="11.5" rx="2.5" ry="1.3" fill="#C9A961"/>
                                    <ellipse cx="9" cy="20.5" rx="1.5" ry="0.8" fill="#C9A961"/>
                                    <ellipse cx="15" cy="20.5" rx="1.5" ry="0.8" fill="#C9A961"/>
                                </svg>
                            </div>
                            <div class="share-option-label">QQ</div>
                        </div>
                    </div>
                    <button class="share-panel-close" onclick="closeSharePanel()">ÂèñÊ∂à</button>
                </div>
                
                <!-- API KeyÂØπËØùÊ°ÜÂ∑≤ÁßªÈô§ - ÂºÄÂèëËÄÖÊ®°Âºè -->
            </div>
        </div>
    </div>

    <script>
        // ==================== AIÂ¢ûÂº∫ÈÖçÁΩÆ ====================
        
        // AIÈÖçÁΩÆ
        const AI_CONFIG = {
            provider: 'deepseek',
            // ‚úÖ Áîü‰∫ßÁéØÂ¢ÉÔºöÈÄöËøá Netlify Functions ‰ª£ÁêÜË∞ÉÁî®ÔºàÈÅøÂÖçÂú®ÂâçÁ´ØÊö¥Èú≤ API KeyÔºâ
            // Ôºànetlify.toml Â∑≤Êää /api/treasure ËΩ¨ÂèëÂà∞ /.netlify/functions/treasureÔºâ
            endpoint: '/api/treasure',
            model: 'deepseek-chat',
            maxTokens: 200,
            temperature: 0.8,
            timeout: 8000 // 8ÁßíË∂ÖÊó∂
        };
        
        // AI System Prompt
        const AI_SYSTEM_PROMPT = `‰Ω†ÊòØ‰∏ÄÂè™Á•ûÁßòÁöÑ‰πåÈ∏¶ÔºåË¥üË¥£‰∏∫Áî®Êà∑ÁöÑÊÉÖÁª™ËÆ∞ÂΩïËµã‰∫àÂÆùËóè‰πãÂêç„ÄÇ

ËßíËâ≤ËÆæÂÆöÔºö
- ‰Ω†ÊòØÂè§ËÄÅËÄåÊô∫ÊÖßÁöÑÂÆàÊä§ËÄÖ
- ‰Ω†ÁöÑËØ≠Ë®ÄÁÆÄÊ¥Å„ÄÅÂÖÖÊª°ËØóÊÑèÂíåÂì≤ÁêÜ
- ‰Ω†ÂñÑ‰∫éÂèëÁé∞Âπ≥Âá°‰∏≠ÁöÑÁèçË¥µ‰πãÂ§Ñ

‰ªªÂä°Ôºö
1. Ê†πÊçÆÁî®Êà∑ÁöÑÊÉÖÁª™ÂíåÂÜÖÂÆπÔºåÂàõÈÄ†‰∏Ä‰∏™Áã¨ÁâπÁöÑÂÆùËóèÂêçÁß∞Ôºà4-7‰∏™Â≠óÔºâ
2. ÂÜô‰∏ÄÂè•‰πåÈ∏¶ÁÇπËØÑÔºà15-30Â≠óÔºâÔºåÁªô‰∫àÊ∏©ÊöñÁöÑÈºìÂä±ÊàñÊ∑±ÂàªÁöÑÊ¥ûÂØü

ÂÆùËóèÂêçÁß∞Ë¶ÅÊ±ÇÔºö
- ÂøÖÈ°ªÊòØ 4-7 ‰∏™Â≠óÁöÑÂÖ∑‰ΩìÁâ©ÂìÅÂêçÁß∞
- Ê†ºÂºè‰∏•Ê†ºÈÅµÂæ™‰ª•‰∏ã‰∏§Áßç‰πã‰∏ÄÔºö
  ‚ë† ÂΩ¢ÂÆπËØç + ÂêçËØçÔºöÂ¶Ç"ÈáëËâ≤Ëä±ÁéØ"„ÄÅ"Á¢éË£ÇÁöÑÈáëÂ∏Å"„ÄÅ"ÂèëÂÖâÁ¨¶ÊñáÁü≥"
  ‚ë° ÂêçËØç‰øÆÈ•∞ÂêçËØçÔºàÂêçËØç + ÁöÑ/‰πã + ÂêçËØçÔºåÊàñÁõ¥Êé•ÁªÑÂêàÔºâÔºöÂ¶Ç"Ê∞¥Êô∂Á¨¶Êñá"„ÄÅ"ÂëºÂê∏Ê≤ôÊºè"„ÄÅ"ÊÄùÁª™‰πãÁì∂"
- ‰∏ª‰ΩìÂêçËØçÂøÖÈ°ª‰∏îÂè™ËÉΩ‰ªé‰ª•‰∏ãËØçÂ∫ì‰∏≠ÈÄâÂèñÔºå‰∏çÂæó‰ΩøÁî®ËØçÂ∫ì‰πãÂ§ñÁöÑËØç‰Ωú‰∏∫‰∏ª‰ΩìÔºö
  ÈáëÂ∏Å„ÄÅÁ°¨Â∏Å„ÄÅÈí±Â∏Å / ÁæΩÊØõ„ÄÅÁæΩÁøé / ÈÖíÊùØ„ÄÅÂú£ÊùØ / Áì∂„ÄÅÊºÇÊµÅÁì∂ / Ëä±ÁéØ„ÄÅËä±ÂÜ† /
  ÈìÉÈìõ„ÄÅÈ£éÈìÉ / Âç∑ËΩ¥„ÄÅÁæäÁöÆÂç∑ / ‰ø°‰ª∂„ÄÅ‰ø°Â∞Å / Êä§Á¨¶„ÄÅÁ¨¶Êñá„ÄÅÂ∞ÅÂç∞ / ÂÆùÁü≥„ÄÅÁê•ÁèÄ„ÄÅÁø°Áø† /
  Ê≤ôÊºè / Ê∞¥Êô∂ / ÊàíÊåá„ÄÅÊåáÁéØ / ÂÆùÁÆ±„ÄÅÊú®ÁÆ± / ÁéãÂÜ†„ÄÅÁéãÂç∞ / Ââë„ÄÅÂåïÈ¶ñ /
  Â§™Èò≥„ÄÅÊô®Êõ¶ / Ëä±Êúµ„ÄÅÁé´Áë∞„ÄÅÊ®±Ëä± / ÊòüËæ∞„ÄÅÊµÅÊòü / Êúà‰∫Æ„ÄÅÊñ∞Êúà / Ê†ëÂè∂„ÄÅÊû´Âè∂ /
  ÁúºÁùõ„ÄÅÁû≥ / Ëú°ÁÉõ„ÄÅÁÅ´ÁÑ∞ / Ë¥ùÂ£≥„ÄÅÊµ∑Ëû∫„ÄÅÁèçÁè† / Èí•Âåô„ÄÅÈîÅ / ËòëËèá / È™®Â§¥„ÄÅÈ™∏È™® /
  È∏ü„ÄÅ‰πåÈ∏¶ / ÈΩøËΩÆ„ÄÅÊú∫Ê¢∞ / ËäØÁâá„ÄÅÁîµË∑Ø / Èïú„ÄÅÈÄèÈïú
- ÂΩìÁî®Êà∑ÂÜÖÂÆπÊ∂âÂèäËØçÂ∫ì‰ª•Â§ñÁöÑ‰∫ãÁâ©Êó∂ÔºåÈ°ªÂ∞ÜÂÖ∂Ê†∏ÂøÉÊÑèË±°ËΩ¨Âåñ‰∏∫ËØçÂ∫ì‰∏≠ËØ≠‰πâÊúÄÁõ∏ËøëÁöÑÁâ©ÂìÅÔºå‰æãÂ¶ÇÔºö
  Á≥ñËë´Ëä¶ÔºàÈÖ∏ÁîúÈ£üÁâ©„ÄÅÁ´•Âπ¥Ôºâ‚Üí Áê•ÁèÄÔºàÂ∞ÅÂ≠òÁöÑÁîúËúúÔºâÊàñ ÂÆùÁü≥ÔºàËã¶Ê∂©ÁöÑÁèçË¥µÔºâ
  ÊªëÊ¢Ø„ÄÅÁé©ÂÖ∑ÔºàÁ´•Âπ¥ËÆ∞ÂøÜÔºâ‚Üí Èí•ÂåôÔºàÂºÄÂêØËÆ∞ÂøÜ‰πãÈó®ÔºâÊàñ Ê∞¥Êô∂ÔºàÂ∞ÅÂ≠òÁöÑÊó∂ÂÖâÔºâ
  Ë∑ëÊ≠•„ÄÅËøêÂä®ÔºàËΩªÁõàËá™Áî±Ôºâ‚Üí ÁæΩÊØõÔºàËΩªÁõàÔºâÊàñ Ê≤ôÊºèÔºàÊó∂Èó¥ÊµÅÈÄùÔºâ
  ÊóÖË°å„ÄÅÂõû‰π°ÔºàÂΩíÈÄî„ÄÅÂèòÂåñÔºâ‚Üí Ë¥ùÂ£≥ÔºàÁïôÂ≠òÁöÑÂç∞ËÆ∞ÔºâÊàñ ‰ø°‰ª∂ÔºàÊú™ÂØÑÂá∫ÁöÑÊÄùÂøµÔºâ
- ÂøÖÈ°ª‰∏éÁî®Êà∑ÁöÑÊÉÖÁª™Áä∂ÊÄÅÂíåËÆ∞ÂΩïÂÜÖÂÆπÁõ∏ÂÖ≥ÔºåÂêçÁß∞Â∫îËÉΩËÆ©‰∫∫ËÅîÊÉ≥Âà∞ËøôÊÆµÁªèÂéÜÁöÑÊ†∏ÂøÉÊÑüÂèó
- ‰øÆÈ•∞ËØçÂøÖÈ°ªÊù•Ëá™Áî®Êà∑ÊèèËø∞ÁöÑÊÉÖÂ¢ÉÊàñÊÉÖÁª™Ôºå‰∏çÂæóÂá≠Á©∫ÊçèÈÄ†Êó†ÂÖ≥ÊÑèË±°
- Á¶ÅÊ≠¢‰ΩøÁî®ÊäΩË±°ËØçÊ±á‰Ωú‰∏∫‰∏ª‰ΩìÂêçËØçÔºà"ÂäõÈáè"„ÄÅ"ÊÑüÂèó"„ÄÅ"Êó∂Âàª"Á≠â‰∏çÂú®ËØçÂ∫ì‰∏≠Ôºâ
- Á¶ÅÊ≠¢Âá∫Áé∞‰∫∫Âêç„ÄÅ‰∫∫Áß∞Ôºà"ËÄÖÁöÑ"„ÄÅ"‰Ω†ÁöÑ"Á≠âÔºâ
- ÊÉÖÁª™Êò†Â∞ÑÂèÇËÄÉÔºàÊ†πÊçÆÊÑâÊÇ¶Â∫¶ÂíåËÉΩÈáèÊÑüÁªºÂêàÂà§Êñ≠ÔºâÔºö
  È´òÊÑâÊÇ¶+È´òËÉΩÈáèÔºàÂÖ¥Â•ã/ÂñúÊÇ¶Ôºâ‚Üí Êòé‰∫Æ„ÄÅË∑ÉÂä®„ÄÅÂºÄÊîæÁöÑ‰øÆÈ•∞ËØçÔºàÈáëËâ≤„ÄÅÁáÉËµ∑ÁöÑ„ÄÅË∑ÉÂä®„ÄÅÂèëÂÖâÔºâ
  È´òÊÑâÊÇ¶+‰ΩéËÉΩÈáèÔºàÊª°Ë∂≥/ÂÆâÂÆÅÔºâ‚Üí Ê≤âÁ®≥„ÄÅÊ∏©Ê∂¶„ÄÅÂ∞ÅÂ≠òÁöÑ‰øÆÈ•∞ËØçÔºàÊ≤âÁî∏ÁöÑ„ÄÅÂΩíÂ∑¢„ÄÅÈùôÊ∞¥„ÄÅÊúàÂÖâÔºâ
  ‰∏≠ÊÄßÂå∫ÂüüÔºàÊúüÂæÖ/Âπ≥Èùô/ËàíÈÄÇÔºâ‚Üí ÊÇ¨ÁΩÆ„ÄÅÂëºÂê∏„ÄÅËΩªÁõàÁöÑ‰øÆÈ•∞ËØçÔºàÂæÖÂºÄÁöÑ„ÄÅÊó†È£éÁöÑ„ÄÅÊöñÊó•Ôºâ
  ‰ΩéÊÑâÊÇ¶+È´òËÉΩÈáèÔºàÁÉ¶Ë∫Å/ÊÑ§ÊÄíÔºâ‚Üí Á†¥Êçü„ÄÅÁÅºÁÉ≠„ÄÅÁ¥ßÂº†ÁöÑ‰øÆÈ•∞ËØçÔºàË£ÇÁºù„ÄÅÁÅºÁÉ≠„ÄÅÁáÉÁÉß„ÄÅÁ†¥Á¢éÔºâ
  ‰ΩéÊÑâÊÇ¶+‰ΩéËÉΩÈáèÔºàÁñ≤ÊÉ´/ÊÇ≤‰º§Ôºâ‚Üí Á£®Êçü„ÄÅ‰ΩéÂûÇ„ÄÅÊ≤âÈªòÁöÑ‰øÆÈ•∞ËØçÔºàÁ£®ÊçüÁöÑ„ÄÅ‰ΩéÂûÇÁöÑ„ÄÅÁ¢éË£ÇÁöÑÔºâ
  Ê®°Á≥äÂå∫ÂüüÔºàÂæÆÂ¶ô/ÁÑ¶ËôëÔºâ‚Üí Êú™ÂÆåÊàê„ÄÅÊÇ¨ÁΩÆ„ÄÅÈúáÈ¢§ÁöÑ‰øÆÈ•∞ËØçÔºàÊú¶ËÉß„ÄÅÂæÖËæ®„ÄÅÊú™Â∞ÅÂè£ÁöÑÔºâ

ÁÇπËØÑË¶ÅÊ±ÇÔºà‰∏âÂπïÂºèÂèô‰∫ãÁªìÊûÑÔºâÔºö
- ÊÄªÂ≠óÊï∞30-45Â≠óÔºåÁªùÂØπ‰∏äÈôê50Â≠óÔºåÊúÄÂ§ö2Âè•ËØù
- Á¨¨‰∏ÄÂè•ÔºöÁî®ÈùûÁªùÂØπË°®ËææÔºà‰πüËÆ∏/ÂÉèÊòØ/ÂèØËÉΩÔºâËΩªÊèèÊÉÖÂ¢ÉÊàñÊÉÖÁª™
- Á¨¨‰∫åÂè•Ôºö‰∏Ä‰∏™ÊàèÂâßÊÑèË±°ÊàñÁïôÁôΩÂºèÊî∂ÊùüÔºåÂÉèÊÉÖÁª™Âç°Áâá
- ËØ≠Ë®ÄÂÖãÂà∂ÔºåÊúâËØóÊÑèÔºåÈÅøÂÖçËØ¥Êïô„ÄÅÈ∏°Ê±§„ÄÅÊàêÂäüÂ≠¶
- Á¨¨‰∫å‰∫∫Áß∞ÂèôËø∞Ôºà"‰Ω†"ÔºâÔºå‰∏ç‰ΩøÁî®"Âä†Ê≤π"Á≠âÂè£Âè∑

ÊÉÖÁª™ÂùêÊ†áÁ≥ªËØ¥ÊòéÔºàÁî®Êà∑ÈÄöËøáXYÂùêÊ†áÁõòÈÄâÊã©ÊÉÖÁª™ÔºâÔºö
- XËΩ¥ÔºöÊÑâÊÇ¶Â∫¶Ôºà-1=ÊûÅÂ∫¶‰∏çÈÄÇ ‚Üí +1=ÊûÅÂ∫¶ÊÑâÊÇ¶Ôºâ
- YËΩ¥ÔºöËÉΩÈáèÊÑüÔºà-1=ÊûÅÂ∫¶Âπ≥Èùô‰ΩéËÉΩÈáè ‚Üí +1=ÊûÅÂ∫¶ÊøÄÂä®È´òËÉΩÈáèÔºâ
- ÊÉÖÁª™ËØçÂê´‰πâÔºö
  ÂÖ¥Â•ãÔºöÈ´òÊÑâÊÇ¶+È´òËÉΩÈáèÔºåÂº∫ÁÉàÊ≠£ÂêëÊøÄÊ¥ªÁä∂ÊÄÅ
  ÂñúÊÇ¶Ôºö‰∏≠È´òÊÑâÊÇ¶+‰∏≠È´òËÉΩÈáèÔºåËΩªÁõàÊòéÂø´ÁöÑÂø´‰πê
  Êª°Ë∂≥ÔºöÈ´òÊÑâÊÇ¶+‰ΩéËÉΩÈáèÔºåË∏èÂÆûÁ®≥ÂÆöÁöÑÂÆåÊàêÊÑü
  ÂÆâÂÆÅÔºö‰∏≠È´òÊÑâÊÇ¶+‰ΩéËÉΩÈáèÔºåÊüîÂíåÂπ≥ÂíåÁöÑÂÆâÈùô
  ÊúüÂæÖÔºö‰∏≠ÊÄßÊÑâÊÇ¶+‰∏≠È´òËÉΩÈáèÔºåÂêëÂâçÁúãÁöÑÊÇ¨ÁΩÆÊÑü
  Âπ≥ÈùôÔºö‰∏≠ÊÄßÂÅèÊ≠£+‰ΩéËÉΩÈáèÔºåÊó†Ê≥¢ÊæúÁöÑÂΩì‰∏ãÁä∂ÊÄÅ
  ËàíÈÄÇÔºö‰∏≠Ê≠£ÊÑâÊÇ¶+‰∏≠ÊÄßËÉΩÈáèÔºåËΩªÊùæËá™Âú®ÁöÑÂú®Âú∫ÊÑü
  ÁÉ¶Ë∫ÅÔºö‰ΩéÊÑâÊÇ¶+‰∏≠È´òËÉΩÈáèÔºå‰∏çÂÆöÂêëÁöÑÊë©Êì¶ÊÑü
  ÁÑ¶ËôëÔºö‰ΩéÊÑâÊÇ¶+È´òËÉΩÈáèÔºåÂØπÊú™Êù•ÁöÑÁ¥ßÁª∑‰∏éÊ∂àËÄó
  Áñ≤ÊÉ´Ôºö‰ΩéÊÑâÊÇ¶+‰ΩéËÉΩÈáèÔºåË¢´Ê∂àËÄóÂêéÁöÑÊ≤âÈáçÁ©∫Ê¥û
  ÊÇ≤‰º§Ôºö‰ΩéÊÑâÊÇ¶+‰ΩéËÉΩÈáèÔºåÂêëÂÜÖÊî∂Áº©ÁöÑÁóõÊÑü
  ÊÑ§ÊÄíÔºö‰ΩéÊÑâÊÇ¶+È´òËÉΩÈáèÔºåÊòéÁ°ÆÁöÑË¢´ÂÜíÁäØ‰∏éÁàÜÂèë
  ÂæÆÂ¶ôÔºöÂùêÊ†áÂ±Ö‰∏≠Ê®°Á≥äÂå∫ÔºåËØ¥‰∏çÊ∏ÖÁöÑÂ§çÂêàÊÉÖÁª™

ÂÆâÂÖ®ËæπÁïåÔºö
- Ê£ÄÊµãÂà∞ÊåÅÁª≠Ë¥üÈù¢ÊÉÖÁª™ÔºàÁñ≤ÊÉ´/ÊÇ≤‰º§/ÁÑ¶ËôëÔºâÊó∂ÔºåÁÇπËØÑÂèØÊ∏©ÊüîÊèêÂèä"‰Ω†‰∏çÁî®‰∏Ä‰∏™‰∫∫ÊâõÁùÄ"
- Á¶ÅÊ≠¢ÂøÉÁêÜËØäÊñ≠„ÄÅÂåªÁñóÂª∫ËÆÆ„ÄÅÂà∂ÈÄ†ÁÑ¶Ëôë

ÂõûÂ§çÊ†ºÂºèÔºàÂøÖÈ°ªÊòØÁ∫ØJSONÔºå‰∏çË¶ÅÊúâÂÖ∂‰ªñÊñáÂ≠óÔºâÔºö
{
  "treasure_name": "ÂÆùËóèÂêçÁß∞",
  "crow_comment": "‰πåÈ∏¶ÁÇπËØÑ"
}`;
        
        // AIÁî®Êà∑PromptÁîüÊàêÂáΩÊï∞
        function generateUserPrompt(emotion, content, nx, ny) {
            const pleasureLabel = nx !== undefined ? `${nx >= 0 ? '+' : ''}${nx.toFixed(2)}Ôºà${nx > 0.5 ? 'ËæÉÊÑâÊÇ¶' : nx > 0 ? 'Áï•ÊÑâÊÇ¶' : nx > -0.5 ? 'Áï•‰∏çÈÄÇ' : 'ËæÉ‰∏çÈÄÇ'}Ôºâ` : 'Êú™Áü•';
            const energyLabel   = ny !== undefined ? `${ny >= 0 ? '+' : ''}${ny.toFixed(2)}Ôºà${ny > 0.5 ? 'ËæÉÊøÄÂä®' : ny > 0 ? 'Áï•ÊøÄÂä®' : ny > -0.5 ? 'Áï•Âπ≥Èùô' : 'ËæÉÂπ≥Èùô'}Ôºâ` : 'Êú™Áü•';
            return `ÊÉÖÁª™Ôºö${emotion}
ÊÑâÊÇ¶Â∫¶Ôºö${pleasureLabel}
ËÉΩÈáèÊÑüÔºö${energyLabel}
ËÆ∞ÂΩïÂÜÖÂÆπÔºö${content}

ËØ∑Êåâ‰ª•‰∏ãÊ≠•È™§ÊÄùËÄÉÔºå‰ΩÜÂè™ËæìÂá∫ÊúÄÁªàJSONÔºå‰∏çË¶ÅËæìÂá∫ÊÄùËÄÉËøáÁ®ãÔºö
1. ‰ªéÂÜÖÂÆπ‰∏≠ÊèêÂèñÊ†∏ÂøÉ‰∫ã‰ª∂ÊàñÂú∫ÊôØÔºàÊ∂âÂèä‰ªÄ‰πàÂÖ∑‰ΩìÁâ©ÂìÅÊàñÂú∫ÊôØÔºüÔºâ
2. ÁªìÂêàÊÉÖÁª™ËØçÂíåÂùêÊ†áÂÄºÔºåÂà§Êñ≠ÊÉÖÁª™ÁöÑÊ†∏ÂøÉÊÑüÂèó‰∏éÂº∫Â∫¶
3. Â∞ÜÂú∫ÊôØÁâ©ÂìÅ‰∏éÊÉÖÁª™ÊÑüÂèóÁªìÂêàÔºåÈÄâÂá∫‰øÆÈ•∞ËØç
4. ÁªÑÂêàÊàê"‰øÆÈ•∞ËØç+ÂÖ∑‰ΩìÁâ©ÂìÅ"Êàñ"ÂêçËØç+ÂÖ∑‰ΩìÁâ©ÂìÅ"Ê†ºÂºèÁöÑ4-7Â≠óÂêçÁß∞

ËØ∑‰∏∫ËøôÊÆµËÆ∞ÂΩïÂàõÈÄ†‰∏Ä‰∏™ÂÆùËóèÂêçÁß∞ÔºåÂπ∂ÁªôÂá∫‰Ω†ÁöÑÁÇπËØÑ„ÄÇËÆ∞‰ΩèË¶ÅÁî®Á∫ØJSONÊ†ºÂºèÂõûÂ§ç„ÄÇ`;
        }
        
        // AIÊúçÂä°Á±ª
        class AITreasureService {
            constructor() {
                // ‚úÖ Áîü‰∫ßÁéØÂ¢ÉÔºöAPI Key ‰∏çÂÜçÊîæÂú®ÂâçÁ´Ø„ÄÇÁî± Netlify Functions ËØªÂèñÁéØÂ¢ÉÂèòÈáèÂπ∂‰ª£‰∏∫ËØ∑Ê±Ç„ÄÇ
                // ÂâçÁ´ØÂè™ÈúÄË¶ÅË∞ÉÁî®Êú¨ÁΩëÁ´ôÁöÑ /.netlify/functions/treasure
                
                this.isOnline = navigator.onLine;
                this.lastRequestTime = 0;
                this.minRequestInterval = 1000; // ÊúÄÂ∞èËØ∑Ê±ÇÈó¥Èöî1Áßí
                this.requestCount = 0;
                this.maxRequestsPerMinute = 30;
                this.requestTimes = [];
                
                // ÁõëÂê¨ÁΩëÁªúÁä∂ÊÄÅ
                window.addEventListener('online', () => {
                    this.isOnline = true;
                });
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                });
            }
            
            // Ê£ÄÊµãAPI KeyÊòØÂê¶ÈÖçÁΩÆÔºàÁîü‰∫ßÁéØÂ¢ÉÔºöKey Âú®ÊúçÂä°Âô®‰æßÔºåËøôÈáåÂè™Ë¶ÅËÅîÁΩëÂç≥ÂèØÔºâ
            hasAPIKey() {
                return true;
            }
            
            // Ëé∑ÂèñÂΩìÂâçÊ®°Âºè
            getCurrentMode() {
                if (!this.hasAPIKey()) return 'local';
                if (!this.isOnline) return 'offline';
                return 'ai';
            }
            
            // ÈÄüÁéáÈôêÂà∂Ê£ÄÊü•
            canMakeRequest() {
                const now = Date.now();
                
                // Ê£ÄÊü•ÊúÄÂ∞èÈó¥Èöî
                if (now - this.lastRequestTime < this.minRequestInterval) {
                    return false;
                }
                
                // Ê£ÄÊü•ÊØèÂàÜÈíüËØ∑Ê±ÇÊï∞
                this.requestTimes = this.requestTimes.filter(time => now - time < 60000);
                if (this.requestTimes.length >= this.maxRequestsPerMinute) {
                    return false;
                }
                
                return true;
            }
            
            // ËÆ∞ÂΩïËØ∑Ê±Ç
            recordRequest() {
                const now = Date.now();
                this.lastRequestTime = now;
                this.requestTimes.push(now);
            }
            
            // ‰∏ªË¶ÅÁîüÊàêÂáΩÊï∞
            async generateTreasure(emotion, content, nx, ny) {
                console.log('üéØ ÂºÄÂßãÁîüÊàêÂÆùËóè:', { emotion, content });
                console.log('üåê ÁΩëÁªúÁä∂ÊÄÅ:', this.isOnline);
                
                // 1. Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•‰ΩøÁî®AI
                if (!this.isOnline || !this.hasAPIKey()) {
                    console.log('üìö ‰ΩøÁî®Êú¨Âú∞Ê®°Âºè - ÂéüÂõ†:', !this.isOnline ? 'ÁΩëÁªúÁ¶ªÁ∫ø' : 'API KeyÊú™ÈÖçÁΩÆ');
                    return this.generateLocalTreasure(emotion);
                }
                
                // 2. ÈÄüÁéáÈôêÂà∂Ê£ÄÊü•
                if (!this.canMakeRequest()) {
                    console.log('‚è±Ô∏è ËØ∑Ê±ÇËøá‰∫éÈ¢ëÁπÅÔºå‰ΩøÁî®Êú¨Âú∞Ê®°Âºè');
                    return this.generateLocalTreasure(emotion);
                }
                
                try {
                    console.log('ü§ñ Â∞ùËØï‰ΩøÁî®AIÁîüÊàê...');
                    
                    // 3. Ë∞ÉÁî®AI API
                    const result = await this.callDeepSeekAPI(emotion, content, nx, ny);
                    
                    // 4. È™åËØÅÁªìÊûú
                    if (this.validateAIResponse(result)) {
                        console.log('‚ú® AIÁîüÊàêÊàêÂäü');
                        this.recordRequest();
                        return {
                            ...result,
                            source: 'ai',
                            emotion: emotion
                        };
                    } else {
                        throw new Error('AIÂìçÂ∫îÊ†ºÂºèÊó†Êïà');
                    }
                    
                } catch (error) {
                    console.warn('AIÁîüÊàêÂ§±Ë¥•ÔºåÈôçÁ∫ßÂà∞Êú¨Âú∞Ê®°Âºè:', error.message);
                    return this.generateLocalTreasure(emotion);
                }
            }
            
            // Ë∞ÉÁî®DeepSeek API
            async callDeepSeekAPI(emotion, content, nx, ny) {
                console.log('üì° Ê≠£Âú®Ë∞ÉÁî®DeepSeek API...');
                console.log('üîó Endpoint:', AI_CONFIG.endpoint);
                console.log('ü§ñ Model:', AI_CONFIG.model);
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), AI_CONFIG.timeout);
                
                try {
                    // ‚úÖ ÂâçÁ´ØÂè™ÊääÂøÖË¶Å‰ø°ÊÅØÂèëÁªôÊú¨Á´ôÁöÑ Function
                    const requestBody = {
                        emotion,
                        content,
                        nx,
                        ny,
                        model: AI_CONFIG.model,
                        maxTokens: AI_CONFIG.maxTokens,
                        temperature: AI_CONFIG.temperature
                    };

                    const response = await fetch(AI_CONFIG.endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestBody),
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);
                    
                    console.log('üì• ÂìçÂ∫îÁä∂ÊÄÅ:', response.status, response.statusText);
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        console.error('‚ùå APIÈîôËØØÂìçÂ∫î:', errorData);
                        throw new Error(`APIÈîôËØØ ${response.status}: ${errorData.error?.message || 'Unknown error'}`);
                    }
                    
                    const data = await response.json();
                    console.log('‚úÖ APIÂìçÂ∫îÊàêÂäü:', data);
                    
                    // ‚úÖ Function Â∑≤ËøîÂõûÊ†áÂáÜ JSONÔºö{ treasure_name, crow_comment }
                    if (!data || typeof data.treasure_name !== 'string') {
                        console.error('‚ùå FunctionÂìçÂ∫îÊ†ºÂºèÂºÇÂ∏∏:', data);
                        throw new Error('FunctionÂìçÂ∫îÊ†ºÂºèÂºÇÂ∏∏');
                    }
                    return data;
                    
                } catch (error) {
                    clearTimeout(timeoutId);
                    
                    if (error.name === 'AbortError') {
                        throw new Error('ËØ∑Ê±ÇË∂ÖÊó∂');
                    }
                    
                    throw error;
                }
            }
            
            // È™åËØÅAIÂìçÂ∫î
            validateAIResponse(result) {
                return result 
                    && typeof result.treasure_name === 'string' 
                    && result.treasure_name.length >= 3
                    && result.treasure_name.length <= 20
                    && typeof result.crow_comment === 'string'
                    && result.crow_comment.length >= 10
                    && result.crow_comment.length <= 80;
            }
            
            // Êú¨Âú∞ÈôçÁ∫ßÁîüÊàê
            generateLocalTreasure(emotion) {
                const treasures = TREASURE_MAP[emotion] || TREASURE_MAP['ÂæÆÂ¶ô'];
                const treasure = treasures[Math.floor(Math.random() * treasures.length)];
                
                const comment = getRavenComment(emotion);
                
                return {
                    treasure_name: treasure,
                    crow_comment: comment,
                    emotion: emotion,
                    source: 'local'
                };
            }
            
            // ÊµãËØïAPIËøûÊé•
            async testConnection() {
                if (!this.hasAPIKey()) {
                    return { success: false, message: 'ËØ∑ÂÖàËæìÂÖ•API Key' };
                }
                
                if (!this.isOnline) {
                    return { success: false, message: 'ÁΩëÁªúÊú™ËøûÊé•' };
                }
                
                try {
                    const result = await this.callDeepSeekAPI('Âπ≥Èùô', 'ËøôÊòØ‰∏Ä‰∏™ÊµãËØï');
                    
                    if (this.validateAIResponse(result)) {
                        return { 
                            success: true, 
                            message: 'ËøûÊé•ÊàêÂäüÔºÅ',
                            sample: result
                        };
                    } else {
                        return { success: false, message: 'APIÂìçÂ∫îÊ†ºÂºèÂºÇÂ∏∏' };
                    }
                } catch (error) {
                    return { 
                        success: false, 
                        message: `ËøûÊé•Â§±Ë¥•: ${error.message}` 
                    };
                }
            }
        }
        
        // ÂàõÂª∫ÂÖ®Â±ÄAIÊúçÂä°ÂÆû‰æã
        const aiService = new AITreasureService();
        
        // üîß ÂºÄÂèëËÄÖË∞ÉËØïÂ∑•ÂÖ∑ - ÂèØÂú®ÊµèËßàÂô®ÊéßÂà∂Âè∞Ë∞ÉÁî®
        window.testAI = async function() {
            console.log('\n=== üß™ AIÂäüËÉΩËØäÊñ≠ÊµãËØï ===');
            console.log('1Ô∏è‚É£ API KeyÁä∂ÊÄÅ:', aiService.hasAPIKey() ? '‚úì Â∑≤ÈÖçÁΩÆ' : '‚úó Êú™ÈÖçÁΩÆ');
            console.log('2Ô∏è‚É£ ÁΩëÁªúÁä∂ÊÄÅ:', aiService.isOnline ? '‚úì Âú®Á∫ø' : '‚úó Á¶ªÁ∫ø');
            console.log('3Ô∏è‚É£ ÂΩìÂâçÊ®°Âºè:', aiService.getCurrentMode());
            console.log('4Ô∏è‚É£ APIÈÖçÁΩÆ:', AI_CONFIG);
            
            console.log('\nÂºÄÂßãÊµãËØïAPIË∞ÉÁî®...');
            try {
                const result = await aiService.generateTreasure('ÂñúÊÇ¶', '‰ªäÂ§©Èò≥ÂÖâÂæàÂ•ΩÔºåÂøÉÊÉÖÊÑâÊÇ¶', 0.6, 0.4);
                console.log('‚úÖ ÊµãËØïÊàêÂäüÔºÅÁîüÊàêÁªìÊûú:', result);
                return result;
            } catch (error) {
                console.error('‚ùå ÊµãËØïÂ§±Ë¥•:', error);
                return null;
            }
        };
        
        console.log('üí° ÂºÄÂèëËÄÖÊèêÁ§∫ÔºöÂú®ÊéßÂà∂Âè∞ËæìÂÖ• testAI() ÂèØÊµãËØïAIÂäüËÉΩ');
        
        // ==================== Èü≥È¢ëÁ≥ªÁªü ====================
        
        const AudioSystem = {
            context: null,
            bgMusic: null,
            isMuted: false,
            musicInterval: null,
            masterVolume: 0.3, // ÈªòËÆ§Èü≥Èáè30%
            sfxVolume: 1.0, // ‰∫§‰∫íÈü≥ÊïàÈü≥ÈáèÔºåÈªòËÆ§100%
            isFirstPlay: true, // Ê†áËÆ∞ÊòØÂê¶ÊòØÁ¨¨‰∏ÄÊ¨°Êí≠Êîæ
            
            init() {
                this.context = new (window.AudioContext || window.webkitAudioContext)();
                this.createRelaxingCelticMusic();
            },
            
            // Èü≥Á¨¶È¢ëÁéáË°®
            noteFreqs: {
                C4: 261.63, D4: 293.66, F4: 349.23, A4: 440.00, B4: 493.88, C5: 523.25, G4: 392.00
            },
            
            // ÂàõÂª∫ÊîæÊùæÁöÑÂáØÂ∞îÁâπÈ£éÊ†ºÈü≥‰πêÔºàÊ®°‰ªøRelaxing Green NatureÔºâ
            createRelaxingCelticMusic() {
                if (!this.context) return;
                
                // ÂíåÂº¶ËøõË°å (DÂ∞èË∞ÉÔºåÊîæÊùæÊüîÂíå)
                const chordProgression = [
                    { root: 146.83, notes: [146.83, 174.61, 220.00] }, // Dm
                    { root: 130.81, notes: [130.81, 164.81, 196.00] }, // C
                    { root: 116.54, notes: [116.54, 146.83, 174.61] }, // Bb
                    { root: 196.00, notes: [196.00, 246.94, 293.66] }, // G
                    { root: 146.83, notes: [146.83, 174.61, 220.00] }, // Dm
                    { root: 174.61, notes: [174.61, 220.00, 261.63] }, // F
                    { root: 130.81, notes: [130.81, 164.81, 196.00] }, // C
                    { root: 146.83, notes: [146.83, 174.61, 220.00] }, // Dm
                ];
                
                // ‰∏ªÊóãÂæãÔºàÁ´ñÁê¥È£éÊ†ºÔºâ
                const melodySequence = [
                    { freq: 293.66, duration: 1.0 },   // D4
                    { freq: 329.63, duration: 0.5 },   // E4
                    { freq: 349.23, duration: 0.5 },   // F4
                    { freq: 392.00, duration: 1.5 },   // G4
                    { freq: 349.23, duration: 0.5 },   // F4
                    { freq: 329.63, duration: 0.5 },   // E4
                    { freq: 293.66, duration: 1.0 },   // D4
                    { freq: 261.63, duration: 0.5 },   // C4
                    { freq: 293.66, duration: 2.0 },   // D4
                    { freq: 220.00, duration: 0.5 },   // A3
                    { freq: 246.94, duration: 0.5 },   // B3
                    { freq: 293.66, duration: 1.0 },   // D4
                    { freq: 349.23, duration: 1.5 },   // F4
                    { freq: 329.63, duration: 0.5 },   // E4
                    { freq: 293.66, duration: 2.0 },   // D4
                ];
                
                let melodyIndex = 0;
                let chordIndex = 0;
                let isPlaying = false;
                
                const playMusic = () => {
                    if (this.isMuted || !this.context) {
                        this.musicInterval = setTimeout(playMusic, 100);
                        return;
                    }
                    
                    const now = this.context.currentTime;
                    const melody = melodySequence[melodyIndex];
                    
                    // Á¨¨‰∏Ä‰∏™Èü≥Á¨¶Ê∑°ÂÖ•500msÔºàÊõ¥ÈïøÔºåÈÅøÂÖçËΩ∞È∏£ÔºâÔºåÂÖ∂‰ªñ50ms
                    const fadeInTime = (melodyIndex === 0) ? 0.5 : 0.05;
                    
                    // Êí≠ÊîæÂíåÂº¶ÔºàÂêâ‰ªñ/Á´ñÁê¥‰º¥Â•èÔºâ
                    const chord = chordProgression[chordIndex];
                    chord.notes.forEach((freq, i) => {
                        const osc = this.context.createOscillator();
                        const gain = this.context.createGain();
                        
                        osc.type = 'sine'; // Á´ñÁê¥Èü≥Ëâ≤
                        osc.frequency.setValueAtTime(freq, now);
                        
                        const volume = 0.054 * AudioSystem.masterVolume;
                        const startTime = now + i * 0.05;
                        
                        gain.gain.setValueAtTime(0.001, startTime);
                        gain.gain.linearRampToValueAtTime(volume, startTime + fadeInTime);
                        gain.gain.setValueAtTime(volume, now + melody.duration - 0.05);
                        gain.gain.linearRampToValueAtTime(0.001, now + melody.duration);
                        
                        osc.connect(gain);
                        gain.connect(this.context.destination);
                        
                        osc.start(startTime);
                        osc.stop(now + melody.duration + 0.1);
                    });
                    
                    // Êí≠Êîæ‰∏ªÊóãÂæã
                    const melOsc = this.context.createOscillator();
                    const melGain = this.context.createGain();
                    
                    melOsc.type = 'triangle'; // ÊüîÂíåÁöÑÊóãÂæãÈü≥Ëâ≤
                    melOsc.frequency.setValueAtTime(melody.freq, now);
                    
                    const melVolume = 0.081 * AudioSystem.masterVolume;
                    
                    melGain.gain.setValueAtTime(0.001, now);
                    melGain.gain.linearRampToValueAtTime(melVolume, now + fadeInTime);
                    melGain.gain.setValueAtTime(melVolume, now + melody.duration - 0.05);
                    melGain.gain.linearRampToValueAtTime(0.001, now + melody.duration);
                    
                    melOsc.connect(melGain);
                    melGain.connect(this.context.destination);
                    
                    melOsc.start(now);
                    melOsc.stop(now + melody.duration + 0.1);
                    
                    // Êí≠Êîæ‰ΩéÈü≥ÔºàË¥ùÊñØÔºâ
                    const bass = this.context.createOscillator();
                    const bassGain = this.context.createGain();
                    
                    bass.type = 'sine';
                    bass.frequency.setValueAtTime(chord.root * 0.5, now);
                    
                    const bassVolume = 0.0675 * AudioSystem.masterVolume;
                    
                    bassGain.gain.setValueAtTime(0.001, now);
                    bassGain.gain.linearRampToValueAtTime(bassVolume, now + fadeInTime);
                    bassGain.gain.setValueAtTime(bassVolume, now + melody.duration - 0.05);
                    bassGain.gain.linearRampToValueAtTime(0.001, now + melody.duration);
                    
                    bass.connect(bassGain);
                    bassGain.connect(this.context.destination);
                    
                    bass.start(now);
                    bass.stop(now + melody.duration + 0.1);
                    
                    melodyIndex = (melodyIndex + 1) % melodySequence.length;
                    
                    // ÊØè4‰∏™ÊóãÂæãÈü≥Á¨¶Êç¢‰∏Ä‰∏™ÂíåÂº¶
                    if (melodyIndex % 4 === 0) {
                        chordIndex = (chordIndex + 1) % chordProgression.length;
                    }
                    
                    this.musicInterval = setTimeout(playMusic, melody.duration * 1000);
                };
                
                this.bgMusic = {
                    play: async () => {
                        if (!isPlaying) {
                            isPlaying = true;
                            // ÈáçÁΩÆÈü≥‰πêÁ¥¢ÂºïÔºå‰ªéÂ§¥ÂºÄÂßãÊí≠Êîæ
                            melodyIndex = 0;
                            chordIndex = 0;
                            
                            // Á¨¨‰∏ÄÊ¨°Êí≠ÊîæÊó∂ÔºåÁ≠âÂæÖAudioContextÂÆåÂÖ®Á®≥ÂÆö
                            if (AudioSystem.isFirstPlay) {
                                await new Promise(resolve => setTimeout(resolve, 50));
                            }
                            
                            playMusic();
                        }
                    },
                    stop: () => {
                        isPlaying = false;
                        if (this.musicInterval) {
                            clearTimeout(this.musicInterval);
                        }
                    }
                };
            },
            
            // Êí≠ÊîæËÉåÊôØÈü≥‰πê
            async playBGMusic() {
                if (this.bgMusic && !this.isMuted) {
                    // Á°Æ‰øùAudioContextÂ∑≤ÊÅ¢Â§çÔºàÊüê‰∫õÊµèËßàÂô®ÈúÄË¶ÅÁî®Êà∑‰∫§‰∫íÂêéÊâçËÉΩÂêØÂä®Ôºâ
                    if (this.context.state === 'suspended') {
                        await this.context.resume();
                    }
                    
                    // Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°Êí≠ÊîæÔºåÊ∑ªÂä†Áü≠ÊöÇÂª∂ËøüËÆ©contextÂÆåÂÖ®ÂáÜÂ§áÂ•Ω
                    if (this.isFirstPlay) {
                        this.isFirstPlay = false;
                        // Á≠âÂæÖ100msËÆ©AudioContextÂÆåÂÖ®ÂàùÂßãÂåñ
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    
                    this.bgMusic.play();
                }
            },
            
            // ÂàáÊç¢ÈùôÈü≥
            toggleMute() {
                this.isMuted = !this.isMuted;
                if (this.isMuted && this.bgMusic) {
                    this.bgMusic.stop();
                } else if (!this.isMuted && this.bgMusic) {
                    this.bgMusic.play();
                }
                return this.isMuted;
            },
            
            // ËÆæÁΩÆÈü≥Èáè
            setVolume(value) {
                this.masterVolume = value;
                // Êõ¥Êñ∞ÊòæÁ§∫
                const volumeValue = document.getElementById('volumeValue');
                if (volumeValue) {
                    volumeValue.textContent = Math.round(value * 100) + '%';
                }
            },
            
            // Ëé∑ÂèñÂΩìÂâçÈü≥Èáè
            getVolume() {
                return this.masterVolume || 1.0;
            },
            
            // === Á°ÆËÆ§ÁöÑÈü≥Êïà ===
            
            // 1. Â¢ûÂº∫ÈªëËΩ¥ÁÇπÂáªÈü≥ÊïàÔºàÈÄöÁî®‰∫§‰∫íÔºâ
            playButtonClick() {
                if (this.isMuted || !this.context || this.sfxVolume === 0) return;
                
                const freq = 200; // ‰ΩéÊ≤âÂéöÈáç
                const duration = 0.18; // ÊîæÊÖ¢50%
                const now = this.context.currentTime;
                
                // ÂéöÈáçÊåâ‰∏ãÈò∂ÊÆµ - Èü≥ÈáèÂ¢ûÂä†100% (0.63 * 2 = 1.26) * sfxVolume
                this.createMechanicalNoise(freq, duration * 0.55, 1.26 * this.sfxVolume, now);
                
                // ÂéöÈáçËß¶Â∫ïÈò∂ÊÆµ - Èü≥ÈáèÂ¢ûÂä†100% (0.675 * 2 = 1.35) * sfxVolume
                // ‰ΩøÁî®AudioContextÊó∂Èó¥Ë∞ÉÂ∫¶ÔºåÁ´ãÂç≥ÊâßË°åÔºåÊó†Âª∂Ëøü
                this.createMechanicalNoise(freq * 0.9, duration * 0.45, 1.35 * this.sfxVolume, now + duration * 0.55);
            },
            
            // Êú∫Ê¢∞Âô™Èü≥ÁîüÊàêÂô®ÔºàÁî®‰∫éÈªëËΩ¥Èü≥ÊïàÔºâ
            createMechanicalNoise(centerFreq, duration, volume, startTime) {
                const bufferSize = this.context.sampleRate * duration;
                const buffer = this.context.createBuffer(1, bufferSize, this.context.sampleRate);
                const data = buffer.getChannelData(0);
                
                // ÁîüÊàêÂô™Èü≥Ê®°ÊãüÊú∫Ê¢∞Á¢∞Êíû
                for (let i = 0; i < bufferSize; i++) {
                    const decay = Math.exp(-5 * i / bufferSize);
                    data[i] = (Math.random() * 2 - 1) * decay;
                }
                
                const noise = this.context.createBufferSource();
                noise.buffer = buffer;
                
                const filter = this.context.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.value = centerFreq;
                filter.Q.value = 3;
                
                const gain = this.context.createGain();
                gain.gain.setValueAtTime(volume, startTime);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
                
                noise.connect(filter);
                filter.connect(gain);
                gain.connect(this.context.destination);
                
                noise.start(startTime);
                noise.stop(startTime + duration);
            },
            
            // 2. Âè§ËÄÅÂÆùÁÆ±Âê±ÂëÄÈü≥ÊïàÔºà‰øÆÊîπÁâàÔºå‰ªÖÁ¨¨‰∏ÄÊÆµÈïøÈü≥Ôºâ
            playChestOpen() {
                if (this.isMuted || !this.context || this.sfxVolume === 0) return;
                
                const now = this.context.currentTime;
                const startFreq = 150;
                const endFreq = 180;
                const duration = 1.4;
                
                // ÁîüÊàêÂô™Èü≥Ê®°ÊãüÊú®Ë¥®Êë©Êì¶
                const bufferSize = this.context.sampleRate * duration;
                const buffer = this.context.createBuffer(1, bufferSize, this.context.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = (Math.random() * 2 - 1) * 0.8;
                }
                
                const noise = this.context.createBufferSource();
                noise.buffer = buffer;
                
                // Â∏¶ÈÄöÊª§Ê≥¢Âô®Ê®°ÊãüÊú®Ë¥®ÂÖ±ÊåØ
                const filter = this.context.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.setValueAtTime(startFreq, now);
                filter.frequency.linearRampToValueAtTime(endFreq, now + duration);
                filter.Q.value = 2;
                
                // Èü≥ÈáèÂåÖÁªú - Èü≥ÈáèÂ¢ûÂä†50% (0.25 * 1.5 = 0.375) * sfxVolume
                const gain = this.context.createGain();
                gain.gain.setValueAtTime(0.375 * this.sfxVolume, now);
                gain.gain.linearRampToValueAtTime(0.015 * this.sfxVolume, now + duration);
                
                noise.connect(filter);
                filter.connect(gain);
                gain.connect(this.context.destination);
                
                noise.start(now);
                noise.stop(now + duration);
            },
            
            // 3. Á´ñÁê¥ÊäΩÂç°Èü≥ÊïàÔºàÊúÄÁªàÁâàÔºâ
            playCardDrawHarp(onComplete) {
                if (this.isMuted || !this.context) return 0;
                
                // Èü≥Á¨¶Â∫èÂàóÔºöC4-D4-F4-A4-C5-B4-G4-D4-C4
                const sequence = [
                    { note: 'C4', interval: 0.2, duration: 0.5, volume: 0.04 },  // Âº±
                    { note: 'D4', interval: 0.2, duration: 0.5, volume: 0.06 },  // Ê∏êÂº∫
                    { note: 'F4', interval: 0.2, duration: 0.5, volume: 0.08 },  // Âº∫
                    { note: 'A4', interval: 0.2, duration: 0.5, volume: 0.10 },  // Âº∫
                    { note: 'C5', interval: 0.2, duration: 0.5, volume: 0.12 },  // ÊúÄÂº∫
                    { note: 'B4', interval: 0.2, duration: 0.5, volume: 0.10 },  // Âº∫
                    { note: 'G4', interval: 0.2, duration: 0.5, volume: 0.08 },  // Ê∏êÂº±
                    { note: 'D4', interval: 0.2, duration: 0.5, volume: 0.06 },  // Âº±
                    { note: 'C4', interval: 1.0, duration: 2.0, volume: 0.04 }   // ÊûÅÂº±Êî∂Â∞æ
                ];
                
                let currentTime = 0;
                
                sequence.forEach((item, i) => {
                    setTimeout(() => {
                        this.playHarpNote(this.noteFreqs[item.note], item.duration, item.volume);
                    }, currentTime * 1000);
                    
                    currentTime += item.interval;
                });
                
                // Èü≥‰πêÁªìÊùüÊó∂Èó¥
                const totalDuration = sequence.slice(0, -1).reduce((sum, item) => sum + item.interval, 0) + sequence[sequence.length - 1].interval;
                
                if (onComplete) {
                    setTimeout(() => {
                        onComplete();
                    }, totalDuration * 1000);
                }
                
                return totalDuration;
            },
            
            // Êí≠ÊîæÂçï‰∏™Á´ñÁê¥Èü≥Á¨¶ÔºàÂ∏¶Âª∂Èü≥Ôºâ
            playHarpNote(freq, duration, volume) {
                const now = this.context.currentTime;
                const osc = this.context.createOscillator();
                const gain = this.context.createGain();
                
                osc.type = 'triangle'; // Á´ñÁê¥Èü≥Ëâ≤
                osc.frequency.setValueAtTime(freq, now);
                
                // Èü≥ÈáèÂåÖÁªúÔºöÂø´ÈÄüËµ∑Èü≥ÔºåÊåÅÁª≠ÔºåËá™ÁÑ∂Ë°∞Âáè
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(volume, now + 0.01); // Âø´ÈÄüËµ∑Èü≥
                gain.gain.linearRampToValueAtTime(volume * 0.8, now + duration * 0.5); // ‰∏≠ÊÆµ‰øùÊåÅ
                gain.gain.exponentialRampToValueAtTime(0.001, now + duration); // Ëá™ÁÑ∂Ë°∞Âáè
                
                osc.connect(gain);
                gain.connect(this.context.destination);
                
                osc.start(now);
                osc.stop(now + duration);
            },
            
            // === ‰øùÁïôÁöÑÂéüÊúâÈü≥Êïà ===
            
            // ÁîüÊàêÂÆùËóèÈü≥ÊïàÔºàÊöÇÊó∂‰øùÁïôÔºâ
            playGenerateTreasure() {
                this.playButtonClick(); // ‰ΩøÁî®ÈªëËΩ¥ÁÇπÂáªÈü≥Êïà
            },
            
            // ÊâîËøõÂÆùÁÆ±Èü≥ÊïàÔºàÊöÇÊó∂‰øùÁïôÔºâ
            playSaveTreasure() {
                if (this.isMuted || !this.context) return;
                
                const now = this.context.currentTime;
                
                // ÊéâËêΩÂ£∞
                const osc = this.context.createOscillator();
                const gain = this.context.createGain();
                
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.exponentialRampToValueAtTime(200, now + 0.3);
                
                gain.gain.setValueAtTime(0.15, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
                
                osc.connect(gain);
                gain.connect(this.context.destination);
                
                osc.start();
                osc.stop(now + 0.3);
            },
            
            // ÊäΩÂèñÂÆùËóèÈü≥ÊïàÔºàÊöÇÊó∂‰øùÁïôÔºâ
            playDrawTreasure() {
                this.playButtonClick(); // ‰ΩøÁî®ÈªëËΩ¥ÁÇπÂáªÈü≥Êïà
            },
            
            // Âà†Èô§Èü≥ÊïàÔºà‰ΩøÁî®ÈªëËΩ¥Ôºâ
            playDelete() {
                this.playButtonClick();
            }
        };

        // Êï∞ÊçÆÈÖçÁΩÆ
        const EMOTIONS = ['ÂÖ¥Â•ã', 'ÂñúÊÇ¶', 'Êª°Ë∂≥', 'ÂÆâÂÆÅ', 'ÊúüÂæÖ', 'Âπ≥Èùô', 'ËàíÈÄÇ', 'ÁÉ¶Ë∫Å', 'ÁÑ¶Ëôë', 'Áñ≤ÊÉ´', 'ÊÇ≤‰º§', 'ÊÑ§ÊÄí', 'ÂæÆÂ¶ô'];
        
        const TREASURE_MAP = {
            'ÂÖ¥Â•ã':  ['Ë∑ÉÂä®ÈáëÂ∏Å', 'ÁáÉËµ∑ÁöÑÁÅ´ÁÇ¨', 'ÂºÄÂ∞ÅÁöÑÂ∫ÜÂÖ∏ÈÖíÊùØ'],
            'ÂñúÊÇ¶':  ['Êô®ÂÖâËä±ÁéØ', 'ÈáëËâ≤ÈìÉÈìõ', 'ÊµÅÂÖâÂÆùÁü≥'],
            'Êª°Ë∂≥':  ['Ê≤âÁî∏ÁöÑÈáëÂ∏Å', 'ÂΩíÂ∑¢ÁæΩÁøé', 'Â∞ÅÂ≠òÁöÑÁê•ÁèÄ'],
            'ÂÆâÂÆÅ':  ['ÈùôÊ∞¥Êä§Á¨¶', 'ÊúàÂÖâË¥ùÂ£≥', 'ÂëºÂê∏Ê≤ôÊºè'],
            'ÊúüÂæÖ':  ['Êú™ÂºÄÁöÑÊºÇÊµÅÁì∂', 'ÊÇ¨ÊåÇÁöÑÊòüËæ∞', 'ÂæÖÂ∞ÅÁöÑ‰ø°‰ª∂'],
            'Âπ≥Èùô':  ['Â§úËâ≤Ê∞¥Êô∂', 'Êó†È£éÁöÑÁæΩÊØõ', 'ÈïáÂÆöÁ¨¶Êñá'],
            'ËàíÈÄÇ':  ['ÊöñÊó•ÂÆùÁü≥', 'ËΩªÁõàÊ†ëÂè∂', 'Ê∏©Ê∂¶ÁéâÊàí'],
            'ÁÉ¶Ë∫Å':  ['Ë£ÇÁºùÈáëÂ∏Å', 'ÊâìÁªìÁöÑÁæΩÊØõ', 'ÂêµÈóπÁöÑÁ©∫Áì∂'],
            'ÁÑ¶Ëôë':  ['Êú™Â∞ÅÂè£ÁöÑ‰ø°‰ª∂', 'ÈúáÈ¢§Ê∞¥Êô∂', 'ÂÄíÊµÅÊ≤ôÊºè'],
            'Áñ≤ÊÉ´':  ['Á£®ÊçüÁöÑÈìÅÊàí', '‰ΩéÂûÇÁöÑÁæΩÁøé', 'Ê≤âÈªòÈ™®Â§¥'],
            'ÊÇ≤‰º§':  ['Á¢éË£ÇÁöÑËä±ÁéØ', 'Ê®°Á≥äÁöÑÊúà‰∫Æ', 'Á†¥ÊçüÁöÑË¥ùÂ£≥'],
            'ÊÑ§ÊÄí':  ['ÁÅºÁÉ≠Áü≠Ââë', 'ÁáÉÁÉßÁ¨¶Êñá', 'Á†¥Á¢éÁéãÂç∞'],
            'ÂæÆÂ¶ô':  ['Êú¶ËÉßÊ∞¥Êô∂', 'ÂæÖËæ®ÁöÑÁ¨¶Êñá', 'ÂçäÂºÄÁöÑÊºÇÊµÅÁì∂']
        };

        // ‰πåÈ∏¶ËØ≠Ë®ÄÁ≥ªÁªü - Ê†πÊçÆÊÉÖÁª™Êô∫ËÉΩÂåπÈÖçËØÑËÆ∫
        const RAVEN_LANGUAGE = {
            version: "1.0",
            character: {
                name: "‰πåÈ∏¶",
                role: "ËßÅËØÅËÄÖ",
                personality: ["‰∏≠Á´ã", "ÂÖãÂà∂", "Áï•Â∏¶ÂÇ≤Â®á", "‰∏çËØ¥Êïô", "‰∏çËØÑÂà§"],
                tone: "‰ΩéÂ£∞„ÄÅÂÜ∑Èùô„ÄÅËØóÊÄß„ÄÅÁÆÄÁü≠"
            },
            emotions: {
                'ÂÖ¥Â•ã': [
                    "ËøôËÇ°Âä≤ÂÑøÔºåÊàëÊõø‰Ω†ËÆ∞‰Ωè‰∫Ü„ÄÇ",
                    "‰Ω†Áé∞Âú®ÂÉè‰∏ÄÊ†πË¢´ÁÇπÁáÉÁöÑËú°ÁÉõÔºå‰ªéÂÜÖÈÉ®ÁÖß‰∫Æ„ÄÇ",
                    "Â•ΩÂ•ΩÁÉßÁùÄÂêßÔºåÂà´ÊÄ•ÁùÄÁÜÑÁÅ≠ÂÆÉ„ÄÇ"
                ],
                'ÂñúÊÇ¶': [
                    "‰∏çÂº†Êâ¨ÔºåÂç¥ÂàöÂàöÂ•Ω„ÄÇ",
                    "‰Ω†Áé∞Âú®ÁöÑÂøÉÊÉÖÔºåÂÉè‰∏ÄÂùóË¢´Èò≥ÂÖâÊôíÊöñÁöÑÁü≥Â§¥„ÄÇ",
                    "ËøôÁßçÈ´òÂÖ¥Ôºå‰∏çÈúÄË¶ÅËß£Èáä„ÄÇ",
                    "‰Ω†Á´ôÂú®ÂÖâÈáåÔºåËÄå‰∏çÊòØË¢´ÂÆÉËøΩÁùÄË∑ë„ÄÇ"
                ],
                'Êª°Ë∂≥': [
                    "ÂóØ„ÄÇÂ§ü‰∫Ü„ÄÇ",
                    "ËøôÁßçË∏èÂÆûÔºå‰∏çÊòØÊØèÂ§©ÈÉΩÊúâÁöÑ„ÄÇ",
                    "‰Ω†Áé∞Âú®ÁöÑÊ≠•‰ºêÔºåÂæàÁ®≥„ÄÇ",
                    "È£éÂæàÈ°∫ÔºåÂ∏åÊúõ‰∏ÄÁõ¥ËøôÊ†∑Âêπ‰∏ãÂéª„ÄÇ"
                ],
                'ÂÆâÂÆÅ': [
                    "Ê≤°Êúâ‰ªÄ‰πàÂú®ÊãâÊâØ‰Ω†„ÄÇ",
                    "‰Ω†Áé∞Âú®ÔºåÂæàÂÆåÊï¥„ÄÇ",
                    "ÂÆâÈùôÁöÑÊó∂ÂÄôÔºåÂæàÂ§ö‰∏úË•ø‰ºöËá™Â∑±ÂΩí‰Ωç„ÄÇ",
                    "Êàë‰ºöËΩªËΩªÂêà‰∏äËøô‰∏ÄÈ°µ„ÄÇ"
                ],
                'ÊúüÂæÖ': [
                    "Êúâ‰∫õÈó®ÔºåËøòÊ≤°ÂºÄ„ÄÇ‰ΩÜ‰Ω†Â∑≤ÁªèÁ´ôÂú®Èó®Âè£‰∫Ü„ÄÇ",
                    "‰Ω†Áé∞Âú®ÁöÑÁúºÁ•ûÔºåÊúâÁÇπ‰∫Æ„ÄÇ",
                    "Á≠âÂæÖ‰πüÊòØ‰∏ÄÁßçË°åÂä®„ÄÇ"
                ],
                'Âπ≥Èùô': [
                    "ËøôÁßçÁä∂ÊÄÅÔºå‰∏çÈúÄË¶ÅË¢´ÊâìÊâ∞„ÄÇ",
                    "ÂëºÂê∏ÊØîÊÉ≥Ê≥ïÊõ¥ÂèØÈù†„ÄÇ",
                    "‰Ω†Âè™ÊòØÂú®ËøôÈáå„ÄÇËøôÂ∞±Â§ü‰∫Ü„ÄÇ"
                ],
                'ËàíÈÄÇ': [
                    "‰Ω†Ê≠£Â•ΩÂú®ËØ•Âú®ÁöÑÂú∞Êñπ„ÄÇ",
                    "‰∏çÁî®Ëµ∞Ôºå‰πü‰∏çÁî®ÂÅö‰ªÄ‰πà„ÄÇ",
                    "Ëøô‰∏ÄÂàªÔºåÂÉè‰∏Ä‰ª∂ÂàöÂ•ΩÂêàË∫´ÁöÑÊóßË°£Êúç„ÄÇ"
                ],
                'ÁÉ¶Ë∫Å': [
                    "ÊàëÊáÇÔºåËøô‰∏çÊòØÂ§ß‰∫ãÔºå‰ΩÜÂæàÁ£®‰∫∫„ÄÇ",
                    "ËøôËÇ°ÁÉ¶ÊÑèÔºåÊ≤°ÊúâÂΩ¢Áä∂ÔºåÂç¥Âà∞Â§ÑÈÉΩÊòØ„ÄÇ",
                    "Êúâ‰∫õÊÉÖÁª™ÔºåÂè™ÊòØÊù•Êï≤‰∏Ä‰∏ãÈó®„ÄÇ",
                    "ËÆ∞ÂΩï‰∏ãÊù•Â∞±Â•ΩÔºåÊàë‰ºöÊõø‰Ω†ÁúãÁùÄ„ÄÇ"
                ],
                'ÁÑ¶Ëôë': [
                    "‰Ω†Ê≠£Âú®‰∏∫ËøòÊ≤°ÂèëÁîüÁöÑ‰∫ãÊ∂àËÄóËá™Â∑±„ÄÇ",
                    "‰Ω†ÁöÑÂëºÂê∏ÔºåÊØî‰Ω†ÁöÑÊÉ≥Ê≥ïÊÖ¢„ÄÇ",
                    "Áé∞Âú®Ëøô‰∏ÄÂàªÔºåÂπ∂Ê≤°Êúâ‰Ω†ÊÉ≥ÁöÑÈÇ£‰πàÂç±Èô©„ÄÇ",
                    "ÊîæÂú®ËøôÈáåÂêßÔºåËá≥Â∞ëÁé∞Âú®‰∏çÁî®‰∏ÄÁõ¥Êä±ÁùÄÂÆÉ„ÄÇ"
                ],
                'Áñ≤ÊÉ´': [
                    "‰Ω†ÊâõÂæóÂ§™‰πÖ‰∫ÜÔºå‰ΩÜ‰Ω†Ê≤°ËØ¥„ÄÇ",
                    "‰∏çÊòØ‰Ω†‰∏çÂ§üÂ•ΩÔºåÊòØ‰∫ãÊÉÖÂ§™Â§ö„ÄÇ",
                    "‰Ω†Â∑≤ÁªèËµ∞‰∫ÜÂæàËøú„ÄÇÂèØ‰ª•ÂÖàÂÅúÂú®ËøôÈáå„ÄÇ",
                    "ÊääÂÆÉÊîæËøõÁÆ±Â≠êÈáåÔºåÂì™ÊÄïÂè™ÊòØ‰∏Ä‰ºöÂÑø„ÄÇ"
                ],
                'ÊÇ≤‰º§': [
                    "ÊàëÁúãËßÅ‰∫Ü„ÄÇ‰Ω†‰∏çÁî®Ëß£Èáä„ÄÇ",
                    "Êúâ‰∫õÈáçÈáèÔºå‰∏çÈúÄË¶ÅÁ´ãÂàªÂèòËΩª„ÄÇ",
                    "‰Ω†Áé∞Âú®ËÉΩÊÑüËßâÂà∞ÂÆÉÔºåËØ¥Êòé‰Ω†ËøòÂú®„ÄÇ",
                    "ËøôÈáåÊòØÂÆâÂÖ®ÁöÑ„ÄÇ"
                ],
                'ÊÑ§ÊÄí': [
                    "ËøôÊòØÊ∏ÖÈÜíÁöÑ‰ø°Âè∑Ôºå‰∏çÊòØÂ§±Êéß„ÄÇ",
                    "Êúâ‰∏úË•øË∂äÁïå‰∫Ü„ÄÇ",
                    "‰Ω†ÁöÑÊÑ§ÊÄíÔºåÂæàÊòéÁ°Æ„ÄÇ",
                    "‰∏çÂøÖÁ´ãÂàªË°åÂä®Ôºå‰ΩÜ‰πüÂà´ÂÅáË£ÖÊ≤°ÂèëÁîü„ÄÇ"
                ],
                'ÂæÆÂ¶ô': [
                    "ËØ¥‰∏çÊ∏ÖÊ•öÔºå‰πüÊòØ‰∏ÄÁßçÊÑüÂèó„ÄÇ",
                    "Êúâ‰∫õ‰∏úË•øÔºåËøòÊ≤°ÈïøÂá∫ÂêçÂ≠ó„ÄÇ",
                    "‰Ω†Ê≥®ÊÑèÂà∞‰∫ÜÔºåËøôÂ∞±Â§ü‰∫Ü„ÄÇ"
                ]
            },
            // ÈÄöÁî®ËØÑËÆ∫ÔºàÂΩìÊó†Ê≥ïÂåπÈÖçÊÉÖÁª™Êó∂‰ΩøÁî®Ôºâ
            general: [
                "Êî∂‰∏ã‰∫Ü„ÄÇ",
                "‰πåÈ∏¶ËÆ∞‰Ωè‰∫Ü„ÄÇ",
                "‰∏çÊòØÈöè‰æø‰ªÄ‰πàÈÉΩ‰ºöË¢´Áïô‰∏ã„ÄÇ",
                "Ëøô‰∏Ä‰ª∂Ôºå‰Ω†ÂΩìÊó∂ÊîæÂæóÂæàÊÄ•„ÄÇ",
                "‰Ω†‰ª•ÂâçÁïô‰∏ãÁöÑ„ÄÇ",
                "ËøôÈáåËøòÂæàÂÆâÈùô„ÄÇ"
            ]
        };

        // Ëé∑Âèñ‰πåÈ∏¶ËØÑËÆ∫ÁöÑÂáΩÊï∞
        function getRavenComment(emotion) {
            // Â¶ÇÊûúÊúâÂØπÂ∫îÊÉÖÁª™ÁöÑËØÑËÆ∫Ôºå‰ªé‰∏≠ÈöèÊú∫ÈÄâÊã©
            if (RAVEN_LANGUAGE.emotions[emotion] && RAVEN_LANGUAGE.emotions[emotion].length > 0) {
                const comments = RAVEN_LANGUAGE.emotions[emotion];
                return comments[Math.floor(Math.random() * comments.length)];
            }
            // Âê¶Âàô‰ΩøÁî®ÈÄöÁî®ËØÑËÆ∫
            return RAVEN_LANGUAGE.general[Math.floor(Math.random() * RAVEN_LANGUAGE.general.length)];
        }

        // Ê†πÊçÆiconTypeÁîüÊàêÂÆùËóèSVGÂõæÊ°à
        function getTreasureSVGByType(iconType) {
            const C = '#C9A961';
            const D = '#8B6F47';
            const svgMap = {
                // ‚îÄ‚îÄ Â∑≤ÂÆûÁé∞ (1-15) ‚îÄ‚îÄ
                1: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="50" cy="50" r="35" fill="${C}" stroke="${D}" stroke-width="3"/>
                      <circle cx="50" cy="50" r="28" fill="none" stroke="${D}" stroke-width="2"/>
                      <text x="50" y="60" text-anchor="middle" font-size="32" font-weight="bold" fill="${D}">¬•</text>
                    </svg>`,
                2: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M50 12Q47 35 45 58Q43 78 41 92" fill="none" stroke="${C}" stroke-width="4" stroke-linecap="round"/>
                      <path d="M46 28Q28 30 23 33" fill="none" stroke="${C}" stroke-width="2"/>
                      <path d="M45 39Q26 41 20 44" fill="none" stroke="${C}" stroke-width="2"/>
                      <path d="M44 50Q24 52 18 55" fill="none" stroke="${C}" stroke-width="2"/>
                      <path d="M43 61Q22 63 16 66" fill="none" stroke="${C}" stroke-width="2"/>
                      <path d="M54 28Q72 30 77 33" fill="none" stroke="${C}" stroke-width="2"/>
                      <path d="M55 39Q74 41 80 44" fill="none" stroke="${C}" stroke-width="2"/>
                      <path d="M56 50Q76 52 82 55" fill="none" stroke="${C}" stroke-width="2"/>
                      <path d="M57 61Q78 63 84 66" fill="none" stroke="${C}" stroke-width="2"/>
                    </svg>`,
                3: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M 30 20 L 35 60 Q 35 75, 50 75 Q 65 75, 65 60 L 70 20 Z" fill="${C}" stroke="${C}" stroke-width="3"/>
                      <rect x="25" y="15" width="50" height="8" fill="${C}" rx="2"/>
                      <rect x="45" y="75" width="10" height="15" fill="${C}"/>
                      <rect x="35" y="88" width="30" height="5" fill="${C}" rx="2"/>
                    </svg>`,
                4: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <g transform="rotate(-10 50 50)">
                        <path d="M 42 25 L 42 35 Q 40 40, 40 45 L 40 70 Q 40 75, 45 75 L 55 75 Q 60 75, 60 70 L 60 45 Q 60 40, 58 35 L 58 25 Z" fill="none" stroke="${C}" stroke-width="3"/>
                        <rect x="44" y="18" width="12" height="7" fill="none" stroke="${C}" stroke-width="3"/>
                        <ellipse cx="50" cy="18" rx="6" ry="2" fill="none" stroke="${C}" stroke-width="2"/>
                      </g>
                    </svg>`,
                5: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="50" cy="50" r="30" fill="none" stroke="${C}" stroke-width="4"/>
                      <circle cx="50" cy="20" r="8" fill="${C}"/>
                      <circle cx="80" cy="50" r="8" fill="${C}"/>
                      <circle cx="50" cy="80" r="8" fill="${C}"/>
                      <circle cx="20" cy="50" r="8" fill="${C}"/>
                      <circle cx="65" cy="30" r="6" fill="${D}"/>
                      <circle cx="70" cy="70" r="6" fill="${D}"/>
                      <circle cx="30" cy="70" r="6" fill="${D}"/>
                      <circle cx="35" cy="30" r="6" fill="${D}"/>
                    </svg>`,
                6: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M 50 20 L 35 60 Q 35 70, 50 70 Q 65 70, 65 60 L 50 20 Z" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <circle cx="50" cy="72" r="6" fill="${D}"/>
                      <line x1="50" y1="10" x2="50" y2="20" stroke="${D}" stroke-width="3"/>
                      <circle cx="50" cy="10" r="4" fill="${C}"/>
                    </svg>`,
                7: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M 25 30 Q 20 50, 25 70 L 75 70 Q 80 50, 75 30 Z" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <ellipse cx="25" cy="50" rx="5" ry="22" fill="${D}"/>
                      <ellipse cx="23" cy="50" rx="3" ry="20" fill="${C}"/>
                      <ellipse cx="75" cy="50" rx="5" ry="22" fill="${D}"/>
                      <ellipse cx="77" cy="50" rx="3" ry="20" fill="${C}"/>
                      <line x1="35" y1="40" x2="65" y2="40" stroke="${D}" stroke-width="2"/>
                      <line x1="35" y1="50" x2="65" y2="50" stroke="${D}" stroke-width="2"/>
                      <line x1="35" y1="60" x2="65" y2="60" stroke="${D}" stroke-width="2"/>
                    </svg>`,
                // Ë°•ÂÆåÁº∫Â§±
                8: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <rect x="20" y="30" width="60" height="42" fill="none" stroke="${C}" stroke-width="3" rx="2"/>
                      <path d="M 20 30 L 50 55 L 80 30" fill="none" stroke="${C}" stroke-width="2.5"/>
                      <line x1="30" y1="62" x2="50" y2="62" stroke="${C}" stroke-width="1.5" opacity="0.6"/>
                      <line x1="30" y1="68" x2="45" y2="68" stroke="${C}" stroke-width="1.5" opacity="0.6"/>
                      <circle cx="50" cy="55" r="5" fill="${C}" opacity="0.4"/>
                    </svg>`,
                9: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <polygon points="50,20 68,35 68,65 50,80 32,65 32,35" fill="${C}" stroke="${D}" stroke-width="2.5"/>
                      <polygon points="50,12 62,50 50,88 38,50" fill="none" stroke="${D}" stroke-width="2"/>
                      <circle cx="50" cy="50" r="10" fill="${D}" opacity="0.5"/>
                      <circle cx="50" cy="50" r="5" fill="${D}"/>
                      <line x1="50" y1="12" x2="50" y2="20" stroke="${D}" stroke-width="2.5" stroke-linecap="round"/>
                      <line x1="50" y1="80" x2="50" y2="88" stroke="${D}" stroke-width="2.5" stroke-linecap="round"/>
                    </svg>`,
                10: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <polygon points="50,18 72,38 62,76 38,76 28,38" fill="${C}" stroke="${D}" stroke-width="2.5"/>
                      <polygon points="50,18 72,38 50,50" fill="${D}" opacity="0.45"/>
                      <polygon points="50,18 28,38 50,50" fill="${D}" opacity="0.25"/>
                      <path d="M28 38L50 50L38 76" fill="${D}" opacity="0.2"/>
                      <path d="M72 38L50 50L62 76" fill="${C}" opacity="0.6"/>
                      <circle cx="44" cy="32" r="3.5" fill="white" opacity="0.35"/>
                    </svg>`,
                11: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M 28 18 L 72 18 L 72 22 L 55 45 L 55 55 L 72 78 L 72 82 L 28 82 L 28 78 L 45 55 L 45 45 L 28 22 Z" fill="none" stroke="${C}" stroke-width="3"/>
                      <path d="M 30 20 L 70 20 L 53 44 L 47 44 Z" fill="${C}" opacity="0.5"/>
                      <path d="M 47 56 L 53 56 L 70 80 L 30 80 Z" fill="${C}" opacity="0.3"/>
                      <circle cx="50" cy="50" r="3" fill="${C}"/>
                      <line x1="28" y1="18" x2="72" y2="18" stroke="${C}" stroke-width="3.5"/>
                      <line x1="28" y1="82" x2="72" y2="82" stroke="${C}" stroke-width="3.5"/>
                    </svg>`,
                12: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <polygon points="50,20 65,40 60,70 40,70 35,40" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <line x1="50" y1="20" x2="50" y2="70" stroke="${D}" stroke-width="2"/>
                      <line x1="35" y1="40" x2="65" y2="40" stroke="${D}" stroke-width="2"/>
                      <line x1="40" y1="70" x2="65" y2="40" stroke="${D}" stroke-width="1" opacity="0.5"/>
                      <line x1="60" y1="70" x2="35" y2="40" stroke="${D}" stroke-width="1" opacity="0.5"/>
                      <circle cx="45" cy="35" r="3" fill="white" opacity="0.6"/>
                    </svg>`,
                13: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="50" cy="50" r="28" fill="none" stroke="${C}" stroke-width="8"/>
                      <circle cx="50" cy="50" r="28" fill="none" stroke="${D}" stroke-width="2"/>
                      <circle cx="50" cy="50" r="20" fill="none" stroke="${D}" stroke-width="1" opacity="0.5"/>
                      <ellipse cx="50" cy="22" rx="8" ry="5" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <rect x="44" y="17" width="12" height="5" fill="${C}" rx="1"/>
                      <circle cx="50" cy="17" r="4" fill="${D}"/>
                      <circle cx="50" cy="17" r="2" fill="${C}" opacity="0.6"/>
                    </svg>`,
                14: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <rect x="25" y="40" width="50" height="35" fill="${C}" stroke="${D}" stroke-width="3"/>
                      <path d="M 25 40 L 35 30 L 85 30 L 75 40 Z" fill="${D}"/>
                      <rect x="25" y="40" width="50" height="8" fill="${D}"/>
                      <rect x="47" y="52" width="6" height="15" fill="${D}" rx="1"/>
                      <circle cx="50" cy="62" r="3" fill="${C}"/>
                      <line x1="30" y1="48" x2="70" y2="48" stroke="${C}" stroke-width="2"/>
                    </svg>`,
                15: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M 25 55 L 30 40 L 50 50 L 70 40 L 75 55 L 65 65 L 35 65 Z" fill="${C}" stroke="${D}" stroke-width="3"/>
                      <circle cx="30" cy="40" r="5" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <circle cx="50" cy="50" r="5" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <circle cx="70" cy="40" r="5" fill="${C}" stroke="${D}" stroke-width="2"/>
                    </svg>`,
                16: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M 50 12 L 54 55 L 50 62 L 46 55 Z" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <rect x="36" y="55" width="28" height="5" fill="${D}" rx="1"/>
                      <rect x="46" y="60" width="8" height="22" fill="${C}" stroke="${D}" stroke-width="1.5" rx="2"/>
                      <line x1="50" y1="12" x2="50" y2="55" stroke="${D}" stroke-width="1" opacity="0.5"/>
                    </svg>`,
                // Êñ∞Â¢û
                17: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="38" cy="38" r="20" fill="none" stroke="${C}" stroke-width="4"/>
                      <circle cx="38" cy="38" r="11" fill="none" stroke="${C}" stroke-width="2"/>
                      <line x1="54" y1="52" x2="88" y2="86" stroke="${C}" stroke-width="5" stroke-linecap="round"/>
                      <line x1="72" y1="69" x2="78" y2="63" stroke="${C}" stroke-width="4" stroke-linecap="round"/>
                      <line x1="82" y1="79" x2="88" y2="73" stroke="${C}" stroke-width="4" stroke-linecap="round"/>
                    </svg>`,
                18: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M 25 20 L 25 80 Q 25 85, 30 85 L 75 85 L 75 20 Z" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <rect x="22" y="18" width="8" height="67" fill="${D}" rx="1"/>
                      <line x1="35" y1="35" x2="68" y2="35" stroke="${D}" stroke-width="2"/>
                      <line x1="35" y1="45" x2="68" y2="45" stroke="${D}" stroke-width="2"/>
                      <line x1="35" y1="55" x2="68" y2="55" stroke="${D}" stroke-width="2"/>
                      <line x1="35" y1="65" x2="55" y2="65" stroke="${D}" stroke-width="2"/>
                    </svg>`,
                19: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <polygon points="50,15 58,38 83,38 63,53 71,76 50,62 29,76 37,53 17,38 42,38" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <polygon points="50,28 55,40 68,40 58,48 62,60 50,53 38,60 42,48 32,40 45,40" fill="${D}" opacity="0.5"/>
                    </svg>`,
                20: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M 55 18 A 34 34 0 1 0 55 82 A 22 22 0 1 1 55 18 Z" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <circle cx="62" cy="36" r="4" fill="${D}" opacity="0.5"/>
                      <circle cx="58" cy="58" r="3" fill="${D}" opacity="0.4"/>
                      <circle cx="70" cy="50" r="2.5" fill="${D}" opacity="0.3"/>
                    </svg>`,
                21: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <rect x="38" y="48" width="24" height="38" fill="${C}" stroke="${D}" stroke-width="2" rx="2"/>
                      <path d="M 38 48 Q 38 44, 42 44 L 58 44 Q 62 44, 62 48" fill="${D}" stroke="${D}" stroke-width="1"/>
                      <path d="M 50 44 Q 50 34, 46 28 Q 50 32, 54 28 Q 50 34, 50 44" fill="#E8A030" stroke="none"/>
                      <path d="M 50 44 Q 50 38, 48 34 Q 50 37, 52 34 Q 50 38, 50 44" fill="#F0C060" stroke="none"/>
                      <ellipse cx="50" cy="30" rx="4" ry="5" fill="#E8A030" opacity="0.3"/>
                    </svg>`,
                22: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <ellipse cx="50" cy="44" rx="26" ry="30" fill="none" stroke="${C}" stroke-width="4"/>
                      <ellipse cx="50" cy="44" rx="21" ry="25" fill="none" stroke="${D}" stroke-width="1.5"/>
                      <path d="M 42 74 L 42 85 L 58 85 L 58 74" fill="${D}" stroke="${C}" stroke-width="2"/>
                      <line x1="45" y1="85" x2="55" y2="85" stroke="${C}" stroke-width="3"/>
                      <ellipse cx="42" cy="36" rx="5" ry="7" fill="white" opacity="0.15" transform="rotate(-20 42 36)"/>
                    </svg>`,
                23: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M 42 32 L 35 50 Q 28 65, 35 75 Q 42 85, 50 85 Q 58 85, 65 75 Q 72 65, 65 50 L 58 32 Z" fill="${C}" stroke="${D}" stroke-width="2.5" opacity="0.85"/>
                      <rect x="42" y="22" width="16" height="10" fill="none" stroke="${C}" stroke-width="2.5" rx="2"/>
                      <rect x="44" y="18" width="12" height="4" fill="${C}" rx="1"/>
                      <path d="M 38 55 Q 50 48, 62 55" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.6"/>
                      <circle cx="44" cy="65" r="4" fill="white" opacity="0.25"/>
                      <circle cx="56" cy="70" r="3" fill="white" opacity="0.2"/>
                    </svg>`,
                // ‚îÄ‚îÄ Ëá™ÁÑ∂ÂÖÉÁ¥† ‚îÄ‚îÄ
                27: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="50" cy="50" r="20" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <circle cx="50" cy="50" r="10" fill="${D}" opacity="0.3"/>
                      <line x1="50" y1="12" x2="50" y2="24" stroke="${C}" stroke-width="3" stroke-linecap="round"/>
                      <line x1="50" y1="76" x2="50" y2="88" stroke="${C}" stroke-width="3" stroke-linecap="round"/>
                      <line x1="12" y1="50" x2="24" y2="50" stroke="${C}" stroke-width="3" stroke-linecap="round"/>
                      <line x1="76" y1="50" x2="88" y2="50" stroke="${C}" stroke-width="3" stroke-linecap="round"/>
                      <line x1="23" y1="23" x2="31" y2="31" stroke="${C}" stroke-width="3" stroke-linecap="round"/>
                      <line x1="69" y1="69" x2="77" y2="77" stroke="${C}" stroke-width="3" stroke-linecap="round"/>
                      <line x1="77" y1="23" x2="69" y2="31" stroke="${C}" stroke-width="3" stroke-linecap="round"/>
                      <line x1="23" y1="77" x2="31" y2="69" stroke="${C}" stroke-width="3" stroke-linecap="round"/>
                    </svg>`,
                28: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <ellipse cx="50" cy="28" rx="10" ry="16" fill="${C}" stroke="${D}" stroke-width="1.5" opacity="0.9"/>
                      <ellipse cx="50" cy="28" rx="10" ry="16" fill="${C}" stroke="${D}" stroke-width="1.5" opacity="0.9" transform="rotate(60 50 50)"/>
                      <ellipse cx="50" cy="28" rx="10" ry="16" fill="${C}" stroke="${D}" stroke-width="1.5" opacity="0.9" transform="rotate(120 50 50)"/>
                      <ellipse cx="50" cy="28" rx="10" ry="16" fill="${C}" stroke="${D}" stroke-width="1.5" opacity="0.7" transform="rotate(180 50 50)"/>
                      <ellipse cx="50" cy="28" rx="10" ry="16" fill="${C}" stroke="${D}" stroke-width="1.5" opacity="0.7" transform="rotate(240 50 50)"/>
                      <ellipse cx="50" cy="28" rx="10" ry="16" fill="${C}" stroke="${D}" stroke-width="1.5" opacity="0.7" transform="rotate(300 50 50)"/>
                      <circle cx="50" cy="50" r="10" fill="${D}"/>
                      <circle cx="50" cy="50" r="5" fill="${C}"/>
                    </svg>`,
                29: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <polygon points="50,14 56,34 78,34 61,47 67,67 50,55 33,67 39,47 22,34 44,34" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <polygon points="50,24 54,36 66,36 57,43 60,55 50,49 40,55 43,43 34,36 46,36" fill="${D}" opacity="0.28"/>
                      <circle cx="22" cy="21" r="3" fill="${C}" opacity="0.55"/>
                      <circle cx="80" cy="20" r="2" fill="${C}" opacity="0.45"/>
                    </svg>`,
                30: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M58 16A34 34 0 1 0 58 84A22 22 0 1 1 58 16Z" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <circle cx="36" cy="38" r="5" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.45"/>
                      <circle cx="42" cy="58" r="3.5" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.35"/>
                      <circle cx="30" cy="55" r="3" fill="none" stroke="${D}" stroke-width="1" opacity="0.35"/>
                    </svg>`,
                31: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M50 14C75 19 86 40 76 63C66 82 44 86 34 76C18 60 24 34 50 14Z" fill="${C}" stroke="${D}" stroke-width="2.5"/>
                      <path d="M50 14C48 40 46 60 40 78" fill="none" stroke="${D}" stroke-width="2"/>
                      <path d="M47 30Q62 35 70 42" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.7"/>
                      <path d="M45 46Q62 49 72 56" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.7"/>
                      <path d="M44 60Q57 62 65 68" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.5"/>
                      <path d="M47 30Q34 38 27 46" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.5"/>
                      <path d="M40 78Q38 88 42 93" fill="none" stroke="${D}" stroke-width="2.5" stroke-linecap="round"/>
                    </svg>`,
                32: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M15 50C25 30 40 20 50 20C60 20 75 30 85 50C75 70 60 80 50 80C40 80 25 70 15 50Z" fill="${C}" stroke="${D}" stroke-width="2.5"/>
                      <circle cx="50" cy="50" r="18" fill="${D}"/>
                      <circle cx="50" cy="50" r="9" fill="#2A1F1F"/>
                      <circle cx="55" cy="45" r="4" fill="white" opacity="0.5"/>
                      <circle cx="44" cy="54" r="2" fill="white" opacity="0.3"/>
                      <line x1="50" y1="20" x2="50" y2="14" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="62" y1="23" x2="65" y2="17" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="38" y1="23" x2="35" y2="17" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                    </svg>`,
                33: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M50 16C42 23 40 34 45 42C47 46 50 48 50 48C50 48 53 46 55 42C60 34 58 23 50 16Z" fill="${C}" opacity="0.9"/>
                      <path d="M50 22C46 29 45 36 48 41C49 43 50 44 50 44C50 44 51 43 52 41C55 36 54 29 50 22Z" fill="${D}" opacity="0.4"/>
                      <line x1="50" y1="44" x2="50" y2="52" stroke="${D}" stroke-width="2.5"/>
                      <rect x="38" y="51" width="24" height="36" rx="3" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <path d="M38 60Q35 65 38 70" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.5"/>
                      <path d="M62 65Q65 70 62 75" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.5"/>
                      <ellipse cx="50" cy="87" rx="18" ry="4" fill="${D}" opacity="0.6"/>
                    </svg>`,
                34: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M50 82C28 82 16 65 16 50C16 38 22 28 50 22C78 28 84 38 84 50C84 65 72 82 50 82Z" fill="${C}" stroke="${D}" stroke-width="2.5"/>
                      <line x1="50" y1="22" x2="50" y2="82" stroke="${D}" stroke-width="1.5" opacity="0.5"/>
                      <path d="M50 22Q38 38 34 82" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.5"/>
                      <path d="M50 22Q62 38 66 82" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.5"/>
                      <path d="M50 22Q28 42 22 72" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.35"/>
                      <path d="M50 22Q72 42 78 72" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.35"/>
                      <path d="M20 54Q50 64 80 54" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.4"/>
                      <circle cx="50" cy="84" r="4" fill="${D}" opacity="0.7"/>
                    </svg>`,
                35: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="36" cy="36" r="20" fill="none" stroke="${C}" stroke-width="4.5"/>
                      <circle cx="36" cy="36" r="10" fill="none" stroke="${C}" stroke-width="2.5"/>
                      <line x1="50" y1="50" x2="82" y2="82" stroke="${C}" stroke-width="5" stroke-linecap="round"/>
                      <line x1="62" y1="65" x2="69" y2="58" stroke="${C}" stroke-width="4" stroke-linecap="round"/>
                      <line x1="71" y1="74" x2="78" y2="67" stroke="${C}" stroke-width="4" stroke-linecap="round"/>
                    </svg>`,
                36: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M16 54Q16 22 50 22Q84 22 84 54Z" fill="${C}" stroke="${D}" stroke-width="2.5"/>
                      <path d="M22 54Q26 48 30 50Q34 44 38 48Q44 40 50 44Q56 40 62 48Q66 44 70 50Q74 48 78 54Z" fill="${D}" opacity="0.28"/>
                      <rect x="40" y="54" width="20" height="28" rx="4" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <line x1="41" y1="66" x2="59" y2="66" stroke="${D}" stroke-width="1.5" opacity="0.4"/>
                      <circle cx="36" cy="36" r="5" fill="white" opacity="0.28"/>
                      <circle cx="62" cy="32" r="3.5" fill="white" opacity="0.22"/>
                      <circle cx="50" cy="28" r="4" fill="white" opacity="0.22"/>
                    </svg>`,
                37: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="28" cy="28" r="10" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <circle cx="72" cy="72" r="10" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <circle cx="72" cy="28" r="10" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <circle cx="28" cy="72" r="10" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <rect x="22" y="46" width="56" height="8" rx="4" fill="${C}" stroke="${D}" stroke-width="2" transform="rotate(-45 50 50)"/>
                      <rect x="22" y="46" width="56" height="8" rx="4" fill="${C}" stroke="${D}" stroke-width="2" transform="rotate(45 50 50)"/>
                    </svg>`,
                38: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <path d="M10 40C20 30 35 28 42 35C48 40 50 42 50 42C50 42 52 40 58 35C65 28 80 30 90 40C78 38 65 42 55 52C53 54 51 58 50 62C49 58 47 54 45 52C35 42 22 38 10 40Z" fill="${C}" stroke="${D}" stroke-width="2"/>
                      <line x1="50" y1="42" x2="50" y2="80" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="38" y1="72" x2="62" y2="72" stroke="${D}" stroke-width="2.5" stroke-linecap="round"/>
                    </svg>`,
                // ‚îÄ‚îÄ Êú∫Ê¢∞Â•áÁâ© ‚îÄ‚îÄ
                39: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="50" cy="50" r="22" fill="none" stroke="${C}" stroke-width="3"/>
                      <circle cx="50" cy="50" r="12" fill="${D}" opacity="0.3"/>
                      <circle cx="50" cy="50" r="7" fill="${D}"/>
                      <rect x="45" y="10" width="10" height="14" rx="2" fill="${C}"/>
                      <rect x="45" y="76" width="10" height="14" rx="2" fill="${C}"/>
                      <rect x="10" y="45" width="14" height="10" rx="2" fill="${C}"/>
                      <rect x="76" y="45" width="14" height="10" rx="2" fill="${C}"/>
                      <rect x="45" y="10" width="10" height="14" rx="2" fill="${C}" transform="rotate(45 50 50)"/>
                      <rect x="45" y="10" width="10" height="14" rx="2" fill="${C}" transform="rotate(-45 50 50)"/>
                      <rect x="45" y="10" width="10" height="14" rx="2" fill="${C}" transform="rotate(90 50 50)"/>
                      <rect x="45" y="10" width="10" height="14" rx="2" fill="${C}" transform="rotate(-90 50 50)"/>
                    </svg>`,
                41: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <rect x="28" y="28" width="44" height="44" rx="4" fill="${C}" stroke="${D}" stroke-width="2.5"/>
                      <rect x="34" y="34" width="32" height="32" rx="2" fill="none" stroke="${D}" stroke-width="1.5" opacity="0.5"/>
                      <line x1="38" y1="44" x2="62" y2="44" stroke="${D}" stroke-width="1.5" opacity="0.6"/>
                      <line x1="38" y1="50" x2="62" y2="50" stroke="${D}" stroke-width="1.5" opacity="0.6"/>
                      <line x1="38" y1="56" x2="62" y2="56" stroke="${D}" stroke-width="1.5" opacity="0.6"/>
                      <line x1="34" y1="28" x2="34" y2="16" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="42" y1="28" x2="42" y2="16" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="50" y1="28" x2="50" y2="16" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="58" y1="28" x2="58" y2="16" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="34" y1="72" x2="34" y2="84" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="42" y1="72" x2="42" y2="84" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="50" y1="72" x2="50" y2="84" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="58" y1="72" x2="58" y2="84" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="28" y1="38" x2="16" y2="38" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="28" y1="50" x2="16" y2="50" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="28" y1="62" x2="16" y2="62" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="72" y1="38" x2="84" y2="38" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="72" y1="50" x2="84" y2="50" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                      <line x1="72" y1="62" x2="84" y2="62" stroke="${D}" stroke-width="2" stroke-linecap="round"/>
                    </svg>`,
                42: `<svg class="treasure-svg-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="50" cy="50" r="34" fill="none" stroke="${C}" stroke-width="2"/>
                      <circle cx="50" cy="50" r="22" fill="${C}" stroke="${D}" stroke-width="1.5" opacity="0.3"/>
                      <circle cx="50" cy="50" r="12" fill="${D}"/>
                      <circle cx="50" cy="50" r="6" fill="${C}" opacity="0.5"/>
                      <line x1="16" y1="50" x2="28" y2="50" stroke="${C}" stroke-width="1.5" opacity="0.5"/>
                      <line x1="72" y1="50" x2="84" y2="50" stroke="${C}" stroke-width="1.5" opacity="0.5"/>
                      <line x1="50" y1="16" x2="50" y2="28" stroke="${C}" stroke-width="1.5" opacity="0.5"/>
                      <line x1="50" y1="72" x2="50" y2="84" stroke="${C}" stroke-width="1.5" opacity="0.5"/>
                      <line x1="26" y1="26" x2="34" y2="34" stroke="${C}" stroke-width="1.5" opacity="0.4"/>
                      <line x1="66" y1="66" x2="74" y2="74" stroke="${C}" stroke-width="1.5" opacity="0.4"/>
                      <line x1="74" y1="26" x2="66" y2="34" stroke="${C}" stroke-width="1.5" opacity="0.4"/>
                      <line x1="26" y1="74" x2="34" y2="66" stroke="${C}" stroke-width="1.5" opacity="0.4"/>
                      <circle cx="43" cy="43" r="4" fill="white" opacity="0.3"/>
                    </svg>`,
            };
            return svgMap[iconType] || svgMap[12]; // ÈªòËÆ§Ê∞¥Êô∂
        }

        // ÁîüÊàêÂÆùËóèSVGÂõæÊ°à
        function getTreasureSVG(treasureName) {
            const color = '#C9A961';
            const darkColor = '#8B6F47';
            
            // ÈáëÂ∏ÅÁ±ª
            if (treasureName.includes('ÈáëÂ∏Å')) {
                const isCracked = treasureName.includes('Ë£ÇÂºÄ');
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="35" fill="${color}" stroke="${darkColor}" stroke-width="3"/>
                        <circle cx="50" cy="50" r="28" fill="none" stroke="${darkColor}" stroke-width="2"/>
                        <text x="50" y="60" text-anchor="middle" font-size="32" font-weight="bold" fill="${darkColor}">¬•</text>
                        ${isCracked ? '<path d="M 30 30 L 70 70 M 70 30 L 30 70" stroke="#A64B3A" stroke-width="3"/>' : ''}
                    </svg>
                `;
            }
            
            // ÁæΩÊØõÁ±ª
            if (treasureName.includes('ÁæΩ')) {
                const isTangled = treasureName.includes('ÊâìÁªì');
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <path d="M 50 15 Q 48 35, 46 55 Q 44 75, 42 90" 
                              fill="none" stroke="${color}" stroke-width="4" stroke-linecap="round"/>
                        ${!isTangled ? `
                            <path d="M 46 30 Q 30 32, 25 35" fill="none" stroke="${color}" stroke-width="2"/>
                            <path d="M 45 40 Q 28 42, 22 45" fill="none" stroke="${color}" stroke-width="2"/>
                            <path d="M 44 50 Q 26 52, 20 55" fill="none" stroke="${color}" stroke-width="2"/>
                            <path d="M 43 60 Q 24 62, 18 65" fill="none" stroke="${color}" stroke-width="2"/>
                            <path d="M 42 70 Q 22 72, 16 75" fill="none" stroke="${color}" stroke-width="2"/>
                            <path d="M 54 30 Q 70 32, 75 35" fill="none" stroke="${color}" stroke-width="2"/>
                            <path d="M 55 40 Q 72 42, 78 45" fill="none" stroke="${color}" stroke-width="2"/>
                            <path d="M 56 50 Q 74 52, 80 55" fill="none" stroke="${color}" stroke-width="2"/>
                            <path d="M 57 60 Q 76 62, 82 65" fill="none" stroke="${color}" stroke-width="2"/>
                            <path d="M 58 70 Q 78 72, 84 75" fill="none" stroke="${color}" stroke-width="2"/>
                        ` : `
                            <path d="M 46 45 Q 65 40, 55 60 Q 45 50, 50 70" fill="none" stroke="${color}" stroke-width="3"/>
                            <path d="M 54 45 Q 35 40, 45 60 Q 55 50, 50 70" fill="none" stroke="${color}" stroke-width="3"/>
                        `}
                    </svg>
                `;
            }
            
            // ÈÖíÊùØÁ±ª
            if (treasureName.includes('ÈÖíÊùØ')) {
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <path d="M 30 20 L 35 60 Q 35 75, 50 75 Q 65 75, 65 60 L 70 20 Z" 
                              fill="${color}" stroke="${color}" stroke-width="3"/>
                        <rect x="25" y="15" width="50" height="8" fill="${color}" rx="2"/>
                        <rect x="45" y="75" width="10" height="15" fill="${color}"/>
                    </svg>
                `;
            }
            
            // Á©∫Áì∂Á±ª
            if (treasureName.includes('Á©∫Áì∂')) {
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <g transform="rotate(-10 50 50)">
                            <path d="M 42 25 L 42 35 Q 40 40, 40 45 L 40 70 Q 40 75, 45 75 L 55 75 Q 60 75, 60 70 L 60 45 Q 60 40, 58 35 L 58 25 Z" 
                                  fill="none" stroke="${color}" stroke-width="3"/>
                            <rect x="44" y="18" width="12" height="7" fill="none" stroke="${color}" stroke-width="3"/>
                            <ellipse cx="50" cy="18" rx="6" ry="2" fill="none" stroke="${color}" stroke-width="2"/>
                            <path d="M 46 20 L 48 22 L 46 24 L 48 26" fill="none" stroke="#4A90E2" stroke-width="1.5"/>
                            <path d="M 54 20 L 52 22 L 54 24 L 52 26" fill="none" stroke="#4A90E2" stroke-width="1.5"/>
                            <path d="M 43 40 L 45 43 L 43 46 L 45 49 L 43 52" fill="none" stroke="#4A90E2" stroke-width="1.5" opacity="0.8"/>
                            <path d="M 50 42 L 52 45 L 50 48 L 52 51 L 50 54" fill="none" stroke="#4A90E2" stroke-width="1.5" opacity="0.8"/>
                            <path d="M 57 40 L 55 43 L 57 46 L 55 49 L 57 52" fill="none" stroke="#4A90E2" stroke-width="1.5" opacity="0.8"/>
                            <path d="M 46 58 L 48 61 L 46 64" fill="none" stroke="#4A90E2" stroke-width="1.5" opacity="0.6"/>
                            <path d="M 54 58 L 52 61 L 54 64" fill="none" stroke="#4A90E2" stroke-width="1.5" opacity="0.6"/>
                        </g>
                    </svg>
                `;
            }
            
            // Ëä±ÁéØÁ±ª
            if (treasureName.includes('Ëä±ÁéØ')) {
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="30" fill="none" stroke="${color}" stroke-width="4"/>
                        <circle cx="50" cy="20" r="8" fill="${color}"/>
                        <circle cx="80" cy="50" r="8" fill="${color}"/>
                        <circle cx="50" cy="80" r="8" fill="${color}"/>
                        <circle cx="20" cy="50" r="8" fill="${color}"/>
                        <circle cx="65" cy="30" r="6" fill="${darkColor}"/>
                        <circle cx="70" cy="70" r="6" fill="${darkColor}"/>
                        <circle cx="30" cy="70" r="6" fill="${darkColor}"/>
                        <circle cx="35" cy="30" r="6" fill="${darkColor}"/>
                    </svg>
                `;
            }
            
            // ÈìÉÈìõÁ±ª
            if (treasureName.includes('ÈìÉ')) {
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <path d="M 50 20 L 35 60 Q 35 70, 50 70 Q 65 70, 65 60 L 50 20 Z" 
                              fill="${color}" stroke="${darkColor}" stroke-width="2"/>
                        <circle cx="50" cy="72" r="6" fill="${darkColor}"/>
                        <line x1="50" y1="10" x2="50" y2="20" stroke="${darkColor}" stroke-width="3"/>
                        <circle cx="50" cy="10" r="4" fill="${color}"/>
                    </svg>
                `;
            }
            
            // Âç∑ËΩ¥Á±ª
            if (treasureName.includes('Âç∑ËΩ¥')) {
                const isUnfinished = treasureName.includes('Êú™ÂÆåÊàê');
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <path d="M 25 30 Q 20 50, 25 70 L 75 70 Q 80 50, 75 30 Z" 
                              fill="${color}" stroke="${darkColor}" stroke-width="2"/>
                        <ellipse cx="25" cy="50" rx="5" ry="22" fill="${darkColor}"/>
                        <ellipse cx="23" cy="50" rx="3" ry="20" fill="${color}"/>
                        <ellipse cx="75" cy="50" rx="5" ry="22" fill="${darkColor}"/>
                        <ellipse cx="77" cy="50" rx="3" ry="20" fill="${color}"/>
                        <line x1="35" y1="40" x2="65" y2="40" stroke="${darkColor}" stroke-width="2"/>
                        <line x1="35" y1="50" x2="65" y2="50" stroke="${darkColor}" stroke-width="2"/>
                        <line x1="35" y1="60" x2="${isUnfinished ? 50 : 65}" y2="60" stroke="${darkColor}" stroke-width="2"/>
                        ${isUnfinished ? '<text x="60" y="65" font-size="18" font-weight="bold" fill="#A64B3A">?</text>' : ''}
                    </svg>
                `;
            }
            
            // ‰ø°‰ª∂Á±ª
            if (treasureName.includes('‰ø°‰ª∂')) {
                const isUnsealed = treasureName.includes('Êú™Â∞ÅÂè£');
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        ${isUnsealed ? `
                            <rect x="28" y="20" width="44" height="60" fill="#D4C5A9" stroke="${darkColor}" stroke-width="2" rx="3"/>
                            <line x1="35" y1="20" x2="35" y2="80" stroke="${darkColor}" stroke-width="1" opacity="0.2"/>
                            <line x1="43" y1="20" x2="43" y2="80" stroke="${darkColor}" stroke-width="1" opacity="0.2"/>
                            <line x1="50" y1="20" x2="50" y2="80" stroke="${darkColor}" stroke-width="1" opacity="0.2"/>
                            <line x1="57" y1="20" x2="57" y2="80" stroke="${darkColor}" stroke-width="1" opacity="0.2"/>
                            <line x1="65" y1="20" x2="65" y2="80" stroke="${darkColor}" stroke-width="1" opacity="0.2"/>
                            <line x1="38" y1="28" x2="38" y2="60" stroke="${darkColor}" stroke-width="1.5"/>
                            <line x1="46" y1="28" x2="46" y2="60" stroke="${darkColor}" stroke-width="1.5"/>
                            <line x1="54" y1="28" x2="54" y2="60" stroke="${darkColor}" stroke-width="1.5"/>
                            <line x1="62" y1="28" x2="62" y2="45" stroke="${darkColor}" stroke-width="1.5"/>
                            <text x="62" y="58" font-size="16" font-weight="bold" fill="#A64B3A">‚Ä¶</text>
                            <path d="M 50 15 Q 45 17, 48 20" fill="none" stroke="#8B4513" stroke-width="2"/>
                            <path d="M 50 15 Q 55 17, 52 20" fill="none" stroke="#8B4513" stroke-width="2"/>
                            <circle cx="50" cy="15" r="2" fill="#8B4513"/>
                        ` : `
                            <rect x="28" y="25" width="44" height="50" fill="#D4C5A9" stroke="${darkColor}" stroke-width="2" rx="3"/>
                            <line x1="35" y1="25" x2="35" y2="75" stroke="${darkColor}" stroke-width="1" opacity="0.2"/>
                            <line x1="43" y1="25" x2="43" y2="75" stroke="${darkColor}" stroke-width="1" opacity="0.2"/>
                            <line x1="50" y1="25" x2="50" y2="75" stroke="${darkColor}" stroke-width="1" opacity="0.2"/>
                            <line x1="57" y1="25" x2="57" y2="75" stroke="${darkColor}" stroke-width="1" opacity="0.2"/>
                            <line x1="65" y1="25" x2="65" y2="75" stroke="${darkColor}" stroke-width="1" opacity="0.2"/>
                            <line x1="38" y1="33" x2="38" y2="67" stroke="${darkColor}" stroke-width="1.5"/>
                            <line x1="46" y1="33" x2="46" y2="67" stroke="${darkColor}" stroke-width="1.5"/>
                            <line x1="54" y1="33" x2="54" y2="67" stroke="${darkColor}" stroke-width="1.5"/>
                            <line x1="62" y1="33" x2="62" y2="67" stroke="${darkColor}" stroke-width="1.5"/>
                            <path d="M 35 22 Q 50 18, 65 22" fill="none" stroke="#8B4513" stroke-width="2.5"/>
                            <path d="M 48 18 L 48 28" fill="none" stroke="#8B4513" stroke-width="2"/>
                            <path d="M 52 18 L 52 28" fill="none" stroke="#8B4513" stroke-width="2"/>
                            <circle cx="50" cy="50" r="10" fill="#A64B3A"/>
                            <circle cx="50" cy="50" r="7" fill="none" stroke="${color}" stroke-width="1.5"/>
                            <text x="50" y="55" text-anchor="middle" font-size="11" font-weight="bold" fill="${color}">Â∞Å</text>
                        `}
                    </svg>
                `;
            }
            
            // Á¨¶ÊñáÁü≥Á±ª
            if (treasureName.includes('Á¨¶Êñá')) {
                const isBurning = treasureName.includes('ÁáÉÁÉß');
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <polygon points="50,15 70,40 65,70 35,70 30,40" fill="${color}" stroke="${darkColor}" stroke-width="3"/>
                        <text x="50" y="55" text-anchor="middle" font-size="28" font-weight="bold" fill="${darkColor}">·ö±</text>
                        ${isBurning ? `
                            <path d="M 45 10 Q 40 5, 42 0" fill="none" stroke="#E74C3C" stroke-width="2"/>
                            <path d="M 50 8 Q 48 3, 50 -2" fill="none" stroke="#E74C3C" stroke-width="2"/>
                            <path d="M 55 10 Q 58 5, 56 0" fill="none" stroke="#E74C3C" stroke-width="2"/>
                        ` : ''}
                    </svg>
                `;
            }
            
            // Áì∂Â≠êÁ±ªÔºàÊÄùÁª™‰πãÁì∂„ÄÅÂ∞ÅÂç∞‰∏≠ÁöÑÂ∞èÁì∂Ôºâ
            if (treasureName.includes('Áì∂') && !treasureName.includes('Á©∫Áì∂')) {
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <rect x="35" y="30" width="30" height="5" fill="${darkColor}"/>
                        <rect x="38" y="22" width="24" height="8" fill="${color}"/>
                        <path d="M 38 35 Q 35 40, 35 50 L 35 75 Q 35 80, 40 80 L 60 80 Q 65 80, 65 75 L 65 50 Q 65 40, 62 35 Z" 
                              fill="${color}" stroke="${darkColor}" stroke-width="2"/>
                        <ellipse cx="50" cy="55" rx="8" ry="12" fill="${darkColor}" opacity="0.3"/>
                    </svg>
                `;
            }
            
            // Êä§Á¨¶Á±ª
            if (treasureName.includes('Êä§Á¨¶')) {
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <circle cx="50" cy="55" r="25" fill="${color}" stroke="${darkColor}" stroke-width="3"/>
                        <path d="M 50 30 L 55 45 L 70 45 L 58 54 L 62 68 L 50 60 L 38 68 L 42 54 L 30 45 L 45 45 Z" 
                              fill="${darkColor}"/>
                        <path d="M 45 20 Q 45 15, 50 15 Q 55 15, 55 20" fill="none" stroke="${color}" stroke-width="3"/>
                        <circle cx="50" cy="15" r="4" fill="${color}"/>
                    </svg>
                `;
            }
            
            // ËìùÂÆùÁü≥Á±ª
            if (treasureName.includes('ÂÆùÁü≥')) {
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <polygon points="50,20 70,40 60,75 40,75 30,40" fill="#4A90E2" stroke="#2E5C8A" stroke-width="3"/>
                        <polygon points="50,20 70,40 50,50" fill="#5BA3F5" opacity="0.7"/>
                        <polygon points="50,20 30,40 50,50" fill="#357ABD" opacity="0.7"/>
                        <path d="M 30 40 L 50 50 L 40 75" fill="#2E5C8A" opacity="0.5"/>
                        <path d="M 70 40 L 50 50 L 60 75" fill="#5BA3F5" opacity="0.5"/>
                    </svg>
                `;
            }
            
            // Ê≤ôÊºèÁ±ª
            if (treasureName.includes('Ê≤ôÊºè')) {
                const isReversed = treasureName.includes('ÂÄíÊµÅ');
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <rect x="30" y="15" width="40" height="8" fill="${darkColor}" rx="2"/>
                        <rect x="30" y="77" width="40" height="8" fill="${darkColor}" rx="2"/>
                        <path d="M 35 23 L 50 50 L 35 77 M 65 23 L 50 50 L 65 77" 
                              fill="none" stroke="${color}" stroke-width="3"/>
                        ${isReversed ? 
                            `<path d="M 35 25 L 50 45 L 65 25 Z" fill="${color}"/>` :
                            `<path d="M 35 75 L 50 55 L 65 75 Z" fill="${color}"/>`
                        }
                        <circle cx="50" cy="50" r="3" fill="${darkColor}"/>
                    </svg>
                `;
            }
            
            // Ê∞¥Êô∂Á±ª
            if (treasureName.includes('Ê∞¥Êô∂')) {
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <polygon points="50,20 65,40 60,70 40,70 35,40" fill="${color}" stroke="${darkColor}" stroke-width="2"/>
                        <line x1="50" y1="20" x2="50" y2="70" stroke="${darkColor}" stroke-width="2"/>
                        <line x1="35" y1="40" x2="65" y2="40" stroke="${darkColor}" stroke-width="2"/>
                        <line x1="40" y1="70" x2="65" y2="40" stroke="${darkColor}" stroke-width="1" opacity="0.5"/>
                        <line x1="60" y1="70" x2="35" y2="40" stroke="${darkColor}" stroke-width="1" opacity="0.5"/>
                        <circle cx="45" cy="35" r="3" fill="white" opacity="0.6"/>
                    </svg>
                `;
            }
            
            // ÈìÅÊàíÁ±ª
            if (treasureName.includes('ÈìÅÊàí')) {
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="28" fill="none" stroke="${darkColor}" stroke-width="8"/>
                        <circle cx="50" cy="50" r="20" fill="none" stroke="${color}" stroke-width="3"/>
                        <rect x="45" y="15" width="10" height="15" fill="${darkColor}" rx="2"/>
                        <circle cx="50" cy="22" r="6" fill="${color}"/>
                    </svg>
                `;
            }
            
            // ÁÆ±Â≠êÁ±ª
            if (treasureName.includes('ÁÆ±')) {
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <rect x="25" y="40" width="50" height="35" fill="${color}" stroke="${darkColor}" stroke-width="3"/>
                        <path d="M 25 40 L 35 30 L 85 30 L 75 40 Z" fill="${darkColor}"/>
                        <rect x="25" y="40" width="50" height="8" fill="${darkColor}"/>
                        <rect x="47" y="52" width="6" height="15" fill="${darkColor}" rx="1"/>
                        <circle cx="50" cy="62" r="3" fill="${color}"/>
                        <line x1="30" y1="48" x2="70" y2="48" stroke="${color}" stroke-width="2"/>
                    </svg>
                `;
            }
            
            // ÁéãÂÜ†Á±ª
            if (treasureName.includes('ÁéãÂÜ†') || treasureName.includes('ÁéãÂç∞')) {
                const isBroken = treasureName.includes('Á†¥Á¢é') || treasureName.includes('Âéã‰Ωé');
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        ${isBroken ? 
                            '<path d="M 25 55 L 30 40 L 50 50 L 70 40 L 75 55 L 65 60 M 55 58 L 45 62 M 40 60 L 30 58" fill="' + color + '" stroke="' + darkColor + '" stroke-width="3"/>' :
                            '<path d="M 25 55 L 30 40 L 50 50 L 70 40 L 75 55 L 65 65 L 35 65 Z" fill="' + color + '" stroke="' + darkColor + '" stroke-width="3"/>'
                        }
                        <circle cx="30" cy="40" r="5" fill="${color}" stroke="${darkColor}" stroke-width="2"/>
                        <circle cx="50" cy="50" r="5" fill="${color}" stroke="${darkColor}" stroke-width="2"/>
                        <circle cx="70" cy="40" r="5" fill="${color}" stroke="${darkColor}" stroke-width="2"/>
                        ${isBroken ? '<path d="M 40 45 L 60 65" stroke="#A64B3A" stroke-width="3"/>' : ''}
                    </svg>
                `;
            }
            
            // Áü≠ÂâëÁ±ª
            if (treasureName.includes('Áü≠Ââë')) {
                return `
                    <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                        <rect x="46" y="20" width="8" height="50" fill="${color}" stroke="${darkColor}" stroke-width="2"/>
                        <polygon points="50,15 45,20 55,20" fill="${darkColor}"/>
                        <rect x="40" y="68" width="20" height="8" fill="${darkColor}"/>
                        <rect x="45" y="76" width="10" height="6" fill="${color}"/>
                        <path d="M 35 40 Q 30 35, 35 30" fill="none" stroke="#E74C3C" stroke-width="2"/>
                        <path d="M 40 45 Q 35 40, 40 35" fill="none" stroke="#E74C3C" stroke-width="2"/>
                        <path d="M 65 40 Q 70 35, 65 30" fill="none" stroke="#E74C3C" stroke-width="2"/>
                    </svg>
                `;
            }
            
            // ÈªòËÆ§ÂÆùÁü≥ÂõæÊ°à
            return `
                <svg class="treasure-svg-icon" viewBox="0 0 100 100">
                    <polygon points="50,20 70,40 60,75 40,75 30,40" fill="${color}" stroke="${darkColor}" stroke-width="3"/>
                    <polygon points="50,20 70,40 50,50" fill="${darkColor}" opacity="0.3"/>
                    <polygon points="50,20 30,40 50,50" fill="${darkColor}" opacity="0.5"/>
                </svg>
            `;
        }

        // Ëé∑ÂèñÈ≠îÊ≥ïÈòµÁ±ªÂêç
        function getCircleClassName(type) {
            const names = {
                1: 'circle-classic',
                2: 'circle-rune',
                3: 'circle-spiral',
                6: 'circle-ancient'
            };
            return names[type];
        }

        // Ëé∑ÂèñÈ≠îÊ≥ïÈòµHTML
        function getCircleHTML(type) {
            switch(type) {
                case 1: // ÁªèÂÖ∏ÂÖ≠ËäíÊòü
                    return `
                        <div class="outer-ring"></div>
                        <div class="inner-ring"></div>
                        <div class="dots-container">
                            <div class="dot" style="top: -4px; left: 50%; transform: translateX(-50%);"></div>
                            <div class="dot" style="bottom: -4px; left: 50%; transform: translateX(-50%);"></div>
                            <div class="dot" style="top: 50%; left: -4px; transform: translateY(-50%);"></div>
                            <div class="dot" style="top: 50%; right: -4px; transform: translateY(-50%);"></div>
                            <div class="dot" style="top: 15%; right: 15%;"></div>
                            <div class="dot" style="bottom: 15%; left: 15%;"></div>
                        </div>
                    `;
                case 2: // Á¨¶Êñá‰∏âÁéØ
                    return `
                        <div class="ring ring-1"></div>
                        <div class="ring ring-2"></div>
                        <div class="ring ring-3"></div>
                        <div class="rune-container">
                            <div class="rune-symbol" style="top: -10px; left: 50%; transform: translateX(-50%);">·öõ</div>
                            <div class="rune-symbol" style="bottom: -10px; left: 50%; transform: translateX(-50%);">·öú</div>
                            <div class="rune-symbol" style="top: 50%; left: -10px; transform: translateY(-50%);">·öë</div>
                            <div class="rune-symbol" style="top: 50%; right: -10px; transform: translateY(-50%);">·öê</div>
                        </div>
                    `;
                case 3: // Èò¥Èò≥Ëû∫Êóã
                    return `
                        <div class="spiral-ring"></div>
                        <div class="spiral-ring spiral-ring-2"></div>
                    `;
                case 6: // Âè§ÊñáÂ∞ÅÂç∞
                    return `
                        <div class="ancient-ring"></div>
                        <div class="inner-ancient"></div>
                        <div class="ancient-container">
                            <div class="ancient-symbol" style="top: -15px; left: 50%; transform: translateX(-50%);">Âçç</div>
                            <div class="ancient-symbol" style="bottom: -15px; left: 50%; transform: translateX(-50%);">Âçê</div>
                            <div class="ancient-symbol" style="top: 50%; left: -15px; transform: translateY(-50%);">‚ò∞</div>
                            <div class="ancient-symbol" style="top: 50%; right: -15px; transform: translateY(-50%);">‚ò∑</div>
                        </div>
                    `;
            }
        }

        // ÂàõÂª∫Á≤íÂ≠êÊïàÊûú
        function createParticles(containerId) {
            const container = document.getElementById(`${containerId}-particles`);
            if (!container) return;
            
            container.innerHTML = ''; // Ê∏ÖÁ©∫Â∑≤ÊúâÁ≤íÂ≠ê
            
            const particleCount = 12;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const angle = (i / particleCount) * Math.PI * 2;
                const distance = 60 + Math.random() * 20;
                
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                particle.style.setProperty('--tx', `${tx}px`);
                particle.style.setProperty('--ty', `${ty}px`);
                
                const delay = Math.random() * 2;
                const duration = 2 + Math.random() * 1;
                
                particle.style.animation = `particle-burst ${duration}s ease-out ${delay}s infinite`;
                
                container.appendChild(particle);
            }
        }

        // ÂàõÂª∫ÁÅ´Ëä±ÂõõÂ∞ÑÊïàÊûú
        function createSparks(event) {
            const button = event.currentTarget;
            const rect = button.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            const sparkCount = 20;
            for (let i = 0; i < sparkCount; i++) {
                const spark = document.createElement('div');
                spark.className = 'spark';
                
                const angle = Math.random() * Math.PI * 2;
                const distance = 40 + Math.random() * 60;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                spark.style.left = x + 'px';
                spark.style.top = y + 'px';
                spark.style.setProperty('--tx', tx + 'px');
                spark.style.setProperty('--ty', ty + 'px');
                spark.style.setProperty('--rotation', Math.random() * 360 + 'deg');
                spark.style.animation = `spark-fly ${0.4 + Math.random() * 0.2}s ease-out`;
                
                button.appendChild(spark);
                
                setTimeout(() => spark.remove(), 600);
            }
        }

        // ÂÖ®Â±ÄÁä∂ÊÄÅ
        let selectedEmotion = '';
        let selectedNX = 0;
        let selectedNY = 0;
        let selectedEmotionColor = '#C9A961';
        let treasures = [];
        let currentTreasure = null;

        // ÂàùÂßãÂåñ
        function init() {
            loadTreasures();
            renderEmotions();
            updateTreasureBox();
            updateProfileCount();
            
            document.getElementById('contentInput').addEventListener('input', updateGenerateButton);
            
            // AIÊúçÂä°Áä∂ÊÄÅÊõ¥Êñ∞Â∑≤ÁßªÈô§ - ÂºÄÂèëËÄÖÊ®°Âºè
            
            // Ëá™Âä®ÂàùÂßãÂåñ
            AudioSystem.init();
            // ‰ΩøÁî®Áü≠Âª∂ËøüÁ°Æ‰øùÈ°µÈù¢Âä†ËΩΩÂÆåÊàê
            setTimeout(() => {
                AudioSystem.playBGMusic();
            }, 100);
        }

        // ÂàùÂßãÂåñXYÊÉÖÁª™ÂùêÊ†áÁõò
        function renderEmotions() {
            const pad     = document.getElementById('xyPad');
            const dot     = document.getElementById('xyDot');
            const glow    = document.getElementById('xyGlow');
            const crossH  = document.getElementById('xyCrossH');
            const crossV  = document.getElementById('xyCrossV');
            const bubble  = document.getElementById('xyBubble');
            const valX    = document.getElementById('xyValX');
            const valY    = document.getElementById('xyValY');
            const hint    = document.getElementById('xyHint');
            if (!pad) return;

            // ÂõõË±°ÈôêÈ¢úËâ≤ÊèíÂÄº [r,g,b]
            const C_RT = [201,169, 97]; // Âè≥‰∏ä ÈáëÈªÑ
            const C_RB = [ 91,140,138]; // Âè≥‰∏ã ÈùíÁªø
            const C_LT = [166, 75, 58]; // Â∑¶‰∏ä Á∫¢Ê£ï
            const C_LB = [123,155,168]; // Â∑¶‰∏ã ÁÅ∞Ëìù

            function lerpColor(px, py) {
                const wRT = px*(1-py), wRB = px*py, wLT = (1-px)*(1-py), wLB = (1-px)*py;
                return [
                    Math.round(C_RT[0]*wRT + C_RB[0]*wRB + C_LT[0]*wLT + C_LB[0]*wLB),
                    Math.round(C_RT[1]*wRT + C_RB[1]*wRB + C_LT[1]*wLT + C_LB[1]*wLB),
                    Math.round(C_RT[2]*wRT + C_RB[2]*wRB + C_LT[2]*wLT + C_LB[2]*wLB),
                ];
            }

            function getEmotionFromXY(nx, ny) {
                if (nx >  0.55 && ny >  0.55) return 'ÂÖ¥Â•ã';
                if (nx >  0.2  && ny >  0.2 ) return 'ÂñúÊÇ¶';
                if (nx >  0.55 && ny < -0.55) return 'ÂÆâÂÆÅ';
                if (nx >  0.2  && ny < -0.2 ) return 'Êª°Ë∂≥';
                if (nx < -0.55 && ny >  0.55) return 'ÊÑ§ÊÄí';
                if (nx < -0.2  && ny >  0.2 ) return 'ÁÑ¶Ëôë';
                if (nx < -0.55 && ny < -0.55) return 'Áñ≤ÊÉ´';
                if (nx < -0.2  && ny < -0.2 ) return 'ÊÇ≤‰º§';
                if (Math.abs(nx) < 0.18 && ny >  0.4) return 'ÊúüÂæÖ';
                if (Math.abs(nx) < 0.18 && ny < -0.4) return 'Âπ≥Èùô';
                if (nx >  0.18 && Math.abs(ny) < 0.2) return 'ËàíÈÄÇ';
                if (nx < -0.18 && Math.abs(ny) < 0.2) return 'ÁÉ¶Ë∫Å';
                return 'ÂæÆÂ¶ô';
            }

            function toLabel(n) {
                if (n >  0.6) return 'Âº∫';
                if (n >  0.2) return '‰∏≠';
                if (n > -0.2) return 'Âº±';
                if (n > -0.6) return 'ÂÅè‰Ωé';
                return '‰Ωé';
            }

            function handleXY(e) {
                e.preventDefault();
                const rect = pad.getBoundingClientRect();
                const src  = e.touches ? e.touches[0] : e;
                const px   = Math.max(0.02, Math.min(0.98, (src.clientX - rect.left)  / rect.width));
                const py   = Math.max(0.02, Math.min(0.98, (src.clientY - rect.top)   / rect.height));
                const pctX = (px*100).toFixed(1)+'%';
                const pctY = (py*100).toFixed(1)+'%';

                const [r,g,b] = lerpColor(px, py);
                const col      = `rgb(${r},${g},${b})`;
                const colLine  = `rgba(${r},${g},${b},0.3)`;
                const colGlow  = `rgba(${r},${g},${b},0.15)`;

                crossH.style.top = pctY; crossH.style.background = colLine; crossH.style.opacity = '1';
                crossV.style.left = pctX; crossV.style.background = colLine; crossV.style.opacity = '1';
                glow.style.left = pctX; glow.style.top = pctY;
                glow.style.background = `radial-gradient(circle, ${colGlow} 0%, transparent 70%)`;
                glow.style.opacity = '1';
                dot.style.left = pctX; dot.style.top = pctY;
                dot.style.backgroundColor = col; dot.style.opacity = '1';

                const nx = px*2-1;
                const ny = -(py*2-1);
                const emotion = getEmotionFromXY(nx, ny);

                // Ê∞îÊ≥°Ëá™ÈÄÇÂ∫î‰ΩçÁΩÆ
                const bw = emotion.length*7 + 20;
                const padW = pad.offsetWidth;
                const padH = pad.offsetHeight;
                const absPx = px * padW;
                const absPy = py * padH;
                let bLeft = absPx;
                if (absPx - bw/2 < 6)        bLeft = bw/2 + 6;
                if (absPx + bw/2 > padW - 6)  bLeft = padW - bw/2 - 6;
                const showAbove = absPy > 36;
                bubble.style.left      = bLeft + 'px';
                bubble.style.top       = pctY;
                bubble.style.transform = showAbove ? 'translate(-50%, calc(-100% - 10px))' : 'translate(-50%, 10px)';
                bubble.dataset.dir     = showAbove ? '' : 'down';
                bubble.style.backgroundColor = col;
                bubble.style.setProperty('--tip', col);
                bubble.style.opacity   = '1';
                bubble.textContent     = emotion;

                valX.textContent = toLabel(nx); valX.style.color = col;
                valY.textContent = toLabel(ny); valY.style.color = col;
                hint.textContent = emotion; hint.style.color = col;

                // Êõ¥Êñ∞selectedEmotionÂπ∂ÊøÄÊ¥ªÁîüÊàêÊåâÈíÆ
                AudioSystem.playButtonClick();
                selectedEmotion = emotion;
                selectedEmotionColor = col;
                selectedNX = nx;
                selectedNY = ny;
                updateGenerateButton();
            }

            pad.addEventListener('mousedown',  handleXY);
            pad.addEventListener('mousemove',  e => { if (e.buttons===1) handleXY(e); });
            pad.addEventListener('touchstart', handleXY, { passive: false });
            pad.addEventListener('touchmove',  handleXY, { passive: false });
        }

        // selectEmotion‰øùÁïô‰æõÂÖºÂÆπË∞ÉÁî®ÔºàÂÆùËóèÂç°resetÊó∂Áî®Ôºâ
        function selectEmotion(emotion) {
            selectedEmotion = emotion;
            updateGenerateButton();
        }

        // Êõ¥Êñ∞ÁîüÊàêÊåâÈíÆ
        function updateGenerateButton() {
            const content = document.getElementById('contentInput').value.trim();
            const btn = document.getElementById('generateBtn');
            btn.disabled = !selectedEmotion || !content;
        }

        // ÁîüÊàêÂÆùËóè
        async function generateTreasure() {
            AudioSystem.playGenerateTreasure(); // Êí≠ÊîæÁîüÊàêÈü≥Êïà
            
            const btn = document.getElementById('generateBtn');
            const content = document.getElementById('contentInput').value.trim();
            
            if (!selectedEmotion || !content) return;

            btn.classList.add('loading');
            btn.disabled = true;
            
            // Ê†πÊçÆÊ®°ÂºèÊòæÁ§∫‰∏çÂêåÁöÑÂä†ËΩΩÊñáÂ≠ó
            const mode = aiService.getCurrentMode();
            const loadingText = mode === 'ai' ? 'AIÂàõ‰Ωú‰∏≠...' : 'ÁîüÊàê‰∏≠...';
            btn.textContent = loadingText;

            try {
                // ‰ΩøÁî®AIÊúçÂä°ÁîüÊàêÂÆùËóè
                const aiResult = await aiService.generateTreasure(selectedEmotion, content, selectedNX, selectedNY);
                
                // Ê†πÊçÆÂÆùËóèÂêçÁß∞Êé®Êñ≠ÂõæÊ†áÁ±ªÂûãÔºåÂåπÈÖç‰∏çÂà∞ÂàôÈªòËÆ§Ê∞¥Êô∂Ôºà12Ôºâ
                const randomIconType = getIconTypeFromName(aiResult.treasure_name);
                
                const treasure = {
                    id: Date.now(),
                    name: aiResult.treasure_name,
                    content: content,
                    emotion: selectedEmotion,
                    emotionColor: selectedEmotionColor,
                    comment: aiResult.crow_comment,
                    timestamp: Date.now(), // ÂéüÂßãÊó∂Èó¥Êà≥ÔºåÁî®‰∫éËÆ°ÁÆóËÆ∞ÂΩïÂ§©Êï∞
                    time: new Date().toLocaleString('zh-CN', { 
                        month: '2-digit', 
                        day: '2-digit', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    }),
                    source: aiResult.source, // 'ai' Êàñ 'local'
                    iconType: randomIconType // ‰øùÂ≠òÂõæÊ†áÁ±ªÂûã
                };

                btn.classList.remove('loading');
                btn.textContent = 'ÁîüÊàêÂÆùËóè';
                btn.disabled = true;

                // ÊòæÁ§∫Êù•Ê∫êÊèêÁ§∫Ôºà‰ªÖÂú®ÊéßÂà∂Âè∞Ôºâ
                if (aiResult.source === 'ai') {
                    console.log('‚ú® AIÁîüÊàêÁöÑÂÆùËóè:', treasure.name);
                } else {
                    console.log('üìö Êú¨Âú∞Â∫ìÁîüÊàêÁöÑÂÆùËóè:', treasure.name);
                }

                showTreasurePreview(treasure);
                
            } catch (error) {
                console.error('ÁîüÊàêÂÆùËóèÂ§±Ë¥•:', error);
                showToast('ÁîüÊàêÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
                btn.classList.remove('loading');
                btn.textContent = 'ÁîüÊàêÂÆùËóè';
                btn.disabled = false;
            }
        }

        // ÊòæÁ§∫ÂÆùËóèÈ¢ÑËßà
        function showTreasurePreview(treasure) {
            // Â¶ÇÊûúÂÆùËóèÂ∑≤ÊúâÂõ∫ÂÆöÁöÑÈ≠îÊ≥ïÈòµÁ±ªÂûãÂàô‰ΩøÁî®ÔºåÂê¶ÂàôÈöèÊú∫Âπ∂‰øùÂ≠ò
            const circleTypes = [1, 2, 3, 6];
            if (!treasure.circleType) {
                treasure.circleType = circleTypes[Math.floor(Math.random() * circleTypes.length)];
            }
            const circleType = treasure.circleType;
            
            // Á°Æ‰øùÊúâiconType - Â¶ÇÊûúÊ≤°ÊúâÂàô‰ªéÂêçÁß∞Êé®Êñ≠
            const iconType = treasure.iconType || getIconTypeFromName(treasure.name);
            const treasureSVG = getTreasureSVGByType(iconType);
            
            const modal = document.getElementById('treasurePreviewModal');
            modal.innerHTML = `
                <div class="preview-treasure-icon">
                    <div class="magic-circle-container ${getCircleClassName(circleType)}" data-circle-type="${circleType}" data-icon-type="${iconType}">
                        ${getCircleHTML(circleType)}
                        <div class="particles-container" id="preview-particles"></div>
                        ${treasureSVG}
                    </div>
                </div>
                <div class="preview-treasure-name">${treasure.name}</div>
                <div class="preview-treasure-content">${treasure.content}</div>
                <div class="preview-treasure-meta">
                    <span class="preview-emotion-tag" style="background:${treasure.emotionColor || '#C9A961'};">
                        ${treasure.emotion}
                    </span>
                    <span class="preview-treasure-time">${treasure.time}</span>
                </div>
                <div class="preview-crow-comment">"${treasure.comment}"</div>
                <div class="preview-actions">
                    <button class="preview-btn save" onclick="saveTreasureToBox()">ÊâîËøõÂÆùÁÆ±</button>
                </div>
                <div class="treasure-card-actions">
                    <button class="icon-btn share-icon" onclick="openSharePanel()" title="ÂàÜ‰∫´">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="18" cy="5" r="3"/>
                            <circle cx="6" cy="12" r="3"/>
                            <circle cx="18" cy="19" r="3"/>
                            <line x1="8.5" y1="13.5" x2="15.5" y2="17.5"/>
                            <line x1="8.5" y1="10.5" x2="15.5" y2="6.5"/>
                        </svg>
                    </button>
                    <button class="icon-btn download-icon" onclick="downloadTreasureCard()" title="‰øùÂ≠òÂõæÁâá">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                    </button>
                    <button class="icon-btn cancel-icon" onclick="cancelTreasure()" title="ÂèñÊ∂àÊäïÈÄí">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                    </button>
                </div>
            `;
            
            window.pendingTreasure = treasure;
            
            // ÂàõÂª∫Á≤íÂ≠êÊïàÊûú
            setTimeout(() => createParticles('preview'), 0);
            
            // ‰∏∫ÊâîËøõÂÆùÁÆ±ÊåâÈíÆÊ∑ªÂä†ÁÅ´Ëä±ÊïàÊûú
            setTimeout(() => {
                const saveBtn = modal.querySelector('.preview-btn.save');
                if (saveBtn) {
                    saveBtn.addEventListener('click', createSparks);
                }
            }, 0);
            
            const overlay = document.getElementById('overlay');
            overlay.classList.add('active');
            modal.classList.add('active');
        }

        // ‰øùÂ≠òÂÆùËóè
        function saveTreasureToBox() {
            if (!window.pendingTreasure) return;
            
            AudioSystem.playChestOpen(); // Êí≠ÊîæÂÆùÁÆ±ÊâìÂºÄÈü≥ÊïàÔºàÊâîËøõÂÆùÁÆ±Ôºâ
            
            treasures.unshift(window.pendingTreasure);
            saveTreasures();
            
            closeTreasurePreview();
            showToast('ÂÆùËóèÂ∑≤‰øùÂ≠ò');
            
            document.getElementById('contentInput').value = '';
            selectedEmotion = ''; selectedNX = 0; selectedNY = 0; selectedEmotionColor = '#C9A961';
            ['xyDot','xyGlow','xyCrossH','xyCrossV','xyBubble'].forEach(id => {
                const el = document.getElementById(id); if (el) el.style.opacity = '0';
            });
            const xyHint = document.getElementById('xyHint');
            if (xyHint) { xyHint.textContent = 'ÁÇπÂáªÈÄâÊã©‰Ω†Ê≠§ÂàªÁöÑÁä∂ÊÄÅ'; xyHint.style.color = ''; }
            ['xyValX','xyValY'].forEach(id => { const el = document.getElementById(id); if (el) { el.textContent = '‚Äî'; el.style.color = ''; } });
            
            updateTreasureBox();
            updateProfileCount();
            
            window.pendingTreasure = null;
        }

        // ÂèñÊ∂àÊäïÈÄí
        function cancelTreasure() {
            closeTreasurePreview();
            
            document.getElementById('contentInput').value = '';
            selectedEmotion = ''; selectedNX = 0; selectedNY = 0; selectedEmotionColor = '#C9A961';
            ['xyDot','xyGlow','xyCrossH','xyCrossV','xyBubble'].forEach(id => {
                const el = document.getElementById(id); if (el) el.style.opacity = '0';
            });
            const xyHint2 = document.getElementById('xyHint');
            if (xyHint2) { xyHint2.textContent = 'ÁÇπÂáªÈÄâÊã©‰Ω†Ê≠§ÂàªÁöÑÁä∂ÊÄÅ'; xyHint2.style.color = ''; }
            ['xyValX','xyValY'].forEach(id => { const el = document.getElementById(id); if (el) { el.textContent = '‚Äî'; el.style.color = ''; } });
            
            window.pendingTreasure = null;
            showToast('Â∑≤ÂèñÊ∂à');
        }

        // ÂÖ≥Èó≠È¢ÑËßà
        function closeTreasurePreview() {
            const overlay = document.getElementById('overlay');
            const modal = document.getElementById('treasurePreviewModal');
            overlay.classList.remove('active');
            modal.classList.remove('active');
        }

        // Êõ¥Êñ∞ÂÆùÁÆ±
        function updateTreasureBox() {
            const content = document.getElementById('treasureBoxContent');
            
            const illustration = `
                <div class="treasure-illustration">
                    <!-- ‰∏äÂçáÂÖâÁÇπÁ≤íÂ≠ê -->
                    <div class="particles-rising" id="treasureParticles"></div>
                    
                    <!-- ÂÆùÁÆ±SVG -->
                    <svg viewBox="0 0 240 240">
                        <!-- ÂÆùÁÆ±‰∏ª‰ΩìÔºà‰∏çÂä®Ôºâ -->
                        <g id="chest-body">
                            <!-- ÁÆ±‰Ωì -->
                            <rect x="48" y="120" width="144" height="80" rx="3" 
                                  fill="none" stroke="#5D4E37" stroke-width="3"/>
                            
                            <!-- Êú®ÊùøÊù°Á∫πÔºàÂûÇÁõ¥Á∫øÊù°Ôºâ -->
                            <line x1="66" y1="120" x2="66" y2="200" stroke="#8b7355" stroke-width="2"/>
                            <line x1="84" y1="120" x2="84" y2="200" stroke="#8b7355" stroke-width="2"/>
                            <line x1="102" y1="120" x2="102" y2="200" stroke="#8b7355" stroke-width="2"/>
                            <line x1="120" y1="120" x2="120" y2="200" stroke="#8b7355" stroke-width="2"/>
                            <line x1="138" y1="120" x2="138" y2="200" stroke="#8b7355" stroke-width="2"/>
                            <line x1="156" y1="120" x2="156" y2="200" stroke="#8b7355" stroke-width="2"/>
                            <line x1="174" y1="120" x2="174" y2="200" stroke="#8b7355" stroke-width="2"/>
                            
                            <!-- ÈáëÂ±ûÁÆçÔºà‰∏äÔºâ -->
                            <rect x="43" y="128" width="156" height="10" rx="2" 
                                  fill="none" stroke="#C9A961" stroke-width="3"/>
                            <!-- ÈìÜÈíâ -->
                            <circle cx="53" cy="133" r="3" fill="#C9A961"/>
                            <circle cx="75" cy="133" r="3" fill="#C9A961"/>
                            <circle cx="97" cy="133" r="3" fill="#C9A961"/>
                            <circle cx="120" cy="133" r="3" fill="#C9A961"/>
                            <circle cx="143" cy="133" r="3" fill="#C9A961"/>
                            <circle cx="165" cy="133" r="3" fill="#C9A961"/>
                            <circle cx="187" cy="133" r="3" fill="#C9A961"/>
                            
                            <!-- ÈáëÂ±ûÁÆçÔºà‰∏≠Ôºâ -->
                            <rect x="43" y="155" width="156" height="10" rx="2" 
                                  fill="none" stroke="#C9A961" stroke-width="3"/>
                            <!-- ÈìÜÈíâ -->
                            <circle cx="53" cy="160" r="3" fill="#C9A961"/>
                            <circle cx="75" cy="160" r="3" fill="#C9A961"/>
                            <circle cx="97" cy="160" r="3" fill="#C9A961"/>
                            <circle cx="120" cy="160" r="3" fill="#C9A961"/>
                            <circle cx="143" cy="160" r="3" fill="#C9A961"/>
                            <circle cx="165" cy="160" r="3" fill="#C9A961"/>
                            <circle cx="187" cy="160" r="3" fill="#C9A961"/>
                            
                            <!-- ÈáëÂ±ûÁÆçÔºà‰∏ãÔºâ -->
                            <rect x="43" y="182" width="156" height="10" rx="2" 
                                  fill="none" stroke="#C9A961" stroke-width="3"/>
                            <!-- ÈìÜÈíâ -->
                            <circle cx="53" cy="187" r="3" fill="#C9A961"/>
                            <circle cx="75" cy="187" r="3" fill="#C9A961"/>
                            <circle cx="97" cy="187" r="3" fill="#C9A961"/>
                            <circle cx="120" cy="187" r="3" fill="#C9A961"/>
                            <circle cx="143" cy="187" r="3" fill="#C9A961"/>
                            <circle cx="165" cy="187" r="3" fill="#C9A961"/>
                            <circle cx="187" cy="187" r="3" fill="#C9A961"/>
                            
                            <!-- ÈîÅÊâ£ -->
                            <ellipse cx="120" cy="150" rx="12" ry="15" 
                                     fill="none" stroke="#C9A961" stroke-width="3"/>
                            <rect x="118" y="150" width="4" height="18" rx="1" 
                                  fill="none" stroke="#C9A961" stroke-width="2"/>
                            <circle cx="120" cy="155" r="4" fill="#C9A961"/>
                        </g>

                        <!-- ÁõñÂ≠êÔºàÂä®ÁîªÔºâ -->
                        <g class="chest-lid">
                            <!-- ÂúÜÂºßÈ°∂Áõñ -->
                            <path d="M 48 120 Q 48 65 120 60 Q 192 65 192 120" 
                                  fill="none" stroke="#5D4E37" stroke-width="3"/>
                            <!-- ÊµÖÊ£ïËâ≤ÂÜÖÂ±ÇÂºßÁ∫ø -->
                            <path d="M 50 120 L 50 123 Q 50 70 120 65 Q 190 70 190 123 L 190 120" 
                                  fill="none" stroke="#5D4E37" stroke-width="2"/>
                            
                            <!-- ÁõñÂ≠êÂ∫ïÈÉ®Â∞ÅÂè£Á∫ø -->
                            <line x1="48" y1="120" x2="192" y2="120" stroke="#5D4E37" stroke-width="3"/>
                            
                            <!-- È°∂ÁõñÊú®ÊùøÊù°Á∫π -->
                            <path d="M 66 122 Q 66 73 120 68" fill="none" stroke="#8b7355" stroke-width="2"/>
                            <path d="M 84 123 Q 84 71 120 66" fill="none" stroke="#8b7355" stroke-width="2"/>
                            <path d="M 102 124 Q 102 70 120 65" fill="none" stroke="#8b7355" stroke-width="2"/>
                            <path d="M 138 124 Q 138 70 120 65" fill="none" stroke="#8b7355" stroke-width="2"/>
                            <path d="M 156 123 Q 156 71 120 66" fill="none" stroke="#8b7355" stroke-width="2"/>
                            <path d="M 174 122 Q 174 73 120 68" fill="none" stroke="#8b7355" stroke-width="2"/>
                            
                            <!-- ÈáëÂ±ûËæπÊ°ÜÔºàÈ°∂ÁõñÔºâ -->
                            <path d="M 48 120 Q 48 63 120 58 Q 192 63 192 120" 
                                  fill="none" stroke="#C9A961" stroke-width="3"/>
                            
                            <!-- ÂÆùÁü≥Ë£ÖÈ•∞Â∏¶ -->
                            <rect x="54" y="105" width="132" height="12" rx="2" 
                                  fill="none" stroke="#C9A961" stroke-width="2"/>
                            <!-- ÂÆùÁü≥ -->
                            <circle cx="70" cy="111" r="3" fill="none" stroke="#8b7355" stroke-width="1.5"/>
                            <circle cx="87" cy="111" r="3" fill="none" stroke="#8b7355" stroke-width="1.5"/>
                            <circle cx="104" cy="111" r="3" fill="none" stroke="#8b7355" stroke-width="1.5"/>
                            <circle cx="120" cy="111" r="3" fill="none" stroke="#8b7355" stroke-width="1.5"/>
                            <circle cx="136" cy="111" r="3" fill="none" stroke="#8b7355" stroke-width="1.5"/>
                            <circle cx="153" cy="111" r="3" fill="none" stroke="#8b7355" stroke-width="1.5"/>
                            <circle cx="170" cy="111" r="3" fill="none" stroke="#8b7355" stroke-width="1.5"/>
                            
                            <!-- È°∂ÈÉ®ÈáëÂ±ûÁÆç -->
                            <path d="M 48 90 Q 48 63 120 58 Q 192 63 192 90" 
                                  fill="none" stroke="#C9A961" stroke-width="3"/>
                            <!-- ÈìÜÈíâ -->
                            <circle cx="55" cy="90" r="3" fill="#C9A961"/>
                            <circle cx="77" cy="87" r="3" fill="#C9A961"/>
                            <circle cx="99" cy="85" r="3" fill="#C9A961"/>
                            <circle cx="120" cy="84" r="3" fill="#C9A961"/>
                            <circle cx="141" cy="85" r="3" fill="#C9A961"/>
                            <circle cx="163" cy="87" r="3" fill="#C9A961"/>
                            <circle cx="185" cy="90" r="3" fill="#C9A961"/>
                            
                            <!-- È°∂ÈÉ®Ë£ÖÈ•∞ -->
                            <path d="M 115 72 L 120 64 L 125 72" fill="none" stroke="#C9A961" stroke-width="2"/>
                            <circle cx="120" cy="76" r="3" fill="none" stroke="#C9A961" stroke-width="1.5"/>
                        </g>
                    </svg>
                </div>
            `;
            
            if (treasures.length === 0) {
                content.innerHTML = `
                    <div class="treasure-box-frame">
                        ${illustration}
                    </div>
                    <div class="empty-state">ËøôÈáåËøòÂæàÂÆâÈùô„ÄÇ</div>
                    <button class="primary-button" onclick="showPage('record')">ÂºÄÂßãËÆ∞ÂΩï</button>
                    <div class="treasure-count">ÂÆùËóèÊÄªÊï∞Ôºö0</div>
                `;
            } else {
                content.innerHTML = `
                    <div class="treasure-box-frame">
                        ${illustration}
                    </div>
                    <button class="primary-button" id="drawBtn" onclick="drawTreasure()">ÈöèÊú∫ÊäΩÂèñÂÆùËóè</button>
                    <div class="treasure-count">ÂÆùËóèÊÄªÊï∞Ôºö${treasures.length}</div>
                `;
            }
            
            // ÁîüÊàêÁ≤íÂ≠êÊïàÊûú
            setTimeout(() => {
                initTreasureParticles();
            }, 100);
        }

        // ÁîüÊàêÂÆùÁÆ±‰∏äÂçáÂÖâÁÇπÁ≤íÂ≠ê
        function initTreasureParticles() {
            const container = document.getElementById('treasureParticles');
            if (!container) return;
            
            // Ê∏ÖÁ©∫Áé∞ÊúâÁ≤íÂ≠ê
            container.innerHTML = '';
            
            // Â∑¶‰æßÁ≤íÂ≠êÔºàËæÉÂ∞ëÔºâ- ÊÄªÂÖ±15‰∏™
            // ÂúÜÂΩ¢Á≤íÂ≠ê - ÈáëËâ≤ (7‰∏™) - Â∑¶‰æß
            for (let i = 0; i < 7; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-rising particle-circle particle-gold';
                particle.style.left = `${10 + Math.random() * 25}%`; // 10%-35%
                particle.style.bottom = `${25 + Math.random() * 15}%`; // 25%-40%
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${3 + Math.random() * 2}s`;
                container.appendChild(particle);
            }
            
            // ÂúÜÂΩ¢Á≤íÂ≠ê - Ê∑±Ê£ïËâ≤ (4‰∏™) - Â∑¶‰æß
            for (let i = 0; i < 4; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-rising particle-circle particle-brown';
                particle.style.left = `${10 + Math.random() * 25}%`; // 10%-35%
                particle.style.bottom = `${25 + Math.random() * 15}%`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${3.5 + Math.random() * 2}s`;
                container.appendChild(particle);
            }
            
            // ÂõõËßíÊòüÁ≤íÂ≠ê (2‰∏™) - Â∑¶‰æß
            for (let i = 0; i < 2; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-rising particle-star';
                particle.style.left = `${12 + Math.random() * 20}%`; // 12%-32%
                particle.style.bottom = `${28 + Math.random() * 12}%`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${3 + Math.random() * 2.5}s`;
                container.appendChild(particle);
            }
            
            // Á¨¶ÊñáÁ≤íÂ≠ê (2‰∏™) - Â∑¶‰æß
            const runesLeft = ['·ö±', '·öπ'];
            for (let i = 0; i < 2; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-rising particle-rune';
                particle.style.left = `${15 + Math.random() * 18}%`; // 15%-33%
                particle.style.bottom = `${26 + Math.random() * 14}%`;
                particle.textContent = runesLeft[i];
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${4 + Math.random() * 2}s`;
                container.appendChild(particle);
            }
            
            // ÁÆ±ÁõñÂ∫ïÈÉ®‰∏≠Èó¥Á≤íÂ≠ê - ÊÄªÂÖ±10‰∏™ÔºàÊñ∞Â¢ûÔºâ
            // ÂúÜÂΩ¢Á≤íÂ≠ê - ÈáëËâ≤ (4‰∏™) - ‰∏≠Èó¥È°∂ÈÉ®
            for (let i = 0; i < 4; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-rising particle-circle particle-gold';
                particle.style.left = `${43 + Math.random() * 14}%`; // 43%-57%Ôºà‰∏≠Èó¥‰ΩçÁΩÆÔºâ
                particle.style.bottom = `${45 + Math.random() * 10}%`; // 45%-55%ÔºàÁÆ±ÁõñÂ∫ïÈÉ®Ôºâ
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${3 + Math.random() * 2}s`;
                container.appendChild(particle);
            }
            
            // ÂúÜÂΩ¢Á≤íÂ≠ê - Ê∑±Ê£ïËâ≤ (3‰∏™) - ‰∏≠Èó¥È°∂ÈÉ®
            for (let i = 0; i < 3; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-rising particle-circle particle-brown';
                particle.style.left = `${43 + Math.random() * 14}%`;
                particle.style.bottom = `${45 + Math.random() * 10}%`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${3.5 + Math.random() * 2}s`;
                container.appendChild(particle);
            }
            
            // ÂõõËßíÊòüÁ≤íÂ≠ê (2‰∏™) - ‰∏≠Èó¥È°∂ÈÉ®
            for (let i = 0; i < 2; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-rising particle-star';
                particle.style.left = `${45 + Math.random() * 10}%`;
                particle.style.bottom = `${47 + Math.random() * 8}%`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${3 + Math.random() * 2.5}s`;
                container.appendChild(particle);
            }
            
            // Á¨¶ÊñáÁ≤íÂ≠ê (1‰∏™) - ‰∏≠Èó¥È°∂ÈÉ®
            const particle = document.createElement('div');
            particle.className = 'particle-rising particle-rune';
            particle.style.left = `${47 + Math.random() * 6}%`;
            particle.style.bottom = `${48 + Math.random() * 7}%`;
            particle.textContent = '·õè';
            particle.style.animationDelay = `${Math.random() * 5}s`;
            particle.style.animationDuration = `${4 + Math.random() * 2}s`;
            container.appendChild(particle);
            
            // Âè≥‰æßÁ≤íÂ≠êÔºàËæÉÂ§öÔºå‰ªéÁÆ±ÁõñÊï£Âá∫Ôºâ- ÊÄªÂÖ±33‰∏™
            // ÂúÜÂΩ¢Á≤íÂ≠ê - ÈáëËâ≤ (15‰∏™) - Âè≥‰æßÔºåÂØÜÈõÜ
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-rising particle-circle particle-gold';
                // ÈõÜ‰∏≠Âú®Âè≥‰æßÁÆ±Áõñ‰ΩçÁΩÆÔºö65%-90%
                particle.style.left = `${65 + Math.random() * 25}%`;
                // ‰ªéÁÆ±ÁõñÈ´òÂ∫¶ÂºÄÂßãÔºö30%-45%
                particle.style.bottom = `${30 + Math.random() * 15}%`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${3 + Math.random() * 2}s`;
                container.appendChild(particle);
            }
            
            // ÂúÜÂΩ¢Á≤íÂ≠ê - Ê∑±Ê£ïËâ≤ (10‰∏™) - Âè≥‰æß
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-rising particle-circle particle-brown';
                particle.style.left = `${65 + Math.random() * 25}%`;
                particle.style.bottom = `${30 + Math.random() * 15}%`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${3.5 + Math.random() * 2}s`;
                container.appendChild(particle);
            }
            
            // ÂõõËßíÊòüÁ≤íÂ≠ê (8‰∏™) - Âè≥‰æßÔºå‰ªéÁÆ±ÁõñÊï£Âá∫
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-rising particle-star';
                particle.style.left = `${68 + Math.random() * 22}%`;
                particle.style.bottom = `${32 + Math.random() * 13}%`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${3 + Math.random() * 2.5}s`;
                container.appendChild(particle);
            }
            
            // Á¨¶ÊñáÁ≤íÂ≠ê (6‰∏™) - Âè≥‰æß
            const runesRight = ['·õñ', '·öæ', '·õè', '·ö±', '·õñ', '·ö®'];
            for (let i = 0; i < 6; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-rising particle-rune';
                particle.style.left = `${67 + Math.random() * 20}%`;
                particle.style.bottom = `${31 + Math.random() * 14}%`;
                particle.textContent = runesRight[i];
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${4 + Math.random() * 2}s`;
                container.appendChild(particle);
            }
        }

        // ÊäΩÂèñÂÆùËóè
        async function drawTreasure() {
            if (treasures.length === 0) {
                showToast('ÂÆùÁÆ±ÊòØÁ©∫ÁöÑ');
                return;
            }

            // 1. ÁÇπÂáªÊåâÈíÆÈü≥ÊïàÔºàÈªëËΩ¥Ôºâ
            AudioSystem.playButtonClick();
            
            showPage('draw');
            
            // 2. Êí≠ÊîæÂÆùÁÆ±ÊâìÂºÄÈü≥Êïà
            AudioSystem.playChestOpen();
            
            // 3. Á≠âÂæÖ1.5ÁßíÂêéÊòæÁ§∫ÂÆùËóè
            await sleep(1500);
            
            const randomIndex = Math.floor(Math.random() * treasures.length);
            currentTreasure = treasures[randomIndex];
            showTreasureCard(currentTreasure);
        }

        // ‰ªéÂÆùËóèÂêçÁß∞Êé®Êñ≠ÂõæÊ†áÁ±ªÂûã
        function getIconTypeFromName(name) {
            // ‚îÄ‚îÄ Â∑≤ÂÆûÁé∞Âü∫Á°ÄÂõæÊ†á ‚îÄ‚îÄ
            if (name.includes('ÈáëÂ∏Å') || name.includes('Èí±Â∏Å') || name.includes('ÈìúÈí±') || name.includes('Ë¥ßÂ∏Å') || name.includes('Á°¨Â∏Å')) return 1;
            if (name.includes('ÁæΩÊØõ') || name.includes('ÁæΩÁøº') || name.includes('ÁæΩÁøé') || name.includes('È∏üÁæΩ') || name.includes('ÁæΩ')) return 2;
            if (name.includes('ÈÖíÊùØ') || name.includes('Âú£ÊùØ') || name.includes('È´òËÑöÊùØ')) return 3;
            if (name.includes('Á©∫Áì∂') || name.includes('ÊºÇÊµÅÁì∂') || name.includes('ÁéªÁíÉÁì∂') || name.includes('Â∞èÁì∂') || name.includes('Áì∂')) return 4;
            if (name.includes('Ëä±ÁéØ') || name.includes('Ëä±ÂÜ†') || name.includes('Ê°ÇÂÜ†') || name.includes('Ëä±Âúà')) return 5;
            if (name.includes('ÈìÉÈìõ') || name.includes('È£éÈìÉ') || name.includes('Èì∂ÈìÉ') || name.includes('ÈìÉ')) return 6;
            if (name.includes('Âç∑ËΩ¥') || name.includes('ÁæäÁöÆÂç∑') || name.includes('Âè§Âç∑') || name.includes('Â•ëÁ∫¶')) return 7;
            if (name.includes('‰ø°‰ª∂') || name.includes('‰ø°Â∞Å') || name.includes('‰π¶‰ø°') || name.includes('ÂØÜ‰ø°') || name.includes('ÊâãÊú≠') || name.includes('ÊÉÖ‰π¶')) return 8;
            if (name.includes('Êä§Á¨¶') || name.includes('Êä§Ë∫´Á¨¶') || name.includes('Á¨¶Âíí') || name.includes('È≠îÁ¨¶') || name.includes('Â∞ÅÂç∞') || name.includes('Âç∞ËÆ∞') || name.includes('Á¨¶Êñá') || name.includes('ÂõæËÖæ')) return 9;
            if (name.includes('ÂÆùÁü≥') || name.includes('ËìùÂÆùÁü≥') || name.includes('Á∫¢ÂÆùÁü≥') || name.includes('Áø°Áø†') || name.includes('ÈíªÁü≥') || name.includes('Áê•ÁèÄ') || name.includes('ÁèçÂÆù')) return 10;
            if (name.includes('Ê≤ôÊºè') || name.includes('Êó∂ÂÖâ') || name.includes('ÊµÅÊ≤ô') || name.includes('ÂÄíËÆ°Êó∂')) return 11;
            if (name.includes('Ê∞¥Êô∂') || name.includes('Êô∂‰Ωì') || name.includes('ÁÅµÊô∂') || name.includes('Á¢éÊô∂')) return 12;
            if (name.includes('ÈìÅÊàí') || name.includes('ÊàíÊåá') || name.includes('ÊåáÁéØ') || name.includes('È≠îÊàí') || name.includes('Âè§Êàí') || name.includes('Êàí')) return 13;
            if (name.includes('ÂÆùÁÆ±') || name.includes('ËóèÂÆùÁÆ±') || name.includes('Êú®ÁÆ±') || name.includes('È¶ñÈ•∞Áõí') || name.includes('ÁÆ±')) return 14;
            if (name.includes('ÁéãÂÜ†') || name.includes('ÁéãÂç∞') || name.includes('ÁöáÂÜ†') || name.includes('ÂÜ†ÂÜï') || name.includes('ËçÜÊ£òÂÜ†')) return 15;
            if (name.includes('Áü≠Ââë') || name.includes('ÂåïÈ¶ñ') || name.includes('ÈïøÂâë') || name.includes('ÂÆùÂâë') || name.includes('È≠îÂâë') || name.includes('Ââë') || name.includes('ÂàÄ')) return 16;
            // ‚îÄ‚îÄ Ëá™ÁÑ∂ÂÖÉÁ¥† ‚îÄ‚îÄ
            if (name.includes('Â§™Èò≥') || name.includes('Êó•ÂÖâ') || name.includes('Èò≥ÂÖâ') || name.includes('È™ÑÈò≥') || name.includes('Êó≠Êó•') || name.includes('Êô®Êõ¶') || name.includes('ÊöñÈò≥')) return 27;
            if (name.includes('Ëä±Êúµ') || name.includes('È≤úËä±') || name.includes('Áé´Áë∞') || name.includes('Ê®±Ëä±') || name.includes('Ê¢ÖËä±') || name.includes('ÂπΩËä±') || name.includes('ÈáéËä±') || name.includes('Ëä¨Ëä≥') || name.includes('Ëä±')) return 28;
            if (name.includes('ÊòüËæ∞') || name.includes('ÊòüÂÖâ') || name.includes('ÁπÅÊòü') || name.includes('ÊµÅÊòü') || name.includes('ÊòüÂ∞ò') || name.includes('ÊòüËäí') || name.includes('Êòü')) return 29;
            if (name.includes('Êúà‰∫Æ') || name.includes('ÊúàÂÖâ') || name.includes('Êñ∞Êúà') || name.includes('Êª°Êúà') || name.includes('ÁöìÊúà') || name.includes('ÊúàÁâô') || name.includes('Âº¶Êúà') || name.includes('Êúà')) return 30;
            if (name.includes('Ê†ëÂè∂') || name.includes('Âè∂Áâá') || name.includes('ËêΩÂè∂') || name.includes('Èì∂Êùè') || name.includes('Êû´Âè∂') || name.includes('Â´©Âè∂') || name.includes('Âè∂')) return 31;
            if (name.includes('ÁúºÁùõ') || name.includes('Â§©Áúº') || name.includes('Á•ûÁúº') || name.includes('Ê¥ûÂØü') || name.includes('ÂáùËßÜ') || name.includes('Áû≥') || name.includes('ÁõÆ')) return 32;
            if (name.includes('Ëú°ÁÉõ') || name.includes('ÁÉõÂÖâ') || name.includes('ÁÉõÁÅ´') || name.includes('ÁÅ´ÁÑ∞') || name.includes('ÊöóÁÉõ') || name.includes('ÊÆãÁÉõ') || name.includes('ÁÉõ')) return 33;
            if (name.includes('Ë¥ùÂ£≥') || name.includes('Êµ∑Ëû∫') || name.includes('Ëû∫Êóã') || name.includes('ÁèçÁè†') || name.includes('Êµ∑Ê¥ã') || name.includes('ÊΩÆÊ±ê')) return 34;
            if (name.includes('Èí•Âåô') || name.includes('Âè§Èí•') || name.includes('ÈîÅÂåô') || name.includes('ÈáëÈí•') || name.includes('ÂØÜÈí•') || name.includes('ÈîÅ')) return 35;
            if (name.includes('ËòëËèá') || name.includes('ËèåÂ≠ê') || name.includes('Â≠¢Â≠ê')) return 36;
            if (name.includes('È™®Â§¥') || name.includes('ÊûØÈ™®') || name.includes('ÁôΩÈ™®') || name.includes('È™∏È™®') || name.includes('ÈÅóÈ™∏')) return 37;
            if (name.includes('È∏ü') || name.includes('È£ûÈ∏ü') || name.includes('‰πåÈ∏¶') || name.includes('ÁáïÂ≠ê') || name.includes('ÂÄôÈ∏ü') || name.includes('Â≠§È∏ü')) return 38;
            // ‚îÄ‚îÄ Êú∫Ê¢∞Â•áÁâ© ‚îÄ‚îÄ
            if (name.includes('ÈΩøËΩÆ') || name.includes('Êú∫Ê¢∞') || name.includes('ÈíüË°®') || name.includes('‰º†Âä®') || name.includes('Ë£ÖÁΩÆ') || name.includes('ÂºïÊìé')) return 39;
            if (name.includes('ËäØÁâá') || name.includes('ÁîµË∑Ø') || name.includes('Â§ÑÁêÜÂô®') || name.includes('Êú∫ËäØ') || name.includes('Á°¨‰ª∂') || name.includes('ÈõÜÊàê')) return 41;
            if (name.includes('Êú∫Ê¢∞Áúº') || name.includes('‰πâÁúº') || name.includes('ÂçÉÈáåÁúº') || name.includes('ÈÄèÈïú') || name.includes('Âè§Èïú') || name.includes('Èïú')) return 42;
            return 12; // ÈªòËÆ§Ê∞¥Êô∂
        }

        // ÊòæÁ§∫ÂÆùËóèÂç°
        function showTreasureCard(treasure) {
            // ‰ΩøÁî®Â∑≤‰øùÂ≠òÁöÑÈ≠îÊ≥ïÈòµÁ±ªÂûãÔºå‰øùËØÅÊØèÊ¨°ÊäΩÂèñÊòæÁ§∫‰∏ÄËá¥ÔºõÊóßÊï∞ÊçÆÂàôÈöèÊú∫
            const circleTypes = [1, 2, 3, 6];
            const circleType = treasure.circleType || circleTypes[Math.floor(Math.random() * circleTypes.length)];
            
            // Á°Æ‰øùÊúâiconType - Â¶ÇÊûúÊ≤°ÊúâÂàô‰ªéÂêçÁß∞Êé®Êñ≠
            const iconType = treasure.iconType || getIconTypeFromName(treasure.name);
            const treasureSVG = getTreasureSVGByType(iconType);
            
            const modal = document.getElementById('treasureCardModal');
            modal.innerHTML = `
                <button class="modal-close-btn" onclick="closeModal()">√ó</button>
                <div class="treasure-card-icon" onclick="generateStickerFromIcon()" style="cursor: pointer;" title="ÁÇπÂáªÁîüÊàêÁÆÄÁ∫¶ÁâàË¥¥Á∫∏">
                    <div class="magic-circle-container ${getCircleClassName(circleType)}" data-circle-type="${circleType}" data-icon-type="${iconType}">
                        ${getCircleHTML(circleType)}
                        <div class="particles-container" id="card-particles"></div>
                        ${treasureSVG}
                    </div>
                </div>
                <div class="treasure-card-name">${treasure.name}</div>
                <div class="treasure-card-content">${treasure.content}</div>
                <div class="preview-treasure-meta">
                    <span class="preview-emotion-tag" style="background:${treasure.emotionColor || '#C9A961'};">
                        ${treasure.emotion}
                    </span>
                    <span class="preview-treasure-time">${treasure.time}</span>
                </div>
                <div class="preview-crow-comment">"${treasure.comment}"</div>
                <div class="treasure-card-actions">
                    <button class="icon-btn share-icon" onclick="openSharePanel()" title="ÂàÜ‰∫´">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="18" cy="5" r="3"/>
                            <circle cx="6" cy="12" r="3"/>
                            <circle cx="18" cy="19" r="3"/>
                            <line x1="8.5" y1="13.5" x2="15.5" y2="17.5"/>
                            <line x1="8.5" y1="10.5" x2="15.5" y2="6.5"/>
                        </svg>
                    </button>
                    <button class="icon-btn download-icon" onclick="downloadTreasureCard()" title="‰øùÂ≠òÂõæÁâá">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                    </button>
                    <button class="icon-btn delete-icon" onclick="confirmDelete(${treasure.id})" title="Âà†Èô§">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            <line x1="10" y1="11" x2="10" y2="17"/>
                            <line x1="14" y1="11" x2="14" y2="17"/>
                        </svg>
                    </button>
                </div>
            `;
            
            // ÂàõÂª∫Á≤íÂ≠êÊïàÊûú
            setTimeout(() => createParticles('card'), 0);
            
            document.getElementById('overlay').classList.add('active');
            modal.classList.add('active');
        }

        // ÂÖ≥Èó≠ÂºπÁ™ó
        function closeModal() {
            const sharePanel = document.getElementById('sharePanel');
            
            // ÂÖ≥Èó≠ÂõæÁâáÈ¢ÑËßàÔºàÂ¶ÇÊûúÊúâÔºâ
            closeImagePreview();
            
            // Â¶ÇÊûúÂàÜ‰∫´Èù¢ÊùøÊòØÊâìÂºÄÁöÑÔºåÂÖàÂÖ≥Èó≠ÂàÜ‰∫´Èù¢Êùø
            if (sharePanel && sharePanel.classList.contains('active')) {
                closeSharePanel();
                return;
            }
            
            const overlay = document.getElementById('overlay');
            const treasureCardModal = document.getElementById('treasureCardModal');
            const treasurePreviewModal = document.getElementById('treasurePreviewModal');
            
            // Â¶ÇÊûúÊòØ‰ªéÊäΩÂèñÈ°µÈù¢ÂÖ≥Èó≠ÂÆùËóèÂç°ÔºåÁ´ãÂç≥ËøîÂõûÂÆùÁÆ±È°µÈù¢
            const isDrawPage = document.getElementById('drawPage').classList.contains('active');
            if (isDrawPage && treasureCardModal.classList.contains('active')) {
                // Á´ãÂç≥Ë∑≥ËΩ¨Âà∞ÂÆùÁÆ±È°µÈù¢
                showPage('treasureBox');
            }
            
            // ÂÖ≥Èó≠ÂºπÁ™ó
            overlay.classList.remove('active');
            treasureCardModal.classList.remove('active');
            treasurePreviewModal.classList.remove('active');
        }

        // Á°ÆËÆ§Âà†Èô§
        function confirmDelete(id) {
            showConfirm('ÁßªÈô§ÂÆùËóè', 'Á°ÆÂÆöË¶ÅÂ∞ÜËøô‰∏™ÂÆùËóèÁßªÈô§ÂêóÔºü', () => {
                deleteTreasure(id);
            });
        }

        // Âà†Èô§ÂÆùËóè
        function deleteTreasure(id) {
            AudioSystem.playDelete(); // Êí≠ÊîæÂà†Èô§Èü≥Êïà
            
            treasures = treasures.filter(t => t.id !== id);
            saveTreasures();
            
            // ÂÖàÂÖ≥Èó≠ÊâÄÊúâÂºπÁ™ó
            const overlay = document.getElementById('overlay');
            const treasureCardModal = document.getElementById('treasureCardModal');
            const confirmDialog = document.getElementById('confirmDialog');
            
            overlay.classList.remove('active');
            treasureCardModal.classList.remove('active');
            confirmDialog.classList.remove('active');
            
            // Âª∂ËøüÂêéËøîÂõûÂÆùÁÆ±È°µÈù¢Âπ∂ÊòæÁ§∫ÊèêÁ§∫
            setTimeout(() => {
                showPage('treasureBox');
                showToast('Â∑≤ÁßªÈô§');
                updateTreasureBox();
                updateProfileCount();
            }, 200);
        }

        // Á°ÆËÆ§Ê∏ÖÁ©∫
        function confirmClearAll() {
            if (treasures.length === 0) {
                showToast('ÂÆùÁÆ±Â∑≤ÁªèÊòØÁ©∫ÁöÑ‰∫Ü');
                return;
            }
            showConfirm('Ê∏ÖÁ©∫ÂÆùËóè', 'Ê≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ\nËØ∑Ë∞®ÊÖéÊìç‰Ωú„ÄÇ', () => {
                treasures = [];
                saveTreasures();
                showToast('Â∑≤Ê∏ÖÁ©∫');
                updateTreasureBox();
                updateProfileCount();
            }, true);
        }

        // ÂàáÊç¢Èü≥‰πê
        function toggleMusic() {
            AudioSystem.playButtonClick();
            const isMuted = AudioSystem.toggleMute();
            const iconBtn = document.getElementById('musicIconBtn');
            
            if (isMuted) {
                iconBtn.classList.add('muted');
                showToast('Èü≥‰πêÂ∑≤ÂÖ≥Èó≠');
            } else {
                iconBtn.classList.remove('muted');
                showToast('Èü≥‰πêÂ∑≤ÂºÄÂêØ');
            }
        }

        // ÂàáÊç¢‰∫§‰∫íÈü≥Êïà
        let sfxMuted = false;
        function toggleSFX() {
            AudioSystem.playButtonClick();
            sfxMuted = !sfxMuted;
            const iconBtn = document.getElementById('sfxIconBtn');
            
            if (sfxMuted) {
                iconBtn.classList.add('muted');
                AudioSystem.sfxVolume = 0;
                showToast('Èü≥ÊïàÂ∑≤ÂÖ≥Èó≠');
            } else {
                iconBtn.classList.remove('muted');
                const slider = document.getElementById('sfxVolumeSlider');
                AudioSystem.sfxVolume = slider.value / 100;
                showToast('Èü≥ÊïàÂ∑≤ÂºÄÂêØ');
            }
        }

        // Êõ¥Êñ∞Èü≥Èáè
        function updateVolume(value) {
            const volume = value / 100;
            AudioSystem.setVolume(volume);
            document.getElementById('volumeValue').textContent = value + '%';
            
            // Ëá™Âä®ÂèñÊ∂àÈùôÈü≥
            if (value > 0) {
                const iconBtn = document.getElementById('musicIconBtn');
                iconBtn.classList.remove('muted');
            }
        }

        // Êõ¥Êñ∞‰∫§‰∫íÈü≥ÊïàÈü≥Èáè
        function updateSFXVolume(value) {
            if (!sfxMuted) {
                AudioSystem.sfxVolume = value / 100;
            }
            document.getElementById('sfxVolumeValue').textContent = value + '%';
            
            // Ëá™Âä®ÂèñÊ∂àÈùôÈü≥
            if (value > 0) {
                const iconBtn = document.getElementById('sfxIconBtn');
                iconBtn.classList.remove('muted');
                sfxMuted = false;
            }
        }

        // ÊòæÁ§∫ÂÖ≥‰∫é
        function showAbout() {
            showConfirm('ÂÖ≥‰∫é', "‰πåÈ∏¶ÁöÑÂÆùËóè v1.2 (ÂºÄÂèëËÄÖÁâà)\n\n‰∏Ä‰∏™ËÆ∞ÂΩï‰∏éÈáçÊãæÂÜÖÂøÉÂÆùËóèÁöÑÂ∑•ÂÖ∑„ÄÇ\nÂÜÖÁΩÆAIÂ¢ûÂº∫ÂäüËÉΩ„ÄÇ", null, false, 'Áü•ÈÅì‰∫Ü');
        }

        // ==================== API KeyÂØπËØùÊ°ÜÁõ∏ÂÖ≥ÂáΩÊï∞Â∑≤ÁßªÈô§ - ÂºÄÂèëËÄÖÊ®°Âºè ====================

        // Êõ¥Êñ∞ÁªüËÆ°
        function updateProfileCount() {
            // Êõ¥Êñ∞ÂÆùËóèÊÄªÊï∞
            document.getElementById('profileTreasureCount').textContent = treasures.length;
            
            // ËÆ°ÁÆóËÆ∞ÂΩïÂ§©Êï∞
            const recordDays = calculateRecordDays();
            document.getElementById('profileRecordDays').textContent = recordDays;
        }
        
        // ËÆ°ÁÆóËÆ∞ÂΩïÂ§©Êï∞Ôºà‰ªéÁ¨¨‰∏ÄÊ¨°ËÆ∞ÂΩïÂºÄÂßãÂà∞Áé∞Âú®ÁöÑÊÄªÂ§©Êï∞Ôºâ
        function calculateRecordDays() {
            if (treasures.length === 0) return 0;
            
            // ÊâæÂà∞ÊúÄÊó©ÁöÑÂÆùËóèÊó∂Èó¥Êà≥
            let earliestTimestamp = treasures[0].timestamp;
            
            treasures.forEach(treasure => {
                if (treasure.timestamp && treasure.timestamp < earliestTimestamp) {
                    earliestTimestamp = treasure.timestamp;
                }
            });
            
            // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÊúâÊïàÁöÑÊó∂Èó¥Êà≥ÔºåËøîÂõû0
            if (!earliestTimestamp) return 0;
            
            // ËÆ°ÁÆó‰ªéÊúÄÊó©ËÆ∞ÂΩïÊó•ÊúüÂà∞‰ªäÂ§©ÁöÑÂ§©Êï∞Â∑Æ
            const firstDate = new Date(earliestTimestamp);
            const today = new Date();
            
            // Â∞ÜÊó∂Èó¥ËÆæÁΩÆ‰∏∫ÂΩìÂ§©ÁöÑÂºÄÂßãÔºà0Êó∂0ÂàÜ0ÁßíÔºâÔºå‰ª•‰æøÂáÜÁ°ÆËÆ°ÁÆóÂ§©Êï∞Â∑Æ
            firstDate.setHours(0, 0, 0, 0);
            today.setHours(0, 0, 0, 0);
            
            // ËÆ°ÁÆóÂ§©Êï∞Â∑ÆÔºàÊØ´ÁßíÂ∑Æ / ÊØèÂ§©ÁöÑÊØ´ÁßíÊï∞Ôºâ
            const daysDiff = Math.floor((today - firstDate) / (1000 * 60 * 60 * 24));
            
            // ËøîÂõûÂ§©Êï∞+1ÔºàÂõ†‰∏∫Á¨¨‰∏ÄÂ§©‰πüÁÆó‰∏ÄÂ§©Ôºâ
            return daysDiff + 1;
        }

        // È°µÈù¢ÂàáÊç¢
        function showPage(pageName) {
            // ÂÖ≥Èó≠ÂõæÁâáÈ¢ÑËßàÔºàÂ¶ÇÊûúÊúâÔºâ
            closeImagePreview();
            
            // Êí≠ÊîæÁÇπÂáªÈü≥ÊïàÔºàÈô§‰∫ÜdrawÈ°µÈù¢ÔºåÂõ†‰∏∫drawÈ°µÈù¢Âú®drawTreasure‰∏≠Â∑≤ÁªèÊí≠Êîæ‰∫ÜÔºâ
            if (pageName !== 'draw') {
                AudioSystem.playButtonClick();
            }
            
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(tab => tab.classList.remove('active'));
            
            const pageMap = {
                'record': ['recordPage', 0],
                'treasureBox': ['treasureBoxPage', 1],
                'draw': ['drawPage', -1],
                'profile': ['profilePage', 2]
            };
            
            const [pageId, tabIndex] = pageMap[pageName];
            document.getElementById(pageId).classList.add('active');
            
            if (tabIndex >= 0) {
                document.querySelectorAll('.tab-item')[tabIndex].classList.add('active');
            }
        }

        // Á°ÆËÆ§ÂØπËØùÊ°Ü
        function showConfirm(title, message, onConfirm, isDanger = false, confirmText = 'Á°ÆÂÆö') {
            const dialog = document.getElementById('confirmDialog');
            const cancelBtn = onConfirm ? `<button class="confirm-btn cancel" onclick="closeConfirm()">ÂèñÊ∂à</button>` : '';
            const confirmClass = isDanger ? 'danger' : 'confirm';
            
            dialog.innerHTML = `
                <div class="confirm-title">${title}</div>
                <div class="confirm-message">${message}</div>
                <div class="confirm-buttons">
                    ${cancelBtn}
                    <button class="confirm-btn ${confirmClass}" onclick="handleConfirm()">${confirmText}</button>
                </div>
            `;
            
            dialog.classList.add('active');
            document.getElementById('overlay').classList.add('active');
            
            window.currentConfirmAction = onConfirm;
        }

        function handleConfirm() {
            if (window.currentConfirmAction) {
                window.currentConfirmAction();
            }
            closeConfirm();
        }

        function closeConfirm() {
            document.getElementById('confirmDialog').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
            window.currentConfirmAction = null;
        }

        // ToastÊèêÁ§∫
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        // ==================== ÂàÜ‰∫´ÂäüËÉΩ ====================
        
        // ÊâìÂºÄÂàÜ‰∫´Èù¢Êùø
        function openSharePanel() {
            const sharePanel = document.getElementById('sharePanel');
            const shareOverlay = document.getElementById('shareOverlay');
            
            shareOverlay.classList.add('active');
            sharePanel.classList.add('active');
        }
        
        // ÂÖ≥Èó≠ÂàÜ‰∫´Èù¢Êùø
        function closeSharePanel() {
            const sharePanel = document.getElementById('sharePanel');
            const shareOverlay = document.getElementById('shareOverlay');
            
            sharePanel.classList.remove('active');
            shareOverlay.classList.remove('active');
        }
        
        // Êà™ÂõæÂπ∂ÊòæÁ§∫ÂÆùËóèÂç°ÂõæÁâáÔºà‰æõÁî®Êà∑ÈïøÊåâ‰øùÂ≠òÔºâ
        async function downloadTreasureCard() {
            // Áõ¥Êé•ÁîüÊàêÂÆåÊï¥ÁâàÊòé‰ø°Áâá
            try {
                const treasureCard = document.querySelector('.treasure-card-modal.active') || 
                                   document.querySelector('.treasure-preview-modal.active');
                
                if (!treasureCard) {
                    showToast('Êú™ÊâæÂà∞ÂÆùËóèÂç°');
                    return;
                }
                
                // ÊèêÂèñÂÆùËóèÊï∞ÊçÆ
                const treasureData = extractTreasureData(treasureCard);
                
                // ÁîüÊàêÂÆåÊï¥ÁâàÊòé‰ø°Áâá
                await generatePostcardImage(treasureData, 'full');
                
            } catch (error) {
                console.error('ÁîüÊàêÊòé‰ø°ÁâáÂ§±Ë¥•:', error);
                showToast('ÁîüÊàêÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
        }
        
        // ÁÇπÂáªÂÆùËóèÂõæÊ†áÁîüÊàêÁÆÄÁ∫¶ÁâàË¥¥Á∫∏
        async function generateStickerFromIcon() {
            try {
                const treasureCard = document.querySelector('.treasure-card-modal.active') || 
                                   document.querySelector('.treasure-preview-modal.active');
                
                if (!treasureCard) {
                    showToast('Êú™ÊâæÂà∞ÂÆùËóèÂç°');
                    return;
                }
                
                // ÊèêÂèñÂÆùËóèÊï∞ÊçÆ
                const treasureData = extractTreasureData(treasureCard);
                
                // ÁîüÊàêÁÆÄÁ∫¶ÁâàÊòé‰ø°ÁâáÔºàË¥¥Á∫∏Ôºâ
                await generatePostcardImage(treasureData, 'minimal');
                
            } catch (error) {
                console.error('ÁîüÊàêË¥¥Á∫∏Â§±Ë¥•:', error);
                showToast('ÁîüÊàêÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
        }

        
        // ÊèêÂèñÂÆùËóèÊï∞ÊçÆ
        function extractTreasureData(element) {
            // ÊèêÂèñÂÆùËóèÂêçÁß∞
            const nameElem = element.querySelector('.preview-treasure-name, .treasure-card-name');
            const name = nameElem ? nameElem.textContent.trim() : 'Êú™ÂëΩÂêçÂÆùËóè';
            
            // ÊèêÂèñÂÆùËóèÂÜÖÂÆπ
            const contentElem = element.querySelector('.preview-treasure-content, .treasure-card-content');
            const content = contentElem ? contentElem.textContent.trim() : '';
            
            // ÊèêÂèñÊÉÖÁª™
            const emotionElem = element.querySelector('.emotion-tag span:last-child, .preview-emotion-tag');
            const emotion = emotionElem ? emotionElem.textContent.trim() : '';
            
            // ÊèêÂèñÊó∂Èó¥
            const timeElem = element.querySelector('.treasure-card-time, .preview-treasure-time');
            const time = timeElem ? timeElem.textContent.trim() : '';
            
            // ÊèêÂèñ‰πåÈ∏¶ËØÑËÆ∫
            const crowElem = element.querySelector('.preview-crow-comment, .crow-comment');
            const crowComment = crowElem ? crowElem.textContent.trim().replace(/^"|"$/g, '') : '';
            
            // ‰ªémagic-circle-containerÁöÑdata-icon-typeÂ±ûÊÄßÊèêÂèñÂõæÊ†áÁ±ªÂûã
            const circleContainer = element.querySelector('.magic-circle-container');
            let iconType = 12; // ÈªòËÆ§Ê∞¥Êô∂
            
            if (circleContainer && circleContainer.dataset.iconType) {
                iconType = parseInt(circleContainer.dataset.iconType);
                console.log('‚úÖ ‰ªédata-icon-typeËØªÂèñÂà∞iconType:', iconType);
            } else {
                // Â§áÁî®ÊñπÊ°àÔºö‰ªéÂÆùËóèÂêçÁß∞Êé®Êñ≠(Áî®‰∫éÊóßÂÆùËóè)
                iconType = getIconTypeFromName(name);
                console.log('‚ö†Ô∏è Ê≤°ÊúâÊâæÂà∞data-icon-type,‰ªéÂêçÁß∞Êé®Êñ≠ iconType:', iconType);
            }
            
            // ÊèêÂèñÈ≠îÊ≥ïÂúàÁ±ªÂûã
            let circleType = 3; // ÈªòËÆ§Èò¥Èò≥Ëû∫Êóã
            if (circleContainer && circleContainer.dataset.circleType) {
                circleType = parseInt(circleContainer.dataset.circleType);
            } else {
                // Â§áÁî®ÊñπÊ°àÔºöÈÄöËøáclassÂà§Êñ≠
                if (circleContainer) {
                    if (circleContainer.classList.contains('circle-classic')) circleType = 1;
                    else if (circleContainer.classList.contains('circle-rune')) circleType = 2;
                    else if (circleContainer.classList.contains('circle-spiral')) circleType = 3;
                    else if (circleContainer.classList.contains('circle-ancient')) circleType = 6;
                }
            }
            
            console.log('ÊúÄÁªàÊèêÂèñÁöÑÊï∞ÊçÆ:', { name, iconType, circleType });
            
            return {
                name,
                content,
                emotion,
                time,
                crowComment,
                iconType,
                circleType
            };
        }
        
        // ÁîüÊàêÊòé‰ø°ÁâáÂõæÁâá
        async function generatePostcardImage(treasureData, version) {
            return new Promise((resolve, reject) => {
                try {
                    console.log('ÂºÄÂßãÁîüÊàêÊòé‰ø°Áâá...', version, treasureData);
                    
                    const width = 300;
                    let height;
                    
                    if (version === 'full') {
                        // ÂÆåÊï¥ÁâàÔºöÂÖàËÆ°ÁÆóÊâÄÈúÄÈ´òÂ∫¶
                        height = calculateFullPostcardHeight(treasureData, width);
                    } else {
                        // ÁÆÄÁ∫¶ÁâàÔºöÂõ∫ÂÆöÈ´òÂ∫¶
                        height = 280;
                    }
                    
                    // ÂàõÂª∫Canvas
                    const canvas = document.createElement('canvas');
                    const scale = 2; // È´òÊ∏Ö
                    canvas.width = width * scale;
                    canvas.height = height * scale;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.scale(scale, scale);
                    
                    // ÁªòÂà∂ËÉåÊôØ
                    ctx.fillStyle = '#E8E4D9';
                    ctx.fillRect(0, 0, width, height);
                    
                    // Ê†πÊçÆÁâàÊú¨ÁªòÂà∂
                    if (version === 'full') {
                        drawFullPostcard(ctx, width, height, treasureData);
                    } else {
                        drawMinimalPostcard(ctx, width, height, treasureData);
                    }
                    
                    // ËΩ¨Êç¢‰∏∫PNGÂπ∂ÊòæÁ§∫
                    canvas.toBlob(imageBlob => {
                        if (imageBlob) {
                            console.log('Êòé‰ø°ÁâáÁîüÊàêÊàêÂäü');
                            const imageUrl = URL.createObjectURL(imageBlob);
                            showImagePreview(imageUrl);
                            resolve();
                        } else {
                            reject(new Error('PNGÁîüÊàêÂ§±Ë¥•'));
                        }
                    }, 'image/png');
                    
                } catch (error) {
                    console.error('ÁîüÊàêÊòé‰ø°ÁâáÂá∫Èîô:', error);
                    reject(error);
                }
            });
        }
        
        // ËÆ°ÁÆóÂÆåÊï¥ÁâàÊòé‰ø°ÁâáÊâÄÈúÄÈ´òÂ∫¶
        function calculateFullPostcardHeight(data, width) {
            // ÂàõÂª∫‰∏¥Êó∂canvasÁî®‰∫éÊµãÈáè
            const tempCanvas = document.createElement('canvas');
            const ctx = tempCanvas.getContext('2d');
            
            let y = 40; // È°∂ÈÉ®ËæπË∑ù
            
            // 1. ÂõæÊ°à+È≠îÊ≥ïÁéØ (70px + 40pxÈó¥Ë∑ù)
            const circleSize = 70;
            y += circleSize + 40; // Êõ¥Êñ∞‰∏∫40pxÈó¥Ë∑ù
            
            // 2. ÂÆùËóèÂêçÁß∞
            y += 35;
            
            // 3. ÂàÜÂâ≤Á∫ø
            y += 25;
            
            // 4. ÂÆùËóèÂÜÖÂÆπ
            if (data.content) {
                ctx.font = '15px "Noto Serif SC", serif';
                const lines = wrapText(ctx, data.content, width - 60);
                y += lines.length * 27 + 10;
                y += 25; // ÂàÜÂâ≤Á∫ø
            }
            
            // 5. ÊÉÖÁª™ÂíåÊó∂Èó¥
            if (data.emotion || data.time) {
                y += 30;
                y += 25; // ÂàÜÂâ≤Á∫ø
            }
            
            // 6. ‰πåÈ∏¶ËØÑËÆ∫
            if (data.crowComment) {
                ctx.font = 'italic 13px "Noto Serif SC", serif';
                const commentLines = wrapText(ctx, data.crowComment, width - 60);
                y += commentLines.length * 22;
                y += 36; // Â∫ïÈÉ®Âõ∫ÂÆö36pxËæπË∑ù
            } else {
                y += 36; // Â¶ÇÊûúÊ≤°ÊúâËØÑËÆ∫,‰πü‰øùÊåÅÂ∫ïÈÉ®ËæπË∑ù
            }
            
            return Math.max(y, 280); // ÊúÄÂ∞èÈ´òÂ∫¶280px
        }
        
        // ÁªòÂà∂ÂÆåÊï¥ÁâàÊòé‰ø°Áâá
        function drawFullPostcard(ctx, width, height, data) {
            const centerX = width / 2;
            let y = 40;
            
            // 1. ÁªòÂà∂È≠îÊ≥ïÂúàÂíåÂÆùËóèÂõæÊ†áÔºàËøõ‰∏ÄÊ≠•Áº©Â∞èÂ∞∫ÂØ∏Ôºå‰∏éËøêÂä®ÁéØ‰øùÊåÅ‰∏ÄËá¥Ôºâ
            const circleSize = 70; // ‰ªé100Áº©Â∞èÂà∞70ÔºåÂåπÈÖçËøêÂä®ÁéØÊØî‰æã
            const iconSize = 40;    // ‰ªé50Áº©Â∞èÂà∞40
            drawMagicCircle(ctx, centerX, y + circleSize/2, circleSize, data.circleType);
            drawTreasureIcon(ctx, centerX, y + circleSize/2, iconSize, data.iconType);
            y += circleSize + 40; // ÂõæÊ°àÁªÑÂêàÂêé+40pxÂõ∫ÂÆöÈó¥Ë∑ùÔºà24pxÂ¢ûÂä†Âà∞40pxÔºåÂÜçËøúÁ¶ª16pxÔºâ
            
            // 2. ÁªòÂà∂ÂÆùËóèÂêçÁß∞Ôºà‰ΩøÁî®‰∏éÂÆùËóèÂç°‰∏ÄËá¥ÁöÑÂ≠ó‰ΩìÊ†∑ÂºèÔºâ
            ctx.fillStyle = '#3D2F2F';
            ctx.font = '700 22px "Noto Serif SC", serif'; // Ê∑ªÂä†font-weight 700
            ctx.textAlign = 'center';
            ctx.letterSpacing = '2px'; // Ê∑ªÂä†Â≠óÈó¥Ë∑ù
            ctx.fillText(data.name, centerX, y);
            ctx.letterSpacing = '0px'; // ÈáçÁΩÆÂ≠óÈó¥Ë∑ù
            y += 35;
            
            // 3. ÂàÜÂâ≤Á∫ø
            drawDivider(ctx, width, y);
            y += 25;
            
            // 4. ÁªòÂà∂ÂÆùËóèÂÜÖÂÆπÔºà‰ΩøÁî®‰∏éÂÆùËóèÂç°‰∏ÄËá¥ÁöÑÂ≠ó‰ΩìÔºâ
            if (data.content) {
                ctx.fillStyle = '#3D2F2F'; // ‰øÆÊîπ‰∏∫#3D2F2FÂåπÈÖçÂÆùËóèÂç°
                ctx.font = '15px "Noto Serif SC", serif';
                const lines = wrapText(ctx, data.content, width - 60);
                lines.forEach(line => {
                    ctx.fillText(line, centerX, y);
                    y += 27;
                });
                y += 10;
                
                // 5. ÂàÜÂâ≤Á∫øÔºàÂÜÖÂÆπÂêéÔºâ
                drawDivider(ctx, width, y);
                y += 25;
            }
            
            // 6. ÁªòÂà∂ÊÉÖÁª™ÂíåÊó∂Èó¥
            if (data.emotion || data.time) {
                ctx.fillStyle = '#8b7355';
                ctx.font = '13px "Noto Serif SC", serif';
                const metaText = [data.emotion, data.time].filter(Boolean).join('  ');
                ctx.fillText(metaText, centerX, y);
                y += 30;
                
                // 7. ÂàÜÂâ≤Á∫øÔºàÊÉÖÁª™ÂêéÔºâ
                drawDivider(ctx, width, y);
                y += 25;
            }
            
            // 8. ÁªòÂà∂‰πåÈ∏¶ËØÑËÆ∫
            if (data.crowComment) {
                ctx.fillStyle = '#8b7355';
                ctx.font = 'italic 13px "Noto Serif SC", serif';
                const commentLines = wrapText(ctx, data.crowComment, width - 60);
                commentLines.forEach(line => {
                    ctx.fillText(line, centerX, y);
                    y += 22;
                });
                y += 36; // ‰πåÈ∏¶ËØ≠ÂΩï‰∏ãÊñπÂõ∫ÂÆö36pxËæπË∑ù
            }
            
            // ËøîÂõûÂÆûÈôÖÂÜÖÂÆπÈ´òÂ∫¶
            return y;
        }
        
        // ÁªòÂà∂ÁÆÄÁ∫¶ÁâàÊòé‰ø°Áâá
        function drawMinimalPostcard(ctx, width, height, data) {
            const centerX = width / 2;
            const centerY = height / 2;
            
            // 1. ÁªòÂà∂È≠îÊ≥ïÂúàÂíåÂÆùËóèÂõæÊ†áÔºàÁº©Â∞èÂ∞∫ÂØ∏Ôºå‰∏éÂÆåÊï¥Áâà‰øùÊåÅ‰∏ÄËá¥ÊØî‰æãÔºâ
            const circleSize = 70;  // ‰ªé90Áº©Â∞èÂà∞70
            const iconSize = 40;     // ‰ªé45Áº©Â∞èÂà∞40
            drawMagicCircle(ctx, centerX, centerY - 40, circleSize, data.circleType);
            drawTreasureIcon(ctx, centerX, centerY - 40, iconSize, data.iconType);
            
            // 2. ÂàÜÂâ≤Á∫øÔºàÂõæÊ°àÂíåÊñáÂ≠ó‰πãÈó¥Ôºâ
            const dividerY = centerY + 20; // Ë∞ÉÊï¥ÂàÜÂâ≤Á∫ø‰ΩçÁΩÆ
            const dividerWidth = width * 0.6;
            const startX = (width - dividerWidth) / 2;
            const endX = startX + dividerWidth;
            
            const gradient = ctx.createLinearGradient(startX, dividerY, endX, dividerY);
            gradient.addColorStop(0, 'rgba(201, 169, 97, 0)');
            gradient.addColorStop(0.5, 'rgba(201, 169, 97, 1)');
            gradient.addColorStop(1, 'rgba(201, 169, 97, 0)');
            
            ctx.strokeStyle = gradient;
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(startX, dividerY);
            ctx.lineTo(endX, dividerY);
            ctx.stroke();
            
            // 3. ÁªòÂà∂ÂÆùËóèÂêçÁß∞Ôºà‰ΩøÁî®‰∏éÂÆùËóèÂç°‰∏ÄËá¥ÁöÑÂ≠ó‰ΩìÔºâ
            ctx.fillStyle = '#3D2F2F';
            ctx.font = '600 18px "Noto Serif SC", serif';
            ctx.textAlign = 'center';
            ctx.letterSpacing = '2px';
            ctx.fillText(data.name, centerX, centerY + 50);
            ctx.letterSpacing = '0px';
            
            // 4. Â∫ïÈÉ®Âõ∫ÂÆöËæπË∑ù36pxÔºàÈÄöËøáËøîÂõûÂÄºÊàñÂú®È´òÂ∫¶ËÆ°ÁÆó‰∏≠‰ΩìÁé∞Ôºâ
            // ÁÆÄÁ∫¶ÁâàÂõ∫ÂÆöÈ´òÂ∫¶Â∑≤ÁªèÂåÖÂê´‰∫ÜÂêàÈÄÇÁöÑËæπË∑ù
        }
        
        // ÁªòÂà∂ÂàÜÂâ≤Á∫ø
        function drawDivider(ctx, totalWidth, y, startX) {
            startX = startX || totalWidth * 0.1;
            const endX = startX + (totalWidth * 0.8);
            
            const gradient = ctx.createLinearGradient(startX, y, endX, y);
            gradient.addColorStop(0, 'rgba(201, 169, 97, 0)');
            gradient.addColorStop(0.5, 'rgba(201, 169, 97, 1)');
            gradient.addColorStop(1, 'rgba(201, 169, 97, 0)');
            
            ctx.strokeStyle = gradient;
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(startX, y);
            ctx.lineTo(endX, y);
            ctx.stroke();
        }
        
        // ÁªòÂà∂È≠îÊ≥ïÂúàÔºàÂåπÈÖçËøêÂä®ÁâàÊú¨ÁöÑÊ†∑ÂºèÔºâ
        function drawMagicCircle(ctx, x, y, size, type) {
            const radius = size / 2;
            ctx.strokeStyle = '#C9A961';
            ctx.fillStyle = '#C9A961';
            
            switch(type) {
                case 1: // ÁªèÂÖ∏ÂÖ≠ËäíÊòüÁéØ - ÂåπÈÖç .circle-classic
                    // Â§ñÂúÜ (100%, border: 3px)
                    ctx.lineWidth = 3;
                    ctx.globalAlpha = 0.8;
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // ÂÜÖÂúÜ (85%, border: 2px)
                    ctx.lineWidth = 2;
                    ctx.globalAlpha = 0.6;
                    ctx.beginPath();
                    ctx.arc(x, y, radius * 0.85, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.globalAlpha = 1.0;
                    
                    // 6‰∏™Ë£ÖÈ•∞ÁÇπ (8pxÁõ¥ÂæÑ)
                    const dot1Positions = [
                        [0, -radius - 6],      // ‰∏ä
                        [radius + 6, 0],       // Âè≥
                        [0, radius + 6],       // ‰∏ã
                        [-radius - 6, 0],      // Â∑¶
                        [radius * 0.7, -radius * 0.7],  // Âè≥‰∏ä
                        [-radius * 0.7, radius * 0.7]   // Â∑¶‰∏ã
                    ];
                    dot1Positions.forEach(([dx, dy]) => {
                        ctx.beginPath();
                        ctx.arc(x + dx, y + dy, 4, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    break;
                    
                case 2: // Á¨¶Êñá‰∏âÁéØ - ÂåπÈÖç .circle-rune
                    // Â§ñÁéØ (100%, border: 2px)
                    ctx.lineWidth = 2;
                    ctx.globalAlpha = 0.8;
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // ‰∏≠ÁéØ (90%, border: 2px, dashed)
                    ctx.globalAlpha = 0.6;
                    ctx.setLineDash([5, 3]);
                    ctx.beginPath();
                    ctx.arc(x, y, radius * 0.9, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // ÂÜÖÁéØ (75%, border: 2px)
                    ctx.setLineDash([]);
                    ctx.globalAlpha = 0.4;
                    ctx.beginPath();
                    ctx.arc(x, y, radius * 0.75, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.globalAlpha = 1.0;
                    
                    // Á¨¶ÊñáÁ¨¶Âè∑ (font-size: 12px)
                    ctx.font = 'bold 12px serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    const runes = ['·ö±', '·ö®', '·öπ', '·õñ'];
                    const runePos = [
                        [0, -radius - 8],      // ‰∏ä
                        [radius + 8, 0],       // Âè≥
                        [0, radius + 8],       // ‰∏ã
                        [-radius - 8, 0]       // Â∑¶
                    ];
                    runes.forEach((rune, i) => {
                        ctx.fillText(rune, x + runePos[i][0], y + runePos[i][1]);
                    });
                    break;
                    
                case 3: // Èò¥Èò≥Ëû∫ÊóãÁéØ - ÂåπÈÖç .circle-spiral
                    // Â§ñËû∫ÊóãÁéØ (100%, border-top & border-right: 3px)
                    ctx.lineWidth = 3;
                    ctx.globalAlpha = 0.7;
                    ctx.beginPath();
                    ctx.arc(x, y, radius, -Math.PI/2, Math.PI/2); // Âè≥ÂçäÂúÜ
                    ctx.stroke();
                    
                    // ÂÜÖËû∫ÊóãÁéØ (85%, border-left & border-bottom: 3px)
                    ctx.globalAlpha = 0.5;
                    ctx.beginPath();
                    ctx.arc(x, y, radius * 0.85, Math.PI/2, Math.PI * 1.5); // Â∑¶ÂçäÂúÜ
                    ctx.stroke();
                    ctx.globalAlpha = 1.0;
                    break;
                    
                case 6: // Âè§ÊñáÂ∞ÅÂç∞ÁéØ - ÂåπÈÖç .circle-ancient
                    // Â§ñÂèåÁ∫øÂúÜ (100%, border: 3px double)
                    ctx.lineWidth = 3;
                    ctx.globalAlpha = 0.7;
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.arc(x, y, radius - 4, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // ÂÜÖÂúÜ (80%, border: 2px)
                    ctx.lineWidth = 2;
                    ctx.globalAlpha = 0.5;
                    ctx.beginPath();
                    ctx.arc(x, y, radius * 0.8, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.globalAlpha = 1.0;
                    
                    // Âè§ÊñáÁ¨¶Âè∑ (font-size: 14px)
                    ctx.font = 'bold 14px serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    const symbols = ['‚ò∞', '‚ò±', '‚ò≤', '‚ò≥'];
                    const symPos = [
                        [0, -radius - 10],     // ‰∏ä
                        [radius + 10, 0],      // Âè≥
                        [0, radius + 10],      // ‰∏ã
                        [-radius - 10, 0]      // Â∑¶
                    ];
                    symbols.forEach((sym, i) => {
                        ctx.fillText(sym, x + symPos[i][0], y + symPos[i][1]);
                    });
                    break;
                    
                default:
                    // ÈªòËÆ§ÁÆÄÂçïÂúÜÁéØ
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.stroke();
                    break;
            }
        }
        
        // ÁªòÂà∂ÂÆùËóèÂõæÊ†áÔºàÊîØÊåÅÊâÄÊúâÁ±ªÂûãÔºâ
        function drawTreasureIcon(ctx, x, y, size, iconType) {
            const color = '#C9A961';
            const darkColor = '#8B6F47';
            const scale = size / 100; // Âü∫‰∫é100x100ÁöÑviewBoxÁº©Êîæ
            
            ctx.save();
            ctx.translate(x - size/2, y - size/2);
            ctx.scale(scale, scale);
            
            // Ê†πÊçÆiconTypeÁªòÂà∂‰∏çÂêåÁöÑÂõæÊ†á
            switch(iconType) {
                case 1: // ÈáëÂ∏Å
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(50, 50, 35, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = darkColor;
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.arc(50, 50, 28, 0, Math.PI * 2);
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    ctx.fillStyle = darkColor;
                    ctx.font = 'bold 32px serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('¬•', 50, 55);
                    break;
                    
                case 2: // ÁæΩÊØõ
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 4;
                    ctx.lineCap = 'round';
                    ctx.beginPath();
                    ctx.moveTo(50, 15);
                    ctx.quadraticCurveTo(48, 35, 46, 55);
                    ctx.quadraticCurveTo(44, 75, 42, 90);
                    ctx.stroke();
                    
                    // ÁæΩÊØõÂàÜÊîØ
                    ctx.lineWidth = 2;
                    for(let i = 0; i < 5; i++) {
                        const yPos = 30 + i * 10;
                        ctx.beginPath();
                        ctx.moveTo(46 - i * 0.4, yPos);
                        ctx.quadraticCurveTo(30 - i * 2, yPos + 2, 25 - i * 3, yPos + 5);
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.moveTo(54 + i * 0.4, yPos);
                        ctx.quadraticCurveTo(70 + i * 2, yPos + 2, 75 + i * 3, yPos + 5);
                        ctx.stroke();
                    }
                    break;
                    
                case 3: // ÈÖíÊùØ
                    ctx.fillStyle = color;
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(30, 20);
                    ctx.lineTo(35, 60);
                    ctx.quadraticCurveTo(35, 75, 50, 75);
                    ctx.quadraticCurveTo(65, 75, 65, 60);
                    ctx.lineTo(70, 20);
                    ctx.closePath();
                    ctx.fill();
                    ctx.fillRect(25, 15, 50, 8);
                    ctx.fillRect(45, 75, 10, 15);
                    break;
                    
                case 4: // Á©∫Áì∂
                    ctx.save();
                    ctx.translate(50, 50);
                    ctx.rotate(-0.17); // -10Â∫¶
                    ctx.translate(-50, -50);
                    
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(42, 25);
                    ctx.lineTo(42, 35);
                    ctx.quadraticCurveTo(40, 40, 40, 45);
                    ctx.lineTo(40, 70);
                    ctx.quadraticCurveTo(40, 75, 45, 75);
                    ctx.lineTo(55, 75);
                    ctx.quadraticCurveTo(60, 75, 60, 70);
                    ctx.lineTo(60, 45);
                    ctx.quadraticCurveTo(60, 40, 58, 35);
                    ctx.lineTo(58, 25);
                    ctx.closePath();
                    ctx.stroke();
                    
                    ctx.strokeRect(44, 18, 12, 7);
                    ctx.restore();
                    break;
                    
                case 5: // Ëä±ÁéØ
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.arc(50, 50, 30, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    ctx.fillStyle = color;
                    [[50, 20], [80, 50], [50, 80], [20, 50]].forEach(([cx, cy]) => {
                        ctx.beginPath();
                        ctx.arc(cx, cy, 8, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    
                    ctx.fillStyle = darkColor;
                    [[65, 30], [70, 70], [30, 70], [35, 30]].forEach(([cx, cy]) => {
                        ctx.beginPath();
                        ctx.arc(cx, cy, 6, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    break;
                    
                case 6: // ÈìÉÈìõ
                    ctx.fillStyle = color;
                    ctx.strokeStyle = darkColor;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(50, 20);
                    ctx.lineTo(35, 60);
                    ctx.quadraticCurveTo(35, 70, 50, 70);
                    ctx.quadraticCurveTo(65, 70, 65, 60);
                    ctx.lineTo(50, 20);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    
                    ctx.fillStyle = darkColor;
                    ctx.beginPath();
                    ctx.arc(50, 72, 6, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.strokeStyle = darkColor;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(50, 10);
                    ctx.lineTo(50, 20);
                    ctx.stroke();
                    
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(50, 10, 4, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 7: // Âç∑ËΩ¥
                    ctx.fillStyle = color;
                    ctx.strokeStyle = darkColor;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(25, 30);
                    ctx.quadraticCurveTo(20, 50, 25, 70);
                    ctx.lineTo(75, 70);
                    ctx.quadraticCurveTo(80, 50, 75, 30);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    
                    ctx.fillStyle = darkColor;
                    ctx.beginPath();
                    ctx.ellipse(25, 50, 5, 22, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.ellipse(75, 50, 5, 22, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.strokeStyle = darkColor;
                    ctx.lineWidth = 2;
                    [40, 50, 60].forEach((yPos) => {
                        ctx.beginPath();
                        ctx.moveTo(35, yPos);
                        ctx.lineTo(65, yPos);
                        ctx.stroke();
                    });
                    break;
                    
                case 10: // ÂÆùÁü≥
                    ctx.fillStyle = '#4A90E2';
                    ctx.strokeStyle = '#2E5C8A';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(50, 20);
                    ctx.lineTo(70, 40);
                    ctx.lineTo(60, 75);
                    ctx.lineTo(40, 75);
                    ctx.lineTo(30, 40);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    
                    ctx.fillStyle = '#5BA3F5';
                    ctx.globalAlpha = 0.7;
                    ctx.beginPath();
                    ctx.moveTo(50, 20);
                    ctx.lineTo(70, 40);
                    ctx.lineTo(50, 50);
                    ctx.closePath();
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                    break;
                    
                case 12: // Ê∞¥Êô∂
                    ctx.fillStyle = color;
                    ctx.strokeStyle = darkColor;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(50, 20);
                    ctx.lineTo(65, 40);
                    ctx.lineTo(60, 70);
                    ctx.lineTo(40, 70);
                    ctx.lineTo(35, 40);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(50, 20);
                    ctx.lineTo(50, 70);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(35, 40);
                    ctx.lineTo(65, 40);
                    ctx.stroke();
                    break;
                    
                case 14: // ÁÆ±Â≠ê
                    ctx.fillStyle = color;
                    ctx.strokeStyle = darkColor;
                    ctx.lineWidth = 3;
                    ctx.fillRect(25, 40, 50, 35);
                    ctx.strokeRect(25, 40, 50, 35);
                    
                    ctx.fillStyle = darkColor;
                    ctx.beginPath();
                    ctx.moveTo(25, 40);
                    ctx.lineTo(35, 30);
                    ctx.lineTo(85, 30);
                    ctx.lineTo(75, 40);
                    ctx.closePath();
                    ctx.fill();
                    
                    ctx.fillRect(25, 40, 50, 8);
                    ctx.fillRect(47, 52, 6, 15);
                    
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(50, 62, 3, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 15: // ÁéãÂÜ†
                    ctx.fillStyle = color;
                    ctx.strokeStyle = darkColor;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(25, 55);
                    ctx.lineTo(30, 40);
                    ctx.lineTo(50, 50);
                    ctx.lineTo(70, 40);
                    ctx.lineTo(75, 55);
                    ctx.lineTo(65, 65);
                    ctx.lineTo(35, 65);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    
                    [[30, 40], [50, 50], [70, 40]].forEach(([cx, cy]) => {
                        ctx.fillStyle = color;
                        ctx.strokeStyle = darkColor;
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.arc(cx, cy, 5, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.stroke();
                    });
                    break;
                    
                default: // ÈªòËÆ§‰ΩøÁî®ÈáëÂ∏Å
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(50, 50, 35, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = darkColor;
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.arc(50, 50, 28, 0, Math.PI * 2);
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    ctx.fillStyle = darkColor;
                    ctx.font = 'bold 32px serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('¬•', 50, 55);
                    break;
            }
            
            ctx.restore();
        }
        
        // ÊñáÊú¨Êç¢Ë°åËæÖÂä©ÂáΩÊï∞
        function wrapText(ctx, text, maxWidth) {
            const chars = text.split('');
            const lines = [];
            let currentLine = '';
            
            for (let char of chars) {
                const testLine = currentLine + char;
                const metrics = ctx.measureText(testLine);
                
                if (metrics.width > maxWidth && currentLine !== '') {
                    lines.push(currentLine);
                    currentLine = char;
                } else {
                    currentLine = testLine;
                }
            }
            
            if (currentLine) {
                lines.push(currentLine);
            }
            
            return lines;
        }
        
        // ÊòæÁ§∫ÂõæÁâáÈ¢ÑËßàÔºà‰æõÁî®Êà∑ÈïøÊåâ‰øùÂ≠òÔºâ
        function showImagePreview(imageUrl) {
            // Â¶ÇÊûúÂ∑≤ÁªèÊúâÈ¢ÑËßàÔºåÂÖàÂÖ≥Èó≠
            closeImagePreview();
            
            // ÂàõÂª∫ÂõæÁâáÈ¢ÑËßàÈÅÆÁΩ© - ‰ΩøÁî®‰∏éÂÆùËóèÂç°‰∏ÄËá¥ÁöÑÈÄèÊòéÁÅ∞Ëâ≤
            const previewOverlay = document.createElement('div');
            previewOverlay.id = 'imagePreviewOverlay';
            previewOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1000;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 20px;
                animation: fadeIn 0.3s ease;
            `;
            
            // ÊèêÁ§∫ÊñáÂ≠ó
            const tipText = document.createElement('div');
            tipText.textContent = 'ÈïøÊåâÂõæÁâá‰øùÂ≠òÂà∞Áõ∏ÂÜå';
            tipText.style.cssText = `
                color: white;
                font-size: 16px;
                margin-bottom: 20px;
                text-align: center;
                letter-spacing: 1px;
            `;
            
            // ÂõæÁâá
            const img = document.createElement('img');
            img.src = imageUrl;
            img.style.cssText = `
                max-width: 90%;
                max-height: 70vh;
                border-radius: 16px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            `;
            
            // ÂÖ≥Èó≠ÊåâÈíÆ
            const closeBtn = document.createElement('button');
            closeBtn.textContent = '√ó';
            closeBtn.style.cssText = `
                position: absolute;
                top: 20px;
                right: 20px;
                width: 40px;
                height: 40px;
                border: none;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.2);
                color: white;
                font-size: 28px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s;
            `;
            
            closeBtn.onclick = () => {
                closeImagePreview();
            };
            
            // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
            previewOverlay.onclick = (e) => {
                if (e.target === previewOverlay) {
                    closeImagePreview();
                }
            };
            
            previewOverlay.appendChild(closeBtn);
            previewOverlay.appendChild(tipText);
            previewOverlay.appendChild(img);
            document.body.appendChild(previewOverlay);
            
            // ‰øùÂ≠òimageUrl‰æõÊ∏ÖÁêÜÊó∂‰ΩøÁî®
            previewOverlay.dataset.imageUrl = imageUrl;
            
            showToast('ÂõæÁâáÂ∑≤ÁîüÊàê');
            closeSharePanel();
        }
        
        // ÂÖ≥Èó≠ÂõæÁâáÈ¢ÑËßà
        function closeImagePreview() {
            const previewOverlay = document.getElementById('imagePreviewOverlay');
            if (previewOverlay) {
                const imageUrl = previewOverlay.dataset.imageUrl;
                if (imageUrl) {
                    URL.revokeObjectURL(imageUrl);
                }
                document.body.removeChild(previewOverlay);
            }
        }
        
        // ÂàÜ‰∫´Âà∞ÂæÆ‰ø°
        async function shareToWechat() {
            try {
                const treasureCard = document.querySelector('.treasure-card-modal.active') || 
                                   document.querySelector('.treasure-preview-modal.active');
                
                if (!treasureCard) {
                    showToast('Êú™ÊâæÂà∞ÂÆùËóèÂç°');
                    return;
                }
                
                // ‰∏¥Êó∂ÈöêËóèÊåâÈíÆ
                const closeBtn = treasureCard.querySelector('.modal-close-btn, .modal-close');
                const actionsBar = treasureCard.querySelector('.treasure-card-actions');
                const previewActions = treasureCard.querySelector('.preview-actions');
                
                const elementsToHide = [closeBtn, actionsBar, previewActions].filter(el => el);
                elementsToHide.forEach(el => el.style.display = 'none');
                
                // ÁîüÊàêÂõæÁâá
                await generateCardImage(treasureCard);
                
                elementsToHide.forEach(el => el.style.display = '');
                
                showToast('ÂõæÁâáÂ∑≤ÁîüÊàêÔºåÈïøÊåâ‰øùÂ≠òÂêéÂàÜ‰∫´Âà∞ÂæÆ‰ø°');
                
            } catch (error) {
                console.error('ÂàÜ‰∫´Â§±Ë¥•:', error);
                showToast('ËØ∑ÂÖà‰øùÂ≠òÂõæÁâáÔºåÁÑ∂ÂêéÊâãÂä®ÂàÜ‰∫´');
            }
        }
        
        // ÂàÜ‰∫´Âà∞Â∞èÁ∫¢‰π¶
        async function shareToXiaohongshu() {
            try {
                const treasureCard = document.querySelector('.treasure-card-modal.active') || 
                                   document.querySelector('.treasure-preview-modal.active');
                
                if (!treasureCard) {
                    showToast('Êú™ÊâæÂà∞ÂÆùËóèÂç°');
                    return;
                }
                
                // ‰∏¥Êó∂ÈöêËóèÊåâÈíÆ
                const closeBtn = treasureCard.querySelector('.modal-close-btn, .modal-close');
                const actionsBar = treasureCard.querySelector('.treasure-card-actions');
                const previewActions = treasureCard.querySelector('.preview-actions');
                
                const elementsToHide = [closeBtn, actionsBar, previewActions].filter(el => el);
                elementsToHide.forEach(el => el.style.display = 'none');
                
                // ÁîüÊàêÂõæÁâá
                await generateCardImage(treasureCard);
                
                elementsToHide.forEach(el => el.style.display = '');
                
                showToast('ÂõæÁâáÂ∑≤ÁîüÊàêÔºåÈïøÊåâ‰øùÂ≠òÂêéÂèëÂ∏ÉÂà∞Â∞èÁ∫¢‰π¶');
                
            } catch (error) {
                console.error('ÂàÜ‰∫´Â§±Ë¥•:', error);
                showToast('ËØ∑ÂÖà‰øùÂ≠òÂõæÁâáÔºåÁÑ∂ÂêéÊâãÂä®ÂàÜ‰∫´');
            }
        }
        
        // ÂàÜ‰∫´Âà∞QQ
        async function shareToQQ() {
            try {
                const treasureCard = document.querySelector('.treasure-card-modal.active') || 
                                   document.querySelector('.treasure-preview-modal.active');
                
                if (!treasureCard) {
                    showToast('Êú™ÊâæÂà∞ÂÆùËóèÂç°');
                    return;
                }
                
                const closeBtn = treasureCard.querySelector('.modal-close-btn, .modal-close');
                const actionsBar = treasureCard.querySelector('.treasure-card-actions');
                const previewActions = treasureCard.querySelector('.preview-actions');
                
                const elementsToHide = [closeBtn, actionsBar, previewActions].filter(el => el);
                elementsToHide.forEach(el => el.style.display = 'none');
                
                // ÁîüÊàêÂõæÁâá
                await generateCardImage(treasureCard);
                
                elementsToHide.forEach(el => el.style.display = '');
                
                showToast('ÂõæÁâáÂ∑≤ÁîüÊàêÔºåÈïøÊåâ‰øùÂ≠òÂêéÂàÜ‰∫´Âà∞QQ');
                
            } catch (error) {
                console.error('ÂàÜ‰∫´Â§±Ë¥•:', error);
                showToast('ËØ∑ÂÖà‰øùÂ≠òÂõæÁâáÔºåÁÑ∂ÂêéÊâãÂä®ÂàÜ‰∫´');
            }
        }

        // Êú¨Âú∞Â≠òÂÇ®
        function saveTreasures() {
            localStorage.setItem('ravens_treasures', JSON.stringify(treasures));
        }

        function loadTreasures() {
            const data = localStorage.getItem('ravens_treasures');
            treasures = data ? JSON.parse(data) : [];
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        document.getElementById('generateBtn').addEventListener('click', generateTreasure);
        
        // ‰∏∫ÁîüÊàêÊåâÈíÆÊ∑ªÂä†ÁÅ´Ëä±ÊïàÊûú
        document.getElementById('generateBtn').addEventListener('click', createSparks);
        
        // ‰∏∫ÊäΩÂèñÊåâÈíÆÊ∑ªÂä†ÁÅ´Ëä±ÊïàÊûúÔºà‰ΩøÁî®ÂÆâÂÖ®Ê£ÄÊü•Ôºâ
        const drawBtn = document.getElementById('drawBtn');
        if (drawBtn) {
            drawBtn.addEventListener('click', createSparks);
        }

        init();
    </script>
</body>
</html>
